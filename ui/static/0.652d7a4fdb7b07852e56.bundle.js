webpackJsonp([0],{1182:function(module,exports,__webpack_require__){!function(root,factory){module.exports=factory()}(0,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/dist/",__webpack_require__(__webpack_require__.s=8)}([function(module,__webpack_exports__,__webpack_require__){"use strict";function noop(){}function formatMsg(type,msg){return msg="["+type+"] > "+msg}function consolePrintFn(type){var func=self.console[type];return func?function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];args[0]&&(args[0]=formatMsg(type,args[0])),func.apply(self.console,args)}:noop}function exportLoggerFunctions(debugConfig){for(var _len2=arguments.length,functions=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)functions[_key2-1]=arguments[_key2];functions.forEach(function(type){exportedLogger[type]=debugConfig[type]?debugConfig[type].bind(debugConfig):consolePrintFn(type)})}__webpack_require__.d(__webpack_exports__,"a",function(){return enableLogs}),__webpack_require__.d(__webpack_exports__,"b",function(){return logger});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop},exportedLogger=fakeLogger,enableLogs=function(debugConfig){if(!0===debugConfig||"object"===(void 0===debugConfig?"undefined":_typeof(debugConfig))){exportLoggerFunctions(debugConfig,"debug","log","info","warn","error");try{exportedLogger.log()}catch(e){exportedLogger=fakeLogger}}else exportedLogger=fakeLogger},logger=exportedLogger},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",function(){return ErrorTypes}),__webpack_require__.d(__webpack_exports__,"a",function(){return ErrorDetails});var ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(module,exports){},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var ID3=function(){function ID3(){_classCallCheck(this,ID3)}return ID3.isHeader=function(data,offset){return offset+10<=data.length&&73===data[offset]&&68===data[offset+1]&&51===data[offset+2]&&data[offset+3]<255&&data[offset+4]<255&&data[offset+6]<128&&data[offset+7]<128&&data[offset+8]<128&&data[offset+9]<128},ID3.isFooter=function(data,offset){return offset+10<=data.length&&51===data[offset]&&68===data[offset+1]&&73===data[offset+2]&&data[offset+3]<255&&data[offset+4]<255&&data[offset+6]<128&&data[offset+7]<128&&data[offset+8]<128&&data[offset+9]<128},ID3.getID3Data=function(data,offset){for(var front=offset,length=0;ID3.isHeader(data,offset);){length+=10;length+=ID3._readSize(data,offset+6),ID3.isFooter(data,offset+10)&&(length+=10),offset+=length}if(length>0)return data.subarray(front,front+length)},ID3._readSize=function(data,offset){var size=0;return size=(127&data[offset])<<21,size|=(127&data[offset+1])<<14,size|=(127&data[offset+2])<<7,size|=127&data[offset+3]},ID3.getTimeStamp=function(data){for(var frames=ID3.getID3Frames(data),i=0;i<frames.length;i++){var frame=frames[i];if(ID3.isTimeStampFrame(frame))return ID3._readTimeStamp(frame)}},ID3.isTimeStampFrame=function(frame){return frame&&"PRIV"===frame.key&&"com.apple.streaming.transportStreamTimestamp"===frame.info},ID3._getFrameData=function(data){var type=String.fromCharCode(data[0],data[1],data[2],data[3]),size=ID3._readSize(data,4);return{type:type,size:size,data:data.subarray(10,10+size)}},ID3.getID3Frames=function(id3Data){for(var offset=0,frames=[];ID3.isHeader(id3Data,offset);){var size=ID3._readSize(id3Data,offset+6);offset+=10;for(var end=offset+size;offset+8<end;){var frameData=ID3._getFrameData(id3Data.subarray(offset)),frame=ID3._decodeFrame(frameData);frame&&frames.push(frame),offset+=frameData.size+10}ID3.isFooter(id3Data,offset)&&(offset+=10)}return frames},ID3._decodeFrame=function(frame){return"PRIV"===frame.type?ID3._decodePrivFrame(frame):"T"===frame.type[0]?ID3._decodeTextFrame(frame):"W"===frame.type[0]?ID3._decodeURLFrame(frame):void 0},ID3._readTimeStamp=function(timeStampFrame){if(8===timeStampFrame.data.byteLength){var data=new Uint8Array(timeStampFrame.data),pts33Bit=1&data[3],timestamp=(data[4]<<23)+(data[5]<<15)+(data[6]<<7)+data[7];return timestamp/=45,pts33Bit&&(timestamp+=47721858.84),Math.round(timestamp)}},ID3._decodePrivFrame=function(frame){if(!(frame.size<2)){var owner=ID3._utf8ArrayToStr(frame.data),privateData=new Uint8Array(frame.data.subarray(owner.length+1));return{key:frame.type,info:owner,data:privateData.buffer}}},ID3._decodeTextFrame=function(frame){if(!(frame.size<2)){if("TXXX"===frame.type){var index=1,description=ID3._utf8ArrayToStr(frame.data.subarray(index));index+=description.length+1;var value=ID3._utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value}}var text=ID3._utf8ArrayToStr(frame.data.subarray(1));return{key:frame.type,data:text}}},ID3._decodeURLFrame=function(frame){if("WXXX"===frame.type){if(frame.size<2)return;var index=1,description=ID3._utf8ArrayToStr(frame.data.subarray(index));index+=description.length+1;var value=ID3._utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value}}var url=ID3._utf8ArrayToStr(frame.data);return{key:frame.type,data:url}},ID3._utf8ArrayToStr=function(array){for(var len=array.length,c=void 0,char2=void 0,char3=void 0,out="",i=0;i<len;)if(0!==(c=array[i++])&&3!==c)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:out+=String.fromCharCode(c);break;case 12:case 13:char2=array[i++],out+=String.fromCharCode((31&c)<<6|63&char2);break;case 14:char2=array[i++],char3=array[i++],out+=String.fromCharCode((15&c)<<12|(63&char2)<<6|(63&char3)<<0)}return out},ID3}();ID3._utf8ArrayToStr;__webpack_exports__.a=ID3},function(module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){return this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},function(module,exports,__webpack_require__){!function(root){var URL_REGEX=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,FIRST_SEGMENT_REGEX=/^([^\/;?#]*)(.*)$/,SLASH_DOT_REGEX=/(?:\/|^)\.(?=\/)/g,SLASH_DOT_DOT_REGEX=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,URLToolkit={buildAbsoluteURL:function(baseURL,relativeURL,opts){if(opts=opts||{},baseURL=baseURL.trim(),!(relativeURL=relativeURL.trim())){if(!opts.alwaysNormalize)return baseURL;var basePartsForNormalise=this.parseURL(baseURL);if(!baseParts)throw new Error("Error trying to parse base URL.");return basePartsForNormalise.path=URLToolkit.normalizePath(basePartsForNormalise.path),URLToolkit.buildURLFromParts(basePartsForNormalise)}var relativeParts=this.parseURL(relativeURL);if(!relativeParts)throw new Error("Error trying to parse relative URL.");if(relativeParts.scheme)return opts.alwaysNormalize?(relativeParts.path=URLToolkit.normalizePath(relativeParts.path),URLToolkit.buildURLFromParts(relativeParts)):relativeURL;var baseParts=this.parseURL(baseURL);if(!baseParts)throw new Error("Error trying to parse base URL.");if(!baseParts.netLoc&&baseParts.path&&"/"!==baseParts.path[0]){var pathParts=FIRST_SEGMENT_REGEX.exec(baseParts.path);baseParts.netLoc=pathParts[1],baseParts.path=pathParts[2]}baseParts.netLoc&&!baseParts.path&&(baseParts.path="/");var builtParts={scheme:baseParts.scheme,netLoc:relativeParts.netLoc,path:null,params:relativeParts.params,query:relativeParts.query,fragment:relativeParts.fragment};if(!relativeParts.netLoc&&(builtParts.netLoc=baseParts.netLoc,"/"!==relativeParts.path[0]))if(relativeParts.path){var baseURLPath=baseParts.path,newPath=baseURLPath.substring(0,baseURLPath.lastIndexOf("/")+1)+relativeParts.path;builtParts.path=URLToolkit.normalizePath(newPath)}else builtParts.path=baseParts.path,relativeParts.params||(builtParts.params=baseParts.params,relativeParts.query||(builtParts.query=baseParts.query));return null===builtParts.path&&(builtParts.path=opts.alwaysNormalize?URLToolkit.normalizePath(relativeParts.path):relativeParts.path),URLToolkit.buildURLFromParts(builtParts)},parseURL:function(url){var parts=URL_REGEX.exec(url);return parts?{scheme:parts[1]||"",netLoc:parts[2]||"",path:parts[3]||"",params:parts[4]||"",query:parts[5]||"",fragment:parts[6]||""}:null},normalizePath:function(path){for(path=path.split("").reverse().join("").replace(SLASH_DOT_REGEX,"");path.length!==(path=path.replace(SLASH_DOT_DOT_REGEX,"")).length;);return path.split("").reverse().join("")},buildURLFromParts:function(parts){return parts.scheme+parts.netLoc+parts.path+parts.params+parts.query+parts.fragment}};module.exports=URLToolkit}()},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function fast_aes_key__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function aes_decryptor__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function decrypter__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getAudioConfig(observer,data,offset,audioCodec){var adtsObjectType,adtsSampleingIndex,adtsExtensionSampleingIndex,adtsChanelConfig,config,userAgent=navigator.userAgent.toLowerCase(),manifestCodec=audioCodec,adtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return adtsObjectType=1+((192&data[offset+2])>>>6),(adtsSampleingIndex=(60&data[offset+2])>>>2)>adtsSampleingRates.length-1?void observer.trigger(Event.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+adtsSampleingIndex}):(adtsChanelConfig=(1&data[offset+2])<<2,adtsChanelConfig|=(192&data[offset+3])>>>6,logger.b.log("manifest codec:"+audioCodec+",ADTS data:type:"+adtsObjectType+",sampleingIndex:"+adtsSampleingIndex+"["+adtsSampleingRates[adtsSampleingIndex]+"Hz],channelConfig:"+adtsChanelConfig),/firefox/i.test(userAgent)?adtsSampleingIndex>=6?(adtsObjectType=5,config=new Array(4),adtsExtensionSampleingIndex=adtsSampleingIndex-3):(adtsObjectType=2,config=new Array(2),adtsExtensionSampleingIndex=adtsSampleingIndex):-1!==userAgent.indexOf("android")?(adtsObjectType=2,config=new Array(2),adtsExtensionSampleingIndex=adtsSampleingIndex):(adtsObjectType=5,config=new Array(4),audioCodec&&(-1!==audioCodec.indexOf("mp4a.40.29")||-1!==audioCodec.indexOf("mp4a.40.5"))||!audioCodec&&adtsSampleingIndex>=6?adtsExtensionSampleingIndex=adtsSampleingIndex-3:((audioCodec&&-1!==audioCodec.indexOf("mp4a.40.2")&&(adtsSampleingIndex>=6&&1===adtsChanelConfig||/vivaldi/i.test(userAgent))||!audioCodec&&1===adtsChanelConfig)&&(adtsObjectType=2,config=new Array(2)),adtsExtensionSampleingIndex=adtsSampleingIndex)),config[0]=adtsObjectType<<3,config[0]|=(14&adtsSampleingIndex)>>1,config[1]|=(1&adtsSampleingIndex)<<7,config[1]|=adtsChanelConfig<<3,5===adtsObjectType&&(config[1]|=(14&adtsExtensionSampleingIndex)>>1,config[2]=(1&adtsExtensionSampleingIndex)<<7,config[2]|=8,config[3]=0),{config:config,samplerate:adtsSampleingRates[adtsSampleingIndex],channelCount:adtsChanelConfig,codec:"mp4a.40."+adtsObjectType,manifestCodec:manifestCodec})}function isHeaderPattern(data,offset){return 255===data[offset]&&240==(246&data[offset+1])}function getHeaderLength(data,offset){return 1&data[offset+1]?7:9}function getFullFrameLength(data,offset){return(3&data[offset+3])<<11|data[offset+4]<<3|(224&data[offset+5])>>>5}function isHeader(data,offset){return!!(offset+1<data.length&&isHeaderPattern(data,offset))}function adts_probe(data,offset){if(offset+1<data.length&&isHeaderPattern(data,offset)){var headerLength=getHeaderLength(data,offset),frameLength=headerLength;offset+5<data.length&&(frameLength=getFullFrameLength(data,offset));var newOffset=offset+frameLength;if(newOffset===data.length||newOffset+1<data.length&&isHeaderPattern(data,newOffset))return!0}return!1}function initTrackConfig(track,observer,data,offset,audioCodec){if(!track.samplerate){var config=getAudioConfig(observer,data,offset,audioCodec);track.config=config.config,track.samplerate=config.samplerate,track.channelCount=config.channelCount,track.codec=config.codec,track.manifestCodec=config.manifestCodec,logger.b.log("parsed codec:"+track.codec+",rate:"+config.samplerate+",nb channel:"+config.channelCount)}}function getFrameDuration(samplerate){return 9216e4/samplerate}function parseFrameHeader(data,offset,pts,frameIndex,frameDuration){var headerLength,frameLength,stamp,length=data.length;if(headerLength=getHeaderLength(data,offset),frameLength=getFullFrameLength(data,offset),(frameLength-=headerLength)>0&&offset+headerLength+frameLength<=length)return stamp=pts+frameIndex*frameDuration,{headerLength:headerLength,frameLength:frameLength,stamp:stamp}}function appendFrame(track,data,offset,pts,frameIndex){var frameDuration=getFrameDuration(track.samplerate),header=parseFrameHeader(data,offset,pts,frameIndex,frameDuration);if(header){var stamp=header.stamp,headerLength=header.headerLength,frameLength=header.frameLength,aacSample={unit:data.subarray(offset+headerLength,offset+headerLength+frameLength),pts:stamp,dts:stamp};return track.samples.push(aacSample),track.len+=frameLength,{sample:aacSample,length:frameLength+headerLength}}}function aacdemuxer__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function mp4demuxer__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function exp_golomb__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function sample_aes__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function tsdemuxer__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function mp3demuxer__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function aac__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function mp4_generator__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function mp4_remuxer__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function passthrough_remuxer__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function demuxer_inline__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var events=__webpack_require__(1),errors=__webpack_require__(2),AESCrypto=function(){function AESCrypto(subtle,iv){_classCallCheck(this,AESCrypto),this.subtle=subtle,this.aesIV=iv}return AESCrypto.prototype.decrypt=function(data,key){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},key,data)},AESCrypto}(),aes_crypto=AESCrypto,FastAESKey=function(){function FastAESKey(subtle,key){fast_aes_key__classCallCheck(this,FastAESKey),this.subtle=subtle,this.key=key}return FastAESKey.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},FastAESKey}(),fast_aes_key=FastAESKey,AESDecryptor=function(){function AESDecryptor(){aes_decryptor__classCallCheck(this,AESDecryptor),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return AESDecryptor.prototype.uint8ArrayToUint32Array_=function(arrayBuffer){for(var view=new DataView(arrayBuffer),newArray=new Uint32Array(4),i=0;i<4;i++)newArray[i]=view.getUint32(4*i);return newArray},AESDecryptor.prototype.initTable=function(){var sBox=this.sBox,invSBox=this.invSBox,subMix=this.subMix,subMix0=subMix[0],subMix1=subMix[1],subMix2=subMix[2],subMix3=subMix[3],invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],d=new Uint32Array(256),x=0,xi=0,i=0;for(i=0;i<256;i++)d[i]=i<128?i<<1:i<<1^283;for(i=0;i<256;i++){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^255&sx^99,sBox[x]=sx,invSBox[sx]=x;var x2=d[x],x4=d[x2],x8=d[x4],t=257*d[sx]^16843008*sx;subMix0[x]=t<<24|t>>>8,subMix1[x]=t<<16|t>>>16,subMix2[x]=t<<8|t>>>24,subMix3[x]=t,t=16843009*x8^65537*x4^257*x2^16843008*x,invSubMix0[sx]=t<<24|t>>>8,invSubMix1[sx]=t<<16|t>>>16,invSubMix2[sx]=t<<8|t>>>24,invSubMix3[sx]=t,x?(x=x2^d[d[d[x8^x2]]],xi^=d[d[xi]]):x=xi=1}},AESDecryptor.prototype.expandKey=function(keyBuffer){for(var key=this.uint8ArrayToUint32Array_(keyBuffer),sameKey=!0,offset=0;offset<key.length&&sameKey;)sameKey=key[offset]===this.key[offset],offset++;if(!sameKey){this.key=key;var keySize=this.keySize=key.length;if(4!==keySize&&6!==keySize&&8!==keySize)throw new Error("Invalid aes key size="+keySize);var ksRows=this.ksRows=4*(keySize+6+1),ksRow=void 0,invKsRow=void 0,keySchedule=this.keySchedule=new Uint32Array(ksRows),invKeySchedule=this.invKeySchedule=new Uint32Array(ksRows),sbox=this.sBox,rcon=this.rcon,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],prev=void 0,t=void 0;for(ksRow=0;ksRow<ksRows;ksRow++)ksRow<keySize?prev=keySchedule[ksRow]=key[ksRow]:(t=prev,ksRow%keySize==0?(t=t<<8|t>>>24,t=sbox[t>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t],t^=rcon[ksRow/keySize|0]<<24):keySize>6&&ksRow%keySize==4&&(t=sbox[t>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t]),keySchedule[ksRow]=prev=(keySchedule[ksRow-keySize]^t)>>>0);for(invKsRow=0;invKsRow<ksRows;invKsRow++)ksRow=ksRows-invKsRow,t=3&invKsRow?keySchedule[ksRow]:keySchedule[ksRow-4],invKeySchedule[invKsRow]=invKsRow<4||ksRow<=4?t:invSubMix0[sbox[t>>>24]]^invSubMix1[sbox[t>>>16&255]]^invSubMix2[sbox[t>>>8&255]]^invSubMix3[sbox[255&t]],invKeySchedule[invKsRow]=invKeySchedule[invKsRow]>>>0}},AESDecryptor.prototype.networkToHostOrderSwap=function(word){return word<<24|(65280&word)<<8|(16711680&word)>>8|word>>>24},AESDecryptor.prototype.decrypt=function(inputArrayBuffer,offset,aesIV){for(var ksRow,i,nRounds=this.keySize+6,invKeySchedule=this.invKeySchedule,invSBOX=this.invSBox,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],initVector=this.uint8ArrayToUint32Array_(aesIV),initVector0=initVector[0],initVector1=initVector[1],initVector2=initVector[2],initVector3=initVector[3],inputInt32=new Int32Array(inputArrayBuffer),outputInt32=new Int32Array(inputInt32.length),t0=void 0,t1=void 0,t2=void 0,t3=void 0,s0=void 0,s1=void 0,s2=void 0,s3=void 0,inputWords0=void 0,inputWords1=void 0,inputWords2=void 0,inputWords3=void 0,swapWord=this.networkToHostOrderSwap;offset<inputInt32.length;){for(inputWords0=swapWord(inputInt32[offset]),inputWords1=swapWord(inputInt32[offset+1]),inputWords2=swapWord(inputInt32[offset+2]),inputWords3=swapWord(inputInt32[offset+3]),s0=inputWords0^invKeySchedule[0],s1=inputWords3^invKeySchedule[1],s2=inputWords2^invKeySchedule[2],s3=inputWords1^invKeySchedule[3],ksRow=4,i=1;i<nRounds;i++)t0=invSubMix0[s0>>>24]^invSubMix1[s1>>16&255]^invSubMix2[s2>>8&255]^invSubMix3[255&s3]^invKeySchedule[ksRow],t1=invSubMix0[s1>>>24]^invSubMix1[s2>>16&255]^invSubMix2[s3>>8&255]^invSubMix3[255&s0]^invKeySchedule[ksRow+1],t2=invSubMix0[s2>>>24]^invSubMix1[s3>>16&255]^invSubMix2[s0>>8&255]^invSubMix3[255&s1]^invKeySchedule[ksRow+2],t3=invSubMix0[s3>>>24]^invSubMix1[s0>>16&255]^invSubMix2[s1>>8&255]^invSubMix3[255&s2]^invKeySchedule[ksRow+3],s0=t0,s1=t1,s2=t2,s3=t3,ksRow+=4;t0=invSBOX[s0>>>24]<<24^invSBOX[s1>>16&255]<<16^invSBOX[s2>>8&255]<<8^invSBOX[255&s3]^invKeySchedule[ksRow],t1=invSBOX[s1>>>24]<<24^invSBOX[s2>>16&255]<<16^invSBOX[s3>>8&255]<<8^invSBOX[255&s0]^invKeySchedule[ksRow+1],t2=invSBOX[s2>>>24]<<24^invSBOX[s3>>16&255]<<16^invSBOX[s0>>8&255]<<8^invSBOX[255&s1]^invKeySchedule[ksRow+2],t3=invSBOX[s3>>>24]<<24^invSBOX[s0>>16&255]<<16^invSBOX[s1>>8&255]<<8^invSBOX[255&s2]^invKeySchedule[ksRow+3],ksRow+=3,outputInt32[offset]=swapWord(t0^initVector0),outputInt32[offset+1]=swapWord(t3^initVector1),outputInt32[offset+2]=swapWord(t2^initVector2),outputInt32[offset+3]=swapWord(t1^initVector3),initVector0=inputWords0,initVector1=inputWords1,initVector2=inputWords2,initVector3=inputWords3,offset+=4}return outputInt32.buffer},AESDecryptor.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},AESDecryptor}(),aes_decryptor=AESDecryptor,logger=__webpack_require__(0),decrypter_Decrypter=function(){function Decrypter(observer,config){decrypter__classCallCheck(this,Decrypter),this.observer=observer,this.config=config,this.logEnabled=!0;try{var browserCrypto=crypto||self.crypto;this.subtle=browserCrypto.subtle||browserCrypto.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return Decrypter.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},Decrypter.prototype.decrypt=function(data,key,iv,callback){var _this=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(logger.b.log("JS AES decrypt"),this.logEnabled=!1);var decryptor=this.decryptor;decryptor||(this.decryptor=decryptor=new aes_decryptor),decryptor.expandKey(key),callback(decryptor.decrypt(data,0,iv))}else{this.logEnabled&&(logger.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var subtle=this.subtle;this.key!==key&&(this.key=key,this.fastAesKey=new fast_aes_key(subtle,key)),this.fastAesKey.expandKey().then(function(aesKey){new aes_crypto(subtle,iv).decrypt(data,aesKey).catch(function(err){_this.onWebCryptoError(err,data,key,iv,callback)}).then(function(result){callback(result)})}).catch(function(err){_this.onWebCryptoError(err,data,key,iv,callback)})}},Decrypter.prototype.onWebCryptoError=function(err,data,key,iv,callback){this.config.enableSoftwareAES?(logger.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(data,key,iv,callback)):(logger.b.error("decrypting error : "+err.message),this.observer.trigger(Event.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:err.message}))},Decrypter.prototype.destroy=function(){var decryptor=this.decryptor;decryptor&&(decryptor.destroy(),this.decryptor=void 0)},Decrypter}(),crypt_decrypter=decrypter_Decrypter,id3=__webpack_require__(4),aacdemuxer_AACDemuxer=function(){function AACDemuxer(observer,remuxer,config){aacdemuxer__classCallCheck(this,AACDemuxer),this.observer=observer,this.config=config,this.remuxer=remuxer}return AACDemuxer.prototype.resetInitSegment=function(initSegment,audioCodec,videoCodec,duration){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:audioCodec,duration:duration,inputTimeScale:9e4}},AACDemuxer.prototype.resetTimeStamp=function(){},AACDemuxer.probe=function(data){if(!data)return!1;for(var id3Data=id3.a.getID3Data(data,0)||[],offset=id3Data.length,length=data.length;offset<length;offset++)if(adts_probe(data,offset))return logger.b.log("ADTS sync word found !"),!0;return!1},AACDemuxer.prototype.append=function(data,timeOffset,contiguous,accurateTimeOffset){for(var track=this._audioTrack,id3Data=id3.a.getID3Data(data,0)||[],timestamp=id3.a.getTimeStamp(id3Data),pts=timestamp?90*timestamp:9e4*timeOffset,frameIndex=0,stamp=pts,length=data.length,offset=id3Data.length,id3Samples=[{pts:stamp,dts:stamp,data:id3Data}];offset<length-1;)if(isHeader(data,offset)&&offset+5<length){initTrackConfig(track,this.observer,data,offset,track.manifestCodec);var frame=appendFrame(track,data,offset,pts,frameIndex);if(!frame){logger.b.log("Unable to parse AAC frame");break}offset+=frame.length,stamp=frame.sample.pts,frameIndex++}else id3.a.isHeader(data,offset)?(id3Data=id3.a.getID3Data(data,offset),id3Samples.push({pts:stamp,dts:stamp,data:id3Data}),offset+=id3Data.length):offset++;this.remuxer.remux(track,{samples:[]},{samples:id3Samples,inputTimeScale:9e4},{samples:[]},timeOffset,contiguous,accurateTimeOffset)},AACDemuxer.prototype.destroy=function(){},AACDemuxer}(),aacdemuxer=aacdemuxer_AACDemuxer,UINT32_MAX=Math.pow(2,32)-1,mp4demuxer_MP4Demuxer=function(){function MP4Demuxer(observer,remuxer){mp4demuxer__classCallCheck(this,MP4Demuxer),this.observer=observer,this.remuxer=remuxer}return MP4Demuxer.prototype.resetTimeStamp=function(initPTS){this.initPTS=initPTS},MP4Demuxer.prototype.resetInitSegment=function(initSegment,audioCodec,videoCodec,duration){if(initSegment&&initSegment.byteLength){var initData=this.initData=MP4Demuxer.parseInitSegment(initSegment);null==audioCodec&&(audioCodec="mp4a.40.5"),null==videoCodec&&(videoCodec="avc1.42e01e");var tracks={};initData.audio&&initData.video?tracks.audiovideo={container:"video/mp4",codec:audioCodec+","+videoCodec,initSegment:duration?initSegment:null}:(initData.audio&&(tracks.audio={container:"audio/mp4",codec:audioCodec,initSegment:duration?initSegment:null}),initData.video&&(tracks.video={container:"video/mp4",codec:videoCodec,initSegment:duration?initSegment:null})),this.observer.trigger(events.a.FRAG_PARSING_INIT_SEGMENT,{tracks:tracks})}else audioCodec&&(this.audioCodec=audioCodec),videoCodec&&(this.videoCodec=videoCodec)},MP4Demuxer.probe=function(data){return MP4Demuxer.findBox({data:data,start:0,end:Math.min(data.length,16384)},["moof"]).length>0},MP4Demuxer.bin2str=function(buffer){return String.fromCharCode.apply(null,buffer)},MP4Demuxer.readUint32=function(buffer,offset){buffer.data&&(offset+=buffer.start,buffer=buffer.data);var val=buffer[offset]<<24|buffer[offset+1]<<16|buffer[offset+2]<<8|buffer[offset+3];return val<0?4294967296+val:val},MP4Demuxer.writeUint32=function(buffer,offset,value){buffer.data&&(offset+=buffer.start,buffer=buffer.data),buffer[offset]=value>>24,buffer[offset+1]=value>>16&255,buffer[offset+2]=value>>8&255,buffer[offset+3]=255&value},MP4Demuxer.findBox=function(data,path){var i,size,type,end,subresults,start,endbox,results=[];if(data.data?(start=data.start,end=data.end,data=data.data):(start=0,end=data.byteLength),!path.length)return null;for(i=start;i<end;)size=MP4Demuxer.readUint32(data,i),type=MP4Demuxer.bin2str(data.subarray(i+4,i+8)),endbox=size>1?i+size:end,type===path[0]&&(1===path.length?results.push({data:data,start:i+8,end:endbox}):(subresults=MP4Demuxer.findBox({data:data,start:i+8,end:endbox},path.slice(1)),subresults.length&&(results=results.concat(subresults)))),i=endbox;return results},MP4Demuxer.parseInitSegment=function(initSegment){var result=[];return MP4Demuxer.findBox(initSegment,["moov","trak"]).forEach(function(trak){var tkhd=MP4Demuxer.findBox(trak,["tkhd"])[0];if(tkhd){var version=tkhd.data[tkhd.start],index=0===version?12:20,trackId=MP4Demuxer.readUint32(tkhd,index),mdhd=MP4Demuxer.findBox(trak,["mdia","mdhd"])[0];if(mdhd){version=mdhd.data[mdhd.start],index=0===version?12:20;var timescale=MP4Demuxer.readUint32(mdhd,index),hdlr=MP4Demuxer.findBox(trak,["mdia","hdlr"])[0];if(hdlr){var hdlrType=MP4Demuxer.bin2str(hdlr.data.subarray(hdlr.start+8,hdlr.start+12)),type={soun:"audio",vide:"video"}[hdlrType];if(type){var codecBox=MP4Demuxer.findBox(trak,["mdia","minf","stbl","stsd"]);if(codecBox.length){codecBox=codecBox[0];var codecType=MP4Demuxer.bin2str(codecBox.data.subarray(codecBox.start+12,codecBox.start+16));logger.b.log("MP4Demuxer:"+type+":"+codecType+" found")}result[trackId]={timescale:timescale,type:type},result[type]={timescale:timescale,id:trackId}}}}}}),result},MP4Demuxer.getStartDTS=function(initData,fragment){var trafs,baseTimes,result;return trafs=MP4Demuxer.findBox(fragment,["moof","traf"]),baseTimes=[].concat.apply([],trafs.map(function(traf){return MP4Demuxer.findBox(traf,["tfhd"]).map(function(tfhd){var id,scale;return id=MP4Demuxer.readUint32(tfhd,4),scale=initData[id].timescale||9e4,MP4Demuxer.findBox(traf,["tfdt"]).map(function(tfdt){var version,result;return version=tfdt.data[tfdt.start],result=MP4Demuxer.readUint32(tfdt,4),1===version&&(result*=Math.pow(2,32),result+=MP4Demuxer.readUint32(tfdt,8)),result})[0]/scale})})),result=Math.min.apply(null,baseTimes),isFinite(result)?result:0},MP4Demuxer.offsetStartDTS=function(initData,fragment,timeOffset){MP4Demuxer.findBox(fragment,["moof","traf"]).map(function(traf){return MP4Demuxer.findBox(traf,["tfhd"]).map(function(tfhd){var id=MP4Demuxer.readUint32(tfhd,4),timescale=initData[id].timescale||9e4;MP4Demuxer.findBox(traf,["tfdt"]).map(function(tfdt){var version=tfdt.data[tfdt.start],baseMediaDecodeTime=MP4Demuxer.readUint32(tfdt,4);if(0===version)MP4Demuxer.writeUint32(tfdt,4,baseMediaDecodeTime-timeOffset*timescale);else{baseMediaDecodeTime*=Math.pow(2,32),baseMediaDecodeTime+=MP4Demuxer.readUint32(tfdt,8),baseMediaDecodeTime-=timeOffset*timescale,baseMediaDecodeTime=Math.max(baseMediaDecodeTime,0);var upper=Math.floor(baseMediaDecodeTime/(UINT32_MAX+1)),lower=Math.floor(baseMediaDecodeTime%(UINT32_MAX+1));MP4Demuxer.writeUint32(tfdt,4,upper),MP4Demuxer.writeUint32(tfdt,8,lower)}})})})},MP4Demuxer.prototype.append=function(data,timeOffset,contiguous,accurateTimeOffset){var initData=this.initData;initData||(this.resetInitSegment(data,this.audioCodec,this.videoCodec),initData=this.initData);var startDTS=void 0,initPTS=this.initPTS;if(void 0===initPTS){var _startDTS=MP4Demuxer.getStartDTS(initData,data);this.initPTS=initPTS=_startDTS-timeOffset,this.observer.trigger(events.a.INIT_PTS_FOUND,{initPTS:initPTS})}MP4Demuxer.offsetStartDTS(initData,data,initPTS),startDTS=MP4Demuxer.getStartDTS(initData,data),this.remuxer.remux(initData.audio,initData.video,null,null,startDTS,contiguous,accurateTimeOffset,data)},MP4Demuxer.prototype.destroy=function(){},MP4Demuxer}(),mp4demuxer=mp4demuxer_MP4Demuxer,MpegAudio={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],appendFrame:function(track,data,offset,pts,frameIndex){if(!(offset+24>data.length)){var header=this.parseHeader(data,offset);if(header&&offset+header.frameLength<=data.length){var frameDuration=10368e4/header.sampleRate,stamp=pts+frameIndex*frameDuration,sample={unit:data.subarray(offset,offset+header.frameLength),pts:stamp,dts:stamp};return track.config=[],track.channelCount=header.channelCount,track.samplerate=header.sampleRate,track.samples.push(sample),track.len+=header.frameLength,{sample:sample,length:header.frameLength}}}},parseHeader:function(data,offset){var headerB=data[offset+1]>>3&3,headerC=data[offset+1]>>1&3,headerE=data[offset+2]>>4&15,headerF=data[offset+2]>>2&3,headerG=!!(2&data[offset+2]);if(1!==headerB&&0!==headerE&&15!==headerE&&3!==headerF){var columnInBitrates=3===headerB?3-headerC:3===headerC?3:4,bitRate=1e3*MpegAudio.BitratesMap[14*columnInBitrates+headerE-1],columnInSampleRates=3===headerB?0:2===headerB?1:2,sampleRate=MpegAudio.SamplingRateMap[3*columnInSampleRates+headerF],padding=headerG?1:0;return{sampleRate:sampleRate,channelCount:data[offset+3]>>6==3?1:2,frameLength:3===headerC?(3===headerB?12:6)*bitRate/sampleRate+padding<<2:(3===headerB?144:72)*bitRate/sampleRate+padding|0}}},isHeaderPattern:function(data,offset){return 255===data[offset]&&224==(224&data[offset+1])&&0!=(6&data[offset+1])},isHeader:function(data,offset){return!!(offset+1<data.length&&this.isHeaderPattern(data,offset))},probe:function(data,offset){if(offset+1<data.length&&this.isHeaderPattern(data,offset)){var header=this.parseHeader(data,offset),frameLength=4;header&&header.frameLength&&(frameLength=header.frameLength);var newOffset=offset+frameLength;if(newOffset===data.length||newOffset+1<data.length&&this.isHeaderPattern(data,newOffset))return!0}return!1}},mpegaudio=MpegAudio,exp_golomb_ExpGolomb=function(){function ExpGolomb(data){exp_golomb__classCallCheck(this,ExpGolomb),this.data=data,this.bytesAvailable=data.byteLength,this.word=0,this.bitsAvailable=0}return ExpGolomb.prototype.loadWord=function(){var data=this.data,bytesAvailable=this.bytesAvailable,position=data.byteLength-bytesAvailable,workingBytes=new Uint8Array(4),availableBytes=Math.min(4,bytesAvailable);if(0===availableBytes)throw new Error("no bytes available");workingBytes.set(data.subarray(position,position+availableBytes)),this.word=new DataView(workingBytes.buffer).getUint32(0),this.bitsAvailable=8*availableBytes,this.bytesAvailable-=availableBytes},ExpGolomb.prototype.skipBits=function(count){var skipBytes;this.bitsAvailable>count?(this.word<<=count,this.bitsAvailable-=count):(count-=this.bitsAvailable,skipBytes=count>>3,count-=skipBytes>>3,this.bytesAvailable-=skipBytes,this.loadWord(),this.word<<=count,this.bitsAvailable-=count)},ExpGolomb.prototype.readBits=function(size){var bits=Math.min(this.bitsAvailable,size),valu=this.word>>>32-bits;return size>32&&logger.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=bits,this.bitsAvailable>0?this.word<<=bits:this.bytesAvailable>0&&this.loadWord(),bits=size-bits,bits>0&&this.bitsAvailable?valu<<bits|this.readBits(bits):valu},ExpGolomb.prototype.skipLZ=function(){var leadingZeroCount;for(leadingZeroCount=0;leadingZeroCount<this.bitsAvailable;++leadingZeroCount)if(0!=(this.word&2147483648>>>leadingZeroCount))return this.word<<=leadingZeroCount,this.bitsAvailable-=leadingZeroCount,leadingZeroCount;return this.loadWord(),leadingZeroCount+this.skipLZ()},ExpGolomb.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},ExpGolomb.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},ExpGolomb.prototype.readUEG=function(){var clz=this.skipLZ();return this.readBits(clz+1)-1},ExpGolomb.prototype.readEG=function(){var valu=this.readUEG();return 1&valu?1+valu>>>1:-1*(valu>>>1)},ExpGolomb.prototype.readBoolean=function(){return 1===this.readBits(1)},ExpGolomb.prototype.readUByte=function(){return this.readBits(8)},ExpGolomb.prototype.readUShort=function(){return this.readBits(16)},ExpGolomb.prototype.readUInt=function(){return this.readBits(32)},ExpGolomb.prototype.skipScalingList=function(count){var j,deltaScale,lastScale=8,nextScale=8;for(j=0;j<count;j++)0!==nextScale&&(deltaScale=this.readEG(),nextScale=(lastScale+deltaScale+256)%256),lastScale=0===nextScale?lastScale:nextScale},ExpGolomb.prototype.readSPS=function(){var profileIdc,numRefFramesInPicOrderCntCycle,picWidthInMbsMinus1,picHeightInMapUnitsMinus1,frameMbsOnlyFlag,scalingListCount,i,frameCropLeftOffset=0,frameCropRightOffset=0,frameCropTopOffset=0,frameCropBottomOffset=0,readUByte=this.readUByte.bind(this),readBits=this.readBits.bind(this),readUEG=this.readUEG.bind(this),readBoolean=this.readBoolean.bind(this),skipBits=this.skipBits.bind(this),skipEG=this.skipEG.bind(this),skipUEG=this.skipUEG.bind(this),skipScalingList=this.skipScalingList.bind(this);if(readUByte(),profileIdc=readUByte(),readBits(5),skipBits(3),readUByte(),skipUEG(),100===profileIdc||110===profileIdc||122===profileIdc||244===profileIdc||44===profileIdc||83===profileIdc||86===profileIdc||118===profileIdc||128===profileIdc){var chromaFormatIdc=readUEG();if(3===chromaFormatIdc&&skipBits(1),skipUEG(),skipUEG(),skipBits(1),readBoolean())for(scalingListCount=3!==chromaFormatIdc?8:12,i=0;i<scalingListCount;i++)readBoolean()&&skipScalingList(i<6?16:64)}skipUEG();var picOrderCntType=readUEG();if(0===picOrderCntType)readUEG();else if(1===picOrderCntType)for(skipBits(1),skipEG(),skipEG(),numRefFramesInPicOrderCntCycle=readUEG(),i=0;i<numRefFramesInPicOrderCntCycle;i++)skipEG();skipUEG(),skipBits(1),picWidthInMbsMinus1=readUEG(),picHeightInMapUnitsMinus1=readUEG(),frameMbsOnlyFlag=readBits(1),0===frameMbsOnlyFlag&&skipBits(1),skipBits(1),readBoolean()&&(frameCropLeftOffset=readUEG(),frameCropRightOffset=readUEG(),frameCropTopOffset=readUEG(),frameCropBottomOffset=readUEG());var pixelRatio=[1,1];if(readBoolean()&&readBoolean()){switch(readUByte()){case 1:pixelRatio=[1,1];break;case 2:pixelRatio=[12,11];break;case 3:pixelRatio=[10,11];break;case 4:pixelRatio=[16,11];break;case 5:pixelRatio=[40,33];break;case 6:pixelRatio=[24,11];break;case 7:pixelRatio=[20,11];break;case 8:pixelRatio=[32,11];break;case 9:pixelRatio=[80,33];break;case 10:pixelRatio=[18,11];break;case 11:pixelRatio=[15,11];break;case 12:pixelRatio=[64,33];break;case 13:pixelRatio=[160,99];break;case 14:pixelRatio=[4,3];break;case 15:pixelRatio=[3,2];break;case 16:pixelRatio=[2,1];break;case 255:pixelRatio=[readUByte()<<8|readUByte(),readUByte()<<8|readUByte()]}}return{width:Math.ceil(16*(picWidthInMbsMinus1+1)-2*frameCropLeftOffset-2*frameCropRightOffset),height:(2-frameMbsOnlyFlag)*(picHeightInMapUnitsMinus1+1)*16-(frameMbsOnlyFlag?2:4)*(frameCropTopOffset+frameCropBottomOffset),pixelRatio:pixelRatio}},ExpGolomb.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},ExpGolomb}(),exp_golomb=exp_golomb_ExpGolomb,sample_aes_SampleAesDecrypter=function(){function SampleAesDecrypter(observer,config,decryptdata,discardEPB){sample_aes__classCallCheck(this,SampleAesDecrypter),this.decryptdata=decryptdata,this.discardEPB=discardEPB,this.decrypter=new crypt_decrypter(observer,config)}return SampleAesDecrypter.prototype.decryptBuffer=function(encryptedData,callback){this.decrypter.decrypt(encryptedData,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,callback)},SampleAesDecrypter.prototype.decryptAacSample=function(samples,sampleIndex,callback,sync){var curUnit=samples[sampleIndex].unit,encryptedData=curUnit.subarray(16,curUnit.length-curUnit.length%16),encryptedBuffer=encryptedData.buffer.slice(encryptedData.byteOffset,encryptedData.byteOffset+encryptedData.length),localthis=this;this.decryptBuffer(encryptedBuffer,function(decryptedData){decryptedData=new Uint8Array(decryptedData),curUnit.set(decryptedData,16),sync||localthis.decryptAacSamples(samples,sampleIndex+1,callback)})},SampleAesDecrypter.prototype.decryptAacSamples=function(samples,sampleIndex,callback){for(;;sampleIndex++){if(sampleIndex>=samples.length)return void callback();if(!(samples[sampleIndex].unit.length<32)){var sync=this.decrypter.isSync();if(this.decryptAacSample(samples,sampleIndex,callback,sync),!sync)return}}},SampleAesDecrypter.prototype.getAvcEncryptedData=function(decodedData){for(var encryptedDataLen=16*Math.floor((decodedData.length-48)/160)+16,encryptedData=new Int8Array(encryptedDataLen),outputPos=0,inputPos=32;inputPos<=decodedData.length-16;inputPos+=160,outputPos+=16)encryptedData.set(decodedData.subarray(inputPos,inputPos+16),outputPos);return encryptedData},SampleAesDecrypter.prototype.getAvcDecryptedUnit=function(decodedData,decryptedData){decryptedData=new Uint8Array(decryptedData);for(var inputPos=0,outputPos=32;outputPos<=decodedData.length-16;outputPos+=160,inputPos+=16)decodedData.set(decryptedData.subarray(inputPos,inputPos+16),outputPos);return decodedData},SampleAesDecrypter.prototype.decryptAvcSample=function(samples,sampleIndex,unitIndex,callback,curUnit,sync){var decodedData=this.discardEPB(curUnit.data),encryptedData=this.getAvcEncryptedData(decodedData),localthis=this;this.decryptBuffer(encryptedData.buffer,function(decryptedData){curUnit.data=localthis.getAvcDecryptedUnit(decodedData,decryptedData),sync||localthis.decryptAvcSamples(samples,sampleIndex,unitIndex+1,callback)})},SampleAesDecrypter.prototype.decryptAvcSamples=function(samples,sampleIndex,unitIndex,callback){for(;;sampleIndex++,unitIndex=0){if(sampleIndex>=samples.length)return void callback();for(var curUnits=samples[sampleIndex].units;!(unitIndex>=curUnits.length);unitIndex++){var curUnit=curUnits[unitIndex];if(!(curUnit.length<=48||1!==curUnit.type&&5!==curUnit.type)){var sync=this.decrypter.isSync();if(this.decryptAvcSample(samples,sampleIndex,unitIndex,callback,curUnit,sync),!sync)return}}}},SampleAesDecrypter}(),sample_aes=sample_aes_SampleAesDecrypter,RemuxerTrackIdConfig={video:0,audio:1,id3:2,text:3},tsdemuxer_TSDemuxer=function(){function TSDemuxer(observer,remuxer,config,typeSupported){tsdemuxer__classCallCheck(this,TSDemuxer),this.observer=observer,this.config=config,this.typeSupported=typeSupported,this.remuxer=remuxer,this.sampleAes=null}return TSDemuxer.prototype.setDecryptData=function(decryptdata){null!=decryptdata&&null!=decryptdata.key&&"SAMPLE-AES"===decryptdata.method?this.sampleAes=new sample_aes(this.observer,this.config,decryptdata,this.discardEPB):this.sampleAes=null},TSDemuxer.probe=function(data){var syncOffset=TSDemuxer._syncOffset(data);return!(syncOffset<0)&&(syncOffset&&logger.b.warn("MPEG2-TS detected but first sync word found @ offset "+syncOffset+", junk ahead ?"),!0)},TSDemuxer._syncOffset=function(data){for(var scanwindow=Math.min(1e3,data.length-564),i=0;i<scanwindow;){if(71===data[i]&&71===data[i+188]&&71===data[i+376])return i;i++}return-1},TSDemuxer.createTrack=function(type,duration){return{container:"video"===type||"audio"===type?"video/mp2t":void 0,type:type,id:RemuxerTrackIdConfig[type],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===type?0:void 0,isAAC:"audio"===type||void 0,duration:"audio"===type?duration:void 0}},TSDemuxer.prototype.resetInitSegment=function(initSegment,audioCodec,videoCodec,duration){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=TSDemuxer.createTrack("video",duration),this._audioTrack=TSDemuxer.createTrack("audio",duration),this._id3Track=TSDemuxer.createTrack("id3",duration),this._txtTrack=TSDemuxer.createTrack("text",duration),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=audioCodec,this.videoCodec=videoCodec,this._duration=duration},TSDemuxer.prototype.resetTimeStamp=function(){},TSDemuxer.prototype.append=function(data,timeOffset,contiguous,accurateTimeOffset){var start,stt,pid,offset,pes,len=data.length,unknownPIDs=!1;this.contiguous=contiguous;var pmtParsed=this.pmtParsed,avcTrack=this._avcTrack,audioTrack=this._audioTrack,id3Track=this._id3Track,avcId=avcTrack.pid,audioId=audioTrack.pid,id3Id=id3Track.pid,pmtId=this._pmtId,avcData=avcTrack.pesData,audioData=audioTrack.pesData,id3Data=id3Track.pesData,parsePAT=this._parsePAT,parsePMT=this._parsePMT,parsePES=this._parsePES,parseAVCPES=this._parseAVCPES.bind(this),parseAACPES=this._parseAACPES.bind(this),parseMPEGPES=this._parseMPEGPES.bind(this),parseID3PES=this._parseID3PES.bind(this),syncOffset=TSDemuxer._syncOffset(data);for(len-=(len+syncOffset)%188,start=syncOffset;start<len;start+=188)if(71===data[start]){if(stt=!!(64&data[start+1]),pid=((31&data[start+1])<<8)+data[start+2],(48&data[start+3])>>4>1){if((offset=start+5+data[start+4])===start+188)continue}else offset=start+4;switch(pid){case avcId:stt&&(avcData&&(pes=parsePES(avcData))&&parseAVCPES(pes,!1),avcData={data:[],size:0}),avcData&&(avcData.data.push(data.subarray(offset,start+188)),avcData.size+=start+188-offset);break;case audioId:stt&&(audioData&&(pes=parsePES(audioData))&&(audioTrack.isAAC?parseAACPES(pes):parseMPEGPES(pes)),audioData={data:[],size:0}),audioData&&(audioData.data.push(data.subarray(offset,start+188)),audioData.size+=start+188-offset);break;case id3Id:stt&&(id3Data&&(pes=parsePES(id3Data))&&parseID3PES(pes),id3Data={data:[],size:0}),id3Data&&(id3Data.data.push(data.subarray(offset,start+188)),id3Data.size+=start+188-offset);break;case 0:stt&&(offset+=data[offset]+1),pmtId=this._pmtId=parsePAT(data,offset);break;case pmtId:stt&&(offset+=data[offset]+1);var parsedPIDs=parsePMT(data,offset,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);avcId=parsedPIDs.avc,avcId>0&&(avcTrack.pid=avcId),audioId=parsedPIDs.audio,audioId>0&&(audioTrack.pid=audioId,audioTrack.isAAC=parsedPIDs.isAAC),id3Id=parsedPIDs.id3,id3Id>0&&(id3Track.pid=id3Id),unknownPIDs&&!pmtParsed&&(logger.b.log("reparse from beginning"),unknownPIDs=!1,start=syncOffset-188),pmtParsed=this.pmtParsed=!0;break;case 17:case 8191:break;default:unknownPIDs=!0}}else this.observer.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});avcData&&(pes=parsePES(avcData))?(parseAVCPES(pes,!0),avcTrack.pesData=null):avcTrack.pesData=avcData,audioData&&(pes=parsePES(audioData))?(audioTrack.isAAC?parseAACPES(pes):parseMPEGPES(pes),audioTrack.pesData=null):(audioData&&audioData.size&&logger.b.log("last AAC PES packet truncated,might overlap between fragments"),audioTrack.pesData=audioData),id3Data&&(pes=parsePES(id3Data))?(parseID3PES(pes),id3Track.pesData=null):id3Track.pesData=id3Data,null==this.sampleAes?this.remuxer.remux(audioTrack,avcTrack,id3Track,this._txtTrack,timeOffset,contiguous,accurateTimeOffset):this.decryptAndRemux(audioTrack,avcTrack,id3Track,this._txtTrack,timeOffset,contiguous,accurateTimeOffset)},TSDemuxer.prototype.decryptAndRemux=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset){if(audioTrack.samples&&audioTrack.isAAC){var localthis=this;this.sampleAes.decryptAacSamples(audioTrack.samples,0,function(){localthis.decryptAndRemuxAvc(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)})}else this.decryptAndRemuxAvc(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)},TSDemuxer.prototype.decryptAndRemuxAvc=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset){if(videoTrack.samples){var localthis=this;this.sampleAes.decryptAvcSamples(videoTrack.samples,0,0,function(){localthis.remuxer.remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)})}else this.remuxer.remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)},TSDemuxer.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},TSDemuxer.prototype._parsePAT=function(data,offset){return(31&data[offset+10])<<8|data[offset+11]},TSDemuxer.prototype._parsePMT=function(data,offset,mpegSupported,isSampleAes){var sectionLength,tableEnd,programInfoLength,pid,result={audio:-1,avc:-1,id3:-1,isAAC:!0};for(sectionLength=(15&data[offset+1])<<8|data[offset+2],tableEnd=offset+3+sectionLength-4,programInfoLength=(15&data[offset+10])<<8|data[offset+11],offset+=12+programInfoLength;offset<tableEnd;){switch(pid=(31&data[offset+1])<<8|data[offset+2],data[offset]){case 207:if(!isSampleAes){logger.b.log("unkown stream type:"+data[offset]);break}case 15:-1===result.audio&&(result.audio=pid);break;case 21:-1===result.id3&&(result.id3=pid);break;case 219:if(!isSampleAes){logger.b.log("unkown stream type:"+data[offset]);break}case 27:-1===result.avc&&(result.avc=pid);break;case 3:case 4:mpegSupported?-1===result.audio&&(result.audio=pid,result.isAAC=!1):logger.b.log("MPEG audio found, not supported in this browser for now");break;case 36:logger.b.warn("HEVC stream type found, not supported for now");break;default:logger.b.log("unkown stream type:"+data[offset])}offset+=5+((15&data[offset+3])<<8|data[offset+4])}return result},TSDemuxer.prototype._parsePES=function(stream){var frag,pesFlags,pesLen,pesHdrLen,pesData,pesPts,pesDts,payloadStartOffset,i=0,data=stream.data;if(!stream||0===stream.size)return null;for(;data[0].length<19&&data.length>1;){var newData=new Uint8Array(data[0].length+data[1].length);newData.set(data[0]),newData.set(data[1],data[0].length),data[0]=newData,data.splice(1,1)}if(frag=data[0],1===(frag[0]<<16)+(frag[1]<<8)+frag[2]){if((pesLen=(frag[4]<<8)+frag[5])&&pesLen>stream.size-6)return null;pesFlags=frag[7],192&pesFlags&&(pesPts=536870912*(14&frag[9])+4194304*(255&frag[10])+16384*(254&frag[11])+128*(255&frag[12])+(254&frag[13])/2,pesPts>4294967295&&(pesPts-=8589934592),64&pesFlags?(pesDts=536870912*(14&frag[14])+4194304*(255&frag[15])+16384*(254&frag[16])+128*(255&frag[17])+(254&frag[18])/2,pesDts>4294967295&&(pesDts-=8589934592),pesPts-pesDts>54e5&&(logger.b.warn(Math.round((pesPts-pesDts)/9e4)+"s delta between PTS and DTS, align them"),pesPts=pesDts)):pesDts=pesPts),pesHdrLen=frag[8],payloadStartOffset=pesHdrLen+9,stream.size-=payloadStartOffset,pesData=new Uint8Array(stream.size);for(var j=0,dataLen=data.length;j<dataLen;j++){frag=data[j];var len=frag.byteLength;if(payloadStartOffset){if(payloadStartOffset>len){payloadStartOffset-=len;continue}frag=frag.subarray(payloadStartOffset),len-=payloadStartOffset,payloadStartOffset=0}pesData.set(frag,i),i+=len}return pesLen&&(pesLen-=pesHdrLen+3),{data:pesData,pts:pesPts,dts:pesDts,len:pesLen}}return null},TSDemuxer.prototype.pushAccesUnit=function(avcSample,avcTrack){if(avcSample.units.length&&avcSample.frame){var samples=avcTrack.samples,nbSamples=samples.length;!this.config.forceKeyFrameOnDiscontinuity||!0===avcSample.key||avcTrack.sps&&(nbSamples||this.contiguous)?(avcSample.id=nbSamples,samples.push(avcSample)):avcTrack.dropped++}avcSample.debug.length&&logger.b.log(avcSample.pts+"/"+avcSample.dts+":"+avcSample.debug)},TSDemuxer.prototype._parseAVCPES=function(pes,last){var expGolombDecoder,push,i,_this=this,track=this._avcTrack,units=this._parseAVCNALu(pes.data),avcSample=this.avcSample,spsfound=!1,pushAccesUnit=this.pushAccesUnit.bind(this),createAVCSample=function(key,pts,dts,debug){return{key:key,pts:pts,dts:dts,units:[],debug:debug}};pes.data=null,avcSample&&units.length&&!track.audFound&&(pushAccesUnit(avcSample,track),avcSample=this.avcSample=createAVCSample(!1,pes.pts,pes.dts,"")),units.forEach(function(unit){switch(unit.type){case 1:push=!0,avcSample||(avcSample=_this.avcSample=createAVCSample(!0,pes.pts,pes.dts,"")),avcSample.frame=!0;var data=unit.data;if(spsfound&&data.length>4){var sliceType=new exp_golomb(data).readSliceType();2!==sliceType&&4!==sliceType&&7!==sliceType&&9!==sliceType||(avcSample.key=!0)}break;case 5:push=!0,avcSample||(avcSample=_this.avcSample=createAVCSample(!0,pes.pts,pes.dts,"")),avcSample.key=!0,avcSample.frame=!0;break;case 6:push=!0,expGolombDecoder=new exp_golomb(_this.discardEPB(unit.data)),expGolombDecoder.readUByte();for(var payloadType=0,payloadSize=0,endOfCaptions=!1,b=0;!endOfCaptions&&expGolombDecoder.bytesAvailable>1;){payloadType=0;do{b=expGolombDecoder.readUByte(),payloadType+=b}while(255===b);payloadSize=0;do{b=expGolombDecoder.readUByte(),payloadSize+=b}while(255===b);if(4===payloadType&&0!==expGolombDecoder.bytesAvailable){endOfCaptions=!0;if(181===expGolombDecoder.readUByte()){if(49===expGolombDecoder.readUShort()){if(1195456820===expGolombDecoder.readUInt()){if(3===expGolombDecoder.readUByte()){var firstByte=expGolombDecoder.readUByte(),secondByte=expGolombDecoder.readUByte(),totalCCs=31&firstByte,byteArray=[firstByte,secondByte];for(i=0;i<totalCCs;i++)byteArray.push(expGolombDecoder.readUByte()),byteArray.push(expGolombDecoder.readUByte()),byteArray.push(expGolombDecoder.readUByte());_this._insertSampleInOrder(_this._txtTrack.samples,{type:3,pts:pes.pts,bytes:byteArray})}}}}}else if(payloadSize<expGolombDecoder.bytesAvailable)for(i=0;i<payloadSize;i++)expGolombDecoder.readUByte()}break;case 7:if(push=!0,spsfound=!0,!track.sps){expGolombDecoder=new exp_golomb(unit.data);var config=expGolombDecoder.readSPS();track.width=config.width,track.height=config.height,track.pixelRatio=config.pixelRatio,track.sps=[unit.data],track.duration=_this._duration;var codecarray=unit.data.subarray(1,4),codecstring="avc1.";for(i=0;i<3;i++){var h=codecarray[i].toString(16);h.length<2&&(h="0"+h),codecstring+=h}track.codec=codecstring}break;case 8:push=!0,track.pps||(track.pps=[unit.data]);break;case 9:push=!1,track.audFound=!0,avcSample&&pushAccesUnit(avcSample,track),avcSample=_this.avcSample=createAVCSample(!1,pes.pts,pes.dts,"");break;case 12:push=!1;break;default:push=!1,avcSample&&(avcSample.debug+="unknown NAL "+unit.type+" ")}if(avcSample&&push){avcSample.units.push(unit)}}),last&&avcSample&&(pushAccesUnit(avcSample,track),this.avcSample=null)},TSDemuxer.prototype._insertSampleInOrder=function(arr,data){var len=arr.length;if(len>0){if(data.pts>=arr[len-1].pts)arr.push(data);else for(var pos=len-1;pos>=0;pos--)if(data.pts<arr[pos].pts){arr.splice(pos,0,data);break}}else arr.push(data)},TSDemuxer.prototype._getLastNalUnit=function(){var avcSample=this.avcSample,lastUnit=void 0;if(!avcSample||0===avcSample.units.length){var track=this._avcTrack,samples=track.samples;avcSample=samples[samples.length-1]}if(avcSample){var units=avcSample.units;lastUnit=units[units.length-1]}return lastUnit},TSDemuxer.prototype._parseAVCNALu=function(array){var value,overflow,unit,unitType,lastUnitType,i=0,len=array.byteLength,track=this._avcTrack,state=track.naluState||0,lastState=state,units=[],lastUnitStart=-1;for(-1===state&&(lastUnitStart=0,lastUnitType=31&array[0],state=0,i=1);i<len;)if(value=array[i++],state)if(1!==state)if(value)if(1===value){if(lastUnitStart>=0)unit={data:array.subarray(lastUnitStart,i-state-1),type:lastUnitType},units.push(unit);else{var lastUnit=this._getLastNalUnit();if(lastUnit&&(lastState&&i<=4-lastState&&lastUnit.state&&(lastUnit.data=lastUnit.data.subarray(0,lastUnit.data.byteLength-lastState)),(overflow=i-state-1)>0)){var tmp=new Uint8Array(lastUnit.data.byteLength+overflow);tmp.set(lastUnit.data,0),tmp.set(array.subarray(0,overflow),lastUnit.data.byteLength),lastUnit.data=tmp}}i<len?(unitType=31&array[i],lastUnitStart=i,lastUnitType=unitType,state=0):state=-1}else state=0;else state=3;else state=value?0:2;else state=value?0:1;if(lastUnitStart>=0&&state>=0&&(unit={data:array.subarray(lastUnitStart,len),type:lastUnitType,state:state},units.push(unit)),0===units.length){var _lastUnit=this._getLastNalUnit();if(_lastUnit){var _tmp=new Uint8Array(_lastUnit.data.byteLength+array.byteLength);_tmp.set(_lastUnit.data,0),_tmp.set(array,_lastUnit.data.byteLength),_lastUnit.data=_tmp}}return track.naluState=state,units},TSDemuxer.prototype.discardEPB=function(data){for(var newLength,newData,length=data.byteLength,EPBPositions=[],i=1;i<length-2;)0===data[i]&&0===data[i+1]&&3===data[i+2]?(EPBPositions.push(i+2),i+=2):i++;if(0===EPBPositions.length)return data;newLength=length-EPBPositions.length,newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++)sourceIndex===EPBPositions[0]&&(sourceIndex++,EPBPositions.shift()),newData[i]=data[sourceIndex];return newData},TSDemuxer.prototype._parseAACPES=function(pes){var frameDuration,frameIndex,offset,stamp,len,track=this._audioTrack,data=pes.data,pts=pes.pts,aacOverFlow=this.aacOverFlow,aacLastPTS=this.aacLastPTS;if(aacOverFlow){var tmp=new Uint8Array(aacOverFlow.byteLength+data.byteLength);tmp.set(aacOverFlow,0),tmp.set(data,aacOverFlow.byteLength),data=tmp}for(offset=0,len=data.length;offset<len-1&&!isHeader(data,offset);offset++);if(offset){var reason,fatal;if(offset<len-1?(reason="AAC PES did not start with ADTS header,offset:"+offset,fatal=!1):(reason="no ADTS header found in AAC PES",fatal=!0),logger.b.warn("parsing error:"+reason),this.observer.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.FRAG_PARSING_ERROR,fatal:fatal,reason:reason}),fatal)return}if(initTrackConfig(track,this.observer,data,offset,this.audioCodec),frameIndex=0,frameDuration=getFrameDuration(track.samplerate),aacOverFlow&&aacLastPTS){var newPTS=aacLastPTS+frameDuration;Math.abs(newPTS-pts)>1&&(logger.b.log("AAC: align PTS for overlapping frames by "+Math.round((newPTS-pts)/90)),pts=newPTS)}for(;offset<len;)if(isHeader(data,offset)&&offset+5<len){var frame=appendFrame(track,data,offset,pts,frameIndex);if(!frame)break;offset+=frame.length,stamp=frame.sample.pts,frameIndex++}else offset++;aacOverFlow=offset<len?data.subarray(offset,len):null,this.aacOverFlow=aacOverFlow,this.aacLastPTS=stamp},TSDemuxer.prototype._parseMPEGPES=function(pes){for(var data=pes.data,length=data.length,frameIndex=0,offset=0,pts=pes.pts;offset<length;)if(mpegaudio.isHeader(data,offset)){var frame=mpegaudio.appendFrame(this._audioTrack,data,offset,pts,frameIndex);if(!frame)break;offset+=frame.length,frameIndex++}else offset++},TSDemuxer.prototype._parseID3PES=function(pes){this._id3Track.samples.push(pes)},TSDemuxer}(),tsdemuxer=tsdemuxer_TSDemuxer,mp3demuxer_MP3Demuxer=function(){function MP3Demuxer(observer,remuxer,config){mp3demuxer__classCallCheck(this,MP3Demuxer),this.observer=observer,this.config=config,this.remuxer=remuxer}return MP3Demuxer.prototype.resetInitSegment=function(initSegment,audioCodec,videoCodec,duration){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:audioCodec,duration:duration,inputTimeScale:9e4}},MP3Demuxer.prototype.resetTimeStamp=function(){},MP3Demuxer.probe=function(data){var offset,length,id3Data=id3.a.getID3Data(data,0);if(id3Data&&void 0!==id3.a.getTimeStamp(id3Data))for(offset=id3Data.length,length=Math.min(data.length-1,offset+100);offset<length;offset++)if(mpegaudio.probe(data,offset))return logger.b.log("MPEG Audio sync word found !"),!0;return!1},MP3Demuxer.prototype.append=function(data,timeOffset,contiguous,accurateTimeOffset){for(var id3Data=id3.a.getID3Data(data,0),pts=90*id3.a.getTimeStamp(id3Data),offset=id3Data.length,length=data.length,frameIndex=0,stamp=0,track=this._audioTrack,id3Samples=[{pts:pts,dts:pts,data:id3Data}];offset<length;)if(mpegaudio.isHeader(data,offset)){var frame=mpegaudio.appendFrame(track,data,offset,pts,frameIndex);if(!frame)break;offset+=frame.length,stamp=frame.sample.pts,frameIndex++}else id3.a.isHeader(data,offset)?(id3Data=id3.a.getID3Data(data,offset),id3Samples.push({pts:stamp,dts:stamp,data:id3Data}),offset+=id3Data.length):offset++;this.remuxer.remux(track,{samples:[]},{samples:id3Samples,inputTimeScale:9e4},{samples:[]},timeOffset,contiguous,accurateTimeOffset)},MP3Demuxer.prototype.destroy=function(){},MP3Demuxer}(),mp3demuxer=mp3demuxer_MP3Demuxer,AAC=function(){function AAC(){aac__classCallCheck(this,AAC)}return AAC.getSilentFrame=function(codec,channelCount){switch(codec){case"mp4a.40.2":if(1===channelCount)return new Uint8Array([0,200,0,128,35,128]);if(2===channelCount)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===channelCount)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===channelCount)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===channelCount)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},AAC}(),aac=AAC,mp4_generator_UINT32_MAX=Math.pow(2,32)-1,MP4=function(){function MP4(){mp4_generator__classCallCheck(this,MP4)}return MP4.init=function(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var i;for(i in MP4.types)MP4.types.hasOwnProperty(i)&&(MP4.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);var videoHdlr=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audioHdlr=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:videoHdlr,audio:audioHdlr};var dref=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),stco=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=stco,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var majorBrand=new Uint8Array([105,115,111,109]),avc1Brand=new Uint8Array([97,118,99,49]),minorVersion=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,majorBrand,minorVersion,majorBrand,avc1Brand),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,dref))},MP4.box=function(type){for(var result,payload=Array.prototype.slice.call(arguments,1),size=8,i=payload.length,len=i;i--;)size+=payload[i].byteLength;for(result=new Uint8Array(size),result[0]=size>>24&255,result[1]=size>>16&255,result[2]=size>>8&255,result[3]=255&size,result.set(type,4),i=0,size=8;i<len;i++)result.set(payload[i],size),size+=payload[i].byteLength;return result},MP4.hdlr=function(type){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[type])},MP4.mdat=function(data){return MP4.box(MP4.types.mdat,data)},MP4.mdhd=function(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(mp4_generator_UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(mp4_generator_UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,timescale>>24&255,timescale>>16&255,timescale>>8&255,255&timescale,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,85,196,0,0]))},MP4.mdia=function(track){return MP4.box(MP4.types.mdia,MP4.mdhd(track.timescale,track.duration),MP4.hdlr(track.type),MP4.minf(track))},MP4.mfhd=function(sequenceNumber){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,sequenceNumber>>24,sequenceNumber>>16&255,sequenceNumber>>8&255,255&sequenceNumber]))},MP4.minf=function(track){return"audio"===track.type?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(track)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(track))},MP4.moof=function(sn,baseMediaDecodeTime,track){return MP4.box(MP4.types.moof,MP4.mfhd(sn),MP4.traf(track,baseMediaDecodeTime))},MP4.moov=function(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=MP4.trak(tracks[i]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(tracks[0].timescale,tracks[0].duration)].concat(boxes).concat(MP4.mvex(tracks)))},MP4.mvex=function(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=MP4.trex(tracks[i]);return MP4.box.apply(null,[MP4.types.mvex].concat(boxes))},MP4.mvhd=function(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(mp4_generator_UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(mp4_generator_UINT32_MAX+1)),bytes=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,timescale>>24&255,timescale>>16&255,timescale>>8&255,255&timescale,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,bytes)},MP4.sdtp=function(track){var flags,i,samples=track.samples||[],bytes=new Uint8Array(4+samples.length);for(i=0;i<samples.length;i++)flags=samples[i].flags,bytes[i+4]=flags.dependsOn<<4|flags.isDependedOn<<2|flags.hasRedundancy;return MP4.box(MP4.types.sdtp,bytes)},MP4.stbl=function(track){return MP4.box(MP4.types.stbl,MP4.stsd(track),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))},MP4.avc1=function(track){var i,data,len,sps=[],pps=[];for(i=0;i<track.sps.length;i++)data=track.sps[i],len=data.byteLength,sps.push(len>>>8&255),sps.push(255&len),sps=sps.concat(Array.prototype.slice.call(data));for(i=0;i<track.pps.length;i++)data=track.pps[i],len=data.byteLength,pps.push(len>>>8&255),pps.push(255&len),pps=pps.concat(Array.prototype.slice.call(data));var avcc=MP4.box(MP4.types.avcC,new Uint8Array([1,sps[3],sps[4],sps[5],255,224|track.sps.length].concat(sps).concat([track.pps.length]).concat(pps))),width=track.width,height=track.height,hSpacing=track.pixelRatio[0],vSpacing=track.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,width>>8&255,255&width,height>>8&255,255&height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),avcc,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([hSpacing>>24,hSpacing>>16&255,hSpacing>>8&255,255&hSpacing,vSpacing>>24,vSpacing>>16&255,vSpacing>>8&255,255&vSpacing])))},MP4.esds=function(track){var configlen=track.config.length;return new Uint8Array([0,0,0,0,3,23+configlen,0,1,0,4,15+configlen,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([configlen]).concat(track.config).concat([6,1,2]))},MP4.mp4a=function(track){var samplerate=track.samplerate;return MP4.box(MP4.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,track.channelCount,0,16,0,0,0,0,samplerate>>8&255,255&samplerate,0,0]),MP4.box(MP4.types.esds,MP4.esds(track)))},MP4.mp3=function(track){var samplerate=track.samplerate;return MP4.box(MP4.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,track.channelCount,0,16,0,0,0,0,samplerate>>8&255,255&samplerate,0,0]))},MP4.stsd=function(track){return"audio"===track.type?track.isAAC||"mp3"!==track.codec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(track)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(track)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(track))},MP4.tkhd=function(track){var id=track.id,duration=track.duration*track.timescale,width=track.width,height=track.height,upperWordDuration=Math.floor(duration/(mp4_generator_UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(mp4_generator_UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,id>>24&255,id>>16&255,id>>8&255,255&id,0,0,0,0,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,width>>8&255,255&width,0,0,height>>8&255,255&height,0,0]))},MP4.traf=function(track,baseMediaDecodeTime){var sampleDependencyTable=MP4.sdtp(track),id=track.id,upperWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime/(mp4_generator_UINT32_MAX+1)),lowerWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime%(mp4_generator_UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,id>>24,id>>16&255,id>>8&255,255&id])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,upperWordBaseMediaDecodeTime>>24,upperWordBaseMediaDecodeTime>>16&255,upperWordBaseMediaDecodeTime>>8&255,255&upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime>>24,lowerWordBaseMediaDecodeTime>>16&255,lowerWordBaseMediaDecodeTime>>8&255,255&lowerWordBaseMediaDecodeTime])),MP4.trun(track,sampleDependencyTable.length+16+20+8+16+8+8),sampleDependencyTable)},MP4.trak=function(track){return track.duration=track.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(track),MP4.mdia(track))},MP4.trex=function(track){var id=track.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,id>>24,id>>16&255,id>>8&255,255&id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},MP4.trun=function(track,offset){var i,sample,duration,size,flags,cts,samples=track.samples||[],len=samples.length,arraylen=12+16*len,array=new Uint8Array(arraylen);for(offset+=8+arraylen,array.set([0,0,15,1,len>>>24&255,len>>>16&255,len>>>8&255,255&len,offset>>>24&255,offset>>>16&255,offset>>>8&255,255&offset],0),i=0;i<len;i++)sample=samples[i],duration=sample.duration,size=sample.size,flags=sample.flags,cts=sample.cts,array.set([duration>>>24&255,duration>>>16&255,duration>>>8&255,255&duration,size>>>24&255,size>>>16&255,size>>>8&255,255&size,flags.isLeading<<2|flags.dependsOn,flags.isDependedOn<<6|flags.hasRedundancy<<4|flags.paddingValue<<1|flags.isNonSync,61440&flags.degradPrio,15&flags.degradPrio,cts>>>24&255,cts>>>16&255,cts>>>8&255,255&cts],12+16*i);return MP4.box(MP4.types.trun,array)},MP4.initSegment=function(tracks){MP4.types||MP4.init();var result,movie=MP4.moov(tracks);return result=new Uint8Array(MP4.FTYP.byteLength+movie.byteLength),result.set(MP4.FTYP),result.set(movie,MP4.FTYP.byteLength),result},MP4}(),mp4_generator=MP4,mp4_remuxer_MP4Remuxer=function(){function MP4Remuxer(observer,config,typeSupported,vendor){mp4_remuxer__classCallCheck(this,MP4Remuxer),this.observer=observer,this.config=config,this.typeSupported=typeSupported;var userAgent=navigator.userAgent;this.isSafari=vendor&&vendor.indexOf("Apple")>-1&&userAgent&&!userAgent.match("CriOS"),this.ISGenerated=!1}return MP4Remuxer.prototype.destroy=function(){},MP4Remuxer.prototype.resetTimeStamp=function(defaultTimeStamp){this._initPTS=this._initDTS=defaultTimeStamp},MP4Remuxer.prototype.resetInitSegment=function(){this.ISGenerated=!1},MP4Remuxer.prototype.remux=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset){if(this.ISGenerated||this.generateIS(audioTrack,videoTrack,timeOffset),this.ISGenerated){var nbAudioSamples=audioTrack.samples.length,nbVideoSamples=videoTrack.samples.length,audioTimeOffset=timeOffset,videoTimeOffset=timeOffset;if(nbAudioSamples&&nbVideoSamples){var audiovideoDeltaDts=(audioTrack.samples[0].dts-videoTrack.samples[0].dts)/videoTrack.inputTimeScale;audioTimeOffset+=Math.max(0,audiovideoDeltaDts),videoTimeOffset+=Math.max(0,-audiovideoDeltaDts)}if(nbAudioSamples){audioTrack.timescale||(logger.b.warn("regenerate InitSegment as audio detected"),this.generateIS(audioTrack,videoTrack,timeOffset));var audioData=this.remuxAudio(audioTrack,audioTimeOffset,contiguous,accurateTimeOffset);if(nbVideoSamples){var audioTrackLength=void 0;audioData&&(audioTrackLength=audioData.endPTS-audioData.startPTS),videoTrack.timescale||(logger.b.warn("regenerate InitSegment as video detected"),this.generateIS(audioTrack,videoTrack,timeOffset)),this.remuxVideo(videoTrack,videoTimeOffset,contiguous,audioTrackLength,accurateTimeOffset)}}else{var videoData=void 0;nbVideoSamples&&(videoData=this.remuxVideo(videoTrack,videoTimeOffset,contiguous,accurateTimeOffset)),videoData&&audioTrack.codec&&this.remuxEmptyAudio(audioTrack,audioTimeOffset,contiguous,videoData)}}id3Track.samples.length&&this.remuxID3(id3Track,timeOffset),textTrack.samples.length&&this.remuxText(textTrack,timeOffset),this.observer.trigger(events.a.FRAG_PARSED)},MP4Remuxer.prototype.generateIS=function(audioTrack,videoTrack,timeOffset){var initPTS,initDTS,observer=this.observer,audioSamples=audioTrack.samples,videoSamples=videoTrack.samples,typeSupported=this.typeSupported,container="audio/mp4",tracks={},data={tracks:tracks},computePTSDTS=void 0===this._initPTS;if(computePTSDTS&&(initPTS=initDTS=1/0),audioTrack.config&&audioSamples.length&&(audioTrack.timescale=audioTrack.samplerate,logger.b.log("audio sampling rate : "+audioTrack.samplerate),audioTrack.isAAC||(typeSupported.mpeg?(container="audio/mpeg",audioTrack.codec=""):typeSupported.mp3&&(audioTrack.codec="mp3")),tracks.audio={container:container,codec:audioTrack.codec,initSegment:!audioTrack.isAAC&&typeSupported.mpeg?new Uint8Array:mp4_generator.initSegment([audioTrack]),metadata:{channelCount:audioTrack.channelCount}},computePTSDTS&&(initPTS=initDTS=audioSamples[0].pts-audioTrack.inputTimeScale*timeOffset)),videoTrack.sps&&videoTrack.pps&&videoSamples.length){var inputTimeScale=videoTrack.inputTimeScale;videoTrack.timescale=inputTimeScale,tracks.video={container:"video/mp4",codec:videoTrack.codec,initSegment:mp4_generator.initSegment([videoTrack]),metadata:{width:videoTrack.width,height:videoTrack.height}},computePTSDTS&&(initPTS=Math.min(initPTS,videoSamples[0].pts-inputTimeScale*timeOffset),initDTS=Math.min(initDTS,videoSamples[0].dts-inputTimeScale*timeOffset),this.observer.trigger(events.a.INIT_PTS_FOUND,{initPTS:initPTS}))}Object.keys(tracks).length?(observer.trigger(events.a.FRAG_PARSING_INIT_SEGMENT,data),this.ISGenerated=!0,computePTSDTS&&(this._initPTS=initPTS,this._initDTS=initDTS)):observer.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},MP4Remuxer.prototype.remuxVideo=function(track,timeOffset,contiguous,audioTrackLength,accurateTimeOffset){var mp4SampleDuration,mdat,moof,firstPTS,firstDTS,lastPTS,lastDTS,offset=8,timeScale=track.timescale,inputSamples=track.samples,outputSamples=[],nbSamples=inputSamples.length,ptsNormalize=this._PTSNormalize,initDTS=this._initDTS,nextAvcDts=this.nextAvcDts,isSafari=this.isSafari;isSafari&&(contiguous|=inputSamples.length&&nextAvcDts&&(accurateTimeOffset&&Math.abs(timeOffset-nextAvcDts/timeScale)<.1||Math.abs(inputSamples[0].pts-nextAvcDts-initDTS)<timeScale/5)),contiguous||(nextAvcDts=timeOffset*timeScale),inputSamples.forEach(function(sample){sample.pts=ptsNormalize(sample.pts-initDTS,nextAvcDts),sample.dts=ptsNormalize(sample.dts-initDTS,nextAvcDts)}),inputSamples.sort(function(a,b){var deltadts=a.dts-b.dts,deltapts=a.pts-b.pts;return deltadts||(deltapts||a.id-b.id)});var PTSDTSshift=inputSamples.reduce(function(prev,curr){return Math.max(Math.min(prev,curr.pts-curr.dts),-18e3)},0);if(PTSDTSshift<0){logger.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(PTSDTSshift/90)+" ms to overcome this issue");for(var i=0;i<inputSamples.length;i++)inputSamples[i].dts+=PTSDTSshift}var sample=inputSamples[0];firstDTS=Math.max(sample.dts,0),firstPTS=Math.max(sample.pts,0);var delta=Math.round((firstDTS-nextAvcDts)/90);contiguous&&delta&&(delta>1?logger.b.log("AVC:"+delta+" ms hole between fragments detected,filling it"):delta<-1&&logger.b.log("AVC:"+-delta+" ms overlapping between fragments detected"),firstDTS=nextAvcDts,inputSamples[0].dts=firstDTS,firstPTS=Math.max(firstPTS-delta,nextAvcDts),inputSamples[0].pts=firstPTS,logger.b.log("Video/PTS/DTS adjusted: "+Math.round(firstPTS/90)+"/"+Math.round(firstDTS/90)+",delta:"+delta+" ms")),sample=inputSamples[inputSamples.length-1],lastDTS=Math.max(sample.dts,0),lastPTS=Math.max(sample.pts,0,lastDTS),isSafari&&(mp4SampleDuration=Math.round((lastDTS-firstDTS)/(inputSamples.length-1)));for(var nbNalu=0,naluLen=0,_i=0;_i<nbSamples;_i++){for(var _sample=inputSamples[_i],units=_sample.units,nbUnits=units.length,sampleLen=0,j=0;j<nbUnits;j++)sampleLen+=units[j].data.length;naluLen+=sampleLen,nbNalu+=nbUnits,_sample.length=sampleLen,_sample.dts=isSafari?firstDTS+_i*mp4SampleDuration:Math.max(_sample.dts,firstDTS),_sample.pts=Math.max(_sample.pts,_sample.dts)}var mdatSize=naluLen+4*nbNalu+8;try{mdat=new Uint8Array(mdatSize)}catch(err){return void this.observer.trigger(events.a.ERROR,{type:errors.b.MUX_ERROR,details:errors.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:mdatSize,reason:"fail allocating video mdat "+mdatSize})}var view=new DataView(mdat.buffer);view.setUint32(0,mdatSize),mdat.set(mp4_generator.types.mdat,4);for(var _i2=0;_i2<nbSamples;_i2++){for(var avcSample=inputSamples[_i2],avcSampleUnits=avcSample.units,mp4SampleLength=0,compositionTimeOffset=void 0,_j=0,_nbUnits=avcSampleUnits.length;_j<_nbUnits;_j++){var unit=avcSampleUnits[_j],unitData=unit.data,unitDataLen=unit.data.byteLength;view.setUint32(offset,unitDataLen),offset+=4,mdat.set(unitData,offset),offset+=unitDataLen,mp4SampleLength+=4+unitDataLen}if(isSafari)compositionTimeOffset=Math.max(0,mp4SampleDuration*Math.round((avcSample.pts-avcSample.dts)/mp4SampleDuration));else{if(_i2<nbSamples-1)mp4SampleDuration=inputSamples[_i2+1].dts-avcSample.dts;else{var config=this.config,lastFrameDuration=avcSample.dts-inputSamples[_i2>0?_i2-1:_i2].dts;if(config.stretchShortVideoTrack){var maxBufferHole=config.maxBufferHole,maxSeekHole=config.maxSeekHole,gapTolerance=Math.floor(Math.min(maxBufferHole,maxSeekHole)*timeScale),deltaToFrameEnd=(audioTrackLength?firstPTS+audioTrackLength*timeScale:this.nextAudioPts)-avcSample.pts;deltaToFrameEnd>gapTolerance?(mp4SampleDuration=deltaToFrameEnd-lastFrameDuration,mp4SampleDuration<0&&(mp4SampleDuration=lastFrameDuration),logger.b.log("It is approximately "+deltaToFrameEnd/90+" ms to the next segment; using duration "+mp4SampleDuration/90+" ms for the last video frame.")):mp4SampleDuration=lastFrameDuration}else mp4SampleDuration=lastFrameDuration}compositionTimeOffset=Math.round(avcSample.pts-avcSample.dts)}outputSamples.push({size:mp4SampleLength,duration:mp4SampleDuration,cts:compositionTimeOffset,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:avcSample.key?2:1,isNonSync:avcSample.key?0:1}})}this.nextAvcDts=lastDTS+mp4SampleDuration;var dropped=track.dropped;if(track.len=0,track.nbNalu=0,track.dropped=0,outputSamples.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var flags=outputSamples[0].flags;flags.dependsOn=2,flags.isNonSync=0}track.samples=outputSamples,moof=mp4_generator.moof(track.sequenceNumber++,firstDTS,track),track.samples=[];var data={data1:moof,data2:mdat,startPTS:firstPTS/timeScale,endPTS:(lastPTS+mp4SampleDuration)/timeScale,startDTS:firstDTS/timeScale,endDTS:this.nextAvcDts/timeScale,type:"video",nb:outputSamples.length,dropped:dropped};return this.observer.trigger(events.a.FRAG_PARSING_DATA,data),data},MP4Remuxer.prototype.remuxAudio=function(track,timeOffset,contiguous,accurateTimeOffset){var offset,mp4Sample,fillFrame,mdat,moof,firstPTS,lastPTS,inputTimeScale=track.inputTimeScale,mp4timeScale=track.timescale,scaleFactor=inputTimeScale/mp4timeScale,mp4SampleDuration=track.isAAC?1024:1152,inputSampleDuration=mp4SampleDuration*scaleFactor,ptsNormalize=this._PTSNormalize,initDTS=this._initDTS,rawMPEG=!track.isAAC&&this.typeSupported.mpeg,inputSamples=track.samples,outputSamples=[],nextAudioPts=this.nextAudioPts;if(contiguous|=inputSamples.length&&nextAudioPts&&(accurateTimeOffset&&Math.abs(timeOffset-nextAudioPts/inputTimeScale)<.1||Math.abs(inputSamples[0].pts-nextAudioPts-initDTS)<20*inputSampleDuration),contiguous||(nextAudioPts=timeOffset*inputTimeScale),inputSamples.forEach(function(sample){sample.pts=sample.dts=ptsNormalize(sample.pts-initDTS,nextAudioPts)}),inputSamples.sort(function(a,b){return a.pts-b.pts}),accurateTimeOffset&&track.isAAC)for(var maxAudioFramesDrift=this.config.maxAudioFramesDrift,i=0,nextPts=nextAudioPts;i<inputSamples.length;){var delta,sample=inputSamples[i],pts=sample.pts;delta=pts-nextPts;var duration=Math.abs(1e3*delta/inputTimeScale);if(delta<=-maxAudioFramesDrift*inputSampleDuration)logger.b.warn("Dropping 1 audio frame @ "+(nextPts/inputTimeScale).toFixed(3)+"s due to "+Math.round(duration)+" ms overlap."),inputSamples.splice(i,1),track.len-=sample.unit.length;else if(delta>=maxAudioFramesDrift*inputSampleDuration&&duration<1e4&&nextPts){var missing=Math.round(delta/inputSampleDuration);logger.b.warn("Injecting "+missing+" audio frame @ "+(nextPts/inputTimeScale).toFixed(3)+"s due to "+Math.round(1e3*delta/inputTimeScale)+" ms gap.");for(var j=0;j<missing;j++){var newStamp=Math.max(nextPts,0);fillFrame=aac.getSilentFrame(track.manifestCodec||track.codec,track.channelCount),fillFrame||(logger.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),fillFrame=sample.unit.subarray()),inputSamples.splice(i,0,{unit:fillFrame,pts:newStamp,dts:newStamp}),track.len+=fillFrame.length,nextPts+=inputSampleDuration,i++}sample.pts=sample.dts=nextPts,nextPts+=inputSampleDuration,i++}else Math.abs(delta),sample.pts=sample.dts=nextPts,nextPts+=inputSampleDuration,i++}for(var _j2=0,_nbSamples=inputSamples.length;_j2<_nbSamples;_j2++){var audioSample=inputSamples[_j2],unit=audioSample.unit,_pts=audioSample.pts;if(void 0!==lastPTS)mp4Sample.duration=Math.round((_pts-lastPTS)/scaleFactor);else{var _delta=Math.round(1e3*(_pts-nextAudioPts)/inputTimeScale),numMissingFrames=0;if(contiguous&&track.isAAC&&_delta){if(_delta>0&&_delta<1e4)numMissingFrames=Math.round((_pts-nextAudioPts)/inputSampleDuration),logger.b.log(_delta+" ms hole between AAC samples detected,filling it"),numMissingFrames>0&&(fillFrame=aac.getSilentFrame(track.manifestCodec||track.codec,track.channelCount),fillFrame||(fillFrame=unit.subarray()),track.len+=numMissingFrames*fillFrame.length);else if(_delta<-12){logger.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(nextAudioPts/inputTimeScale).toFixed(3)+"s/"+(_pts/inputTimeScale).toFixed(3)+"s/"+-_delta+"ms"),track.len-=unit.byteLength;continue}_pts=nextAudioPts}if(firstPTS=Math.max(0,_pts),!(track.len>0))return;var mdatSize=rawMPEG?track.len:track.len+8;offset=rawMPEG?0:8;try{mdat=new Uint8Array(mdatSize)}catch(err){return void this.observer.trigger(events.a.ERROR,{type:errors.b.MUX_ERROR,details:errors.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:mdatSize,reason:"fail allocating audio mdat "+mdatSize})}if(!rawMPEG){new DataView(mdat.buffer).setUint32(0,mdatSize),mdat.set(mp4_generator.types.mdat,4)}for(var _i3=0;_i3<numMissingFrames;_i3++)fillFrame=aac.getSilentFrame(track.manifestCodec||track.codec,track.channelCount),fillFrame||(logger.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),fillFrame=unit.subarray()),mdat.set(fillFrame,offset),offset+=fillFrame.byteLength,mp4Sample={size:fillFrame.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},outputSamples.push(mp4Sample)}mdat.set(unit,offset);var unitLen=unit.byteLength;offset+=unitLen,mp4Sample={size:unitLen,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},outputSamples.push(mp4Sample),lastPTS=_pts}var lastSampleDuration=0,nbSamples=outputSamples.length;if(nbSamples>=2&&(lastSampleDuration=outputSamples[nbSamples-2].duration,mp4Sample.duration=lastSampleDuration),nbSamples){this.nextAudioPts=nextAudioPts=lastPTS+scaleFactor*lastSampleDuration,track.len=0,track.samples=outputSamples,moof=rawMPEG?new Uint8Array:mp4_generator.moof(track.sequenceNumber++,firstPTS/scaleFactor,track),track.samples=[];var start=firstPTS/inputTimeScale,end=nextAudioPts/inputTimeScale,audioData={data1:moof,data2:mdat,startPTS:start,endPTS:end,startDTS:start,endDTS:end,type:"audio",nb:nbSamples};return this.observer.trigger(events.a.FRAG_PARSING_DATA,audioData),audioData}return null},MP4Remuxer.prototype.remuxEmptyAudio=function(track,timeOffset,contiguous,videoData){var inputTimeScale=track.inputTimeScale,mp4timeScale=track.samplerate?track.samplerate:inputTimeScale,scaleFactor=inputTimeScale/mp4timeScale,nextAudioPts=this.nextAudioPts,startDTS=(void 0!==nextAudioPts?nextAudioPts:videoData.startDTS*inputTimeScale)+this._initDTS,endDTS=videoData.endDTS*inputTimeScale+this._initDTS,frameDuration=1024*scaleFactor,nbSamples=Math.ceil((endDTS-startDTS)/frameDuration),silentFrame=aac.getSilentFrame(track.manifestCodec||track.codec,track.channelCount);if(logger.b.warn("remux empty Audio"),!silentFrame)return void logger.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var samples=[],i=0;i<nbSamples;i++){var stamp=startDTS+i*frameDuration;samples.push({unit:silentFrame,pts:stamp,dts:stamp}),track.len+=silentFrame.length}track.samples=samples,this.remuxAudio(track,timeOffset,contiguous)},MP4Remuxer.prototype.remuxID3=function(track,timeOffset){var sample,length=track.samples.length,inputTimeScale=track.inputTimeScale,initPTS=this._initPTS,initDTS=this._initDTS;if(length){for(var index=0;index<length;index++)sample=track.samples[index],sample.pts=(sample.pts-initPTS)/inputTimeScale,sample.dts=(sample.dts-initDTS)/inputTimeScale;this.observer.trigger(events.a.FRAG_PARSING_METADATA,{samples:track.samples})}track.samples=[],timeOffset=timeOffset},MP4Remuxer.prototype.remuxText=function(track,timeOffset){track.samples.sort(function(a,b){return a.pts-b.pts});var sample,length=track.samples.length,inputTimeScale=track.inputTimeScale,initPTS=this._initPTS;if(length){for(var index=0;index<length;index++)sample=track.samples[index],sample.pts=(sample.pts-initPTS)/inputTimeScale;this.observer.trigger(events.a.FRAG_PARSING_USERDATA,{samples:track.samples})}track.samples=[],timeOffset=timeOffset},MP4Remuxer.prototype._PTSNormalize=function(value,reference){var offset;if(void 0===reference)return value;for(offset=reference<value?-8589934592:8589934592;Math.abs(value-reference)>4294967296;)value+=offset;return value},MP4Remuxer}(),mp4_remuxer=mp4_remuxer_MP4Remuxer,passthrough_remuxer_PassThroughRemuxer=function(){function PassThroughRemuxer(observer){passthrough_remuxer__classCallCheck(this,PassThroughRemuxer),this.observer=observer}return PassThroughRemuxer.prototype.destroy=function(){},PassThroughRemuxer.prototype.resetTimeStamp=function(){},PassThroughRemuxer.prototype.resetInitSegment=function(){},PassThroughRemuxer.prototype.remux=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset,rawData){var observer=this.observer,streamType="";audioTrack&&(streamType+="audio"),videoTrack&&(streamType+="video"),observer.trigger(events.a.FRAG_PARSING_DATA,{data1:rawData,startPTS:timeOffset,startDTS:timeOffset,type:streamType,nb:1,dropped:0}),observer.trigger(events.a.FRAG_PARSED)},PassThroughRemuxer}(),passthrough_remuxer=passthrough_remuxer_PassThroughRemuxer,demuxer_inline_DemuxerInline=function(){function DemuxerInline(observer,typeSupported,config,vendor){demuxer_inline__classCallCheck(this,DemuxerInline),this.observer=observer,this.typeSupported=typeSupported,this.config=config,this.vendor=vendor}return DemuxerInline.prototype.destroy=function(){var demuxer=this.demuxer;demuxer&&demuxer.destroy()},DemuxerInline.prototype.push=function(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS){if(data.byteLength>0&&null!=decryptdata&&null!=decryptdata.key&&"AES-128"===decryptdata.method){var decrypter=this.decrypter;null==decrypter&&(decrypter=this.decrypter=new crypt_decrypter(this.observer,this.config));var startTime,localthis=this;try{startTime=performance.now()}catch(error){startTime=Date.now()}decrypter.decrypt(data,decryptdata.key.buffer,decryptdata.iv.buffer,function(decryptedData){var endTime;try{endTime=performance.now()}catch(error){endTime=Date.now()}localthis.observer.trigger(events.a.FRAG_DECRYPTED,{stats:{tstart:startTime,tdecrypt:endTime}}),localthis.pushDecrypted(new Uint8Array(decryptedData),decryptdata,new Uint8Array(initSegment),audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)})}else this.pushDecrypted(new Uint8Array(data),decryptdata,new Uint8Array(initSegment),audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)},DemuxerInline.prototype.pushDecrypted=function(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS){var demuxer=this.demuxer;if(!demuxer||discontinuity&&!this.probe(data)){for(var observer=this.observer,typeSupported=this.typeSupported,config=this.config,muxConfig=[{demux:tsdemuxer,remux:mp4_remuxer},{demux:aacdemuxer,remux:mp4_remuxer},{demux:mp3demuxer,remux:mp4_remuxer},{demux:mp4demuxer,remux:passthrough_remuxer}],i=0,len=muxConfig.length;i<len;i++){var mux=muxConfig[i],probe=mux.demux.probe;if(probe(data)){var _remuxer=this.remuxer=new mux.remux(observer,config,typeSupported,this.vendor);demuxer=new mux.demux(observer,_remuxer,config,typeSupported),this.probe=probe;break}}if(!demuxer)return void observer.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=demuxer}var remuxer=this.remuxer;(discontinuity||trackSwitch)&&(demuxer.resetInitSegment(initSegment,audioCodec,videoCodec,duration),remuxer.resetInitSegment()),discontinuity&&(demuxer.resetTimeStamp(defaultInitPTS),remuxer.resetTimeStamp(defaultInitPTS)),"function"==typeof demuxer.setDecryptData&&demuxer.setDecryptData(decryptdata),demuxer.append(data,timeOffset,contiguous,accurateTimeOffset)},DemuxerInline}();__webpack_exports__.a=demuxer_inline_DemuxerInline},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function attr_list__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function isCodecType(codec,type){var typeCodes=sampleEntryCodesISO[type];return!!typeCodes&&!0===typeCodes[codec.slice(0,4)]}function isCodecSupportedInMp4(codec,type){return MediaSource.isTypeSupported((type||"video")+'/mp4;codecs="'+codec+'"')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function playlist_loader__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function findGroup(groups,mediaGroupId){if(!groups)return null;for(var matchingGroup=null,i=0;i<groups.length;i++){var group=groups[i];group.id===mediaGroupId&&(matchingGroup=group)}return matchingGroup}function fragment_loader__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function fragment_loader__possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function fragment_loader__inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function key_loader__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function key_loader__possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function key_loader__inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getMediaSource(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function demuxer__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function updatePTS(fragments,fromIdx,toIdx){var fragFrom=fragments[fromIdx],fragTo=fragments[toIdx],fragToPTS=fragTo.startPTS;isNaN(fragToPTS)?fragTo.start=toIdx>fromIdx?fragFrom.start+fragFrom.duration:Math.max(fragFrom.start-fragTo.duration,0):toIdx>fromIdx?(fragFrom.duration=fragToPTS-fragFrom.start,fragFrom.duration<0&&logger.b.warn("negative duration computed for frag "+fragFrom.sn+",level "+fragFrom.level+", there should be some duration drift between playlist and fragment!")):(fragTo.duration=fragFrom.start-fragToPTS,fragTo.duration<0&&logger.b.warn("negative duration computed for frag "+fragTo.sn+",level "+fragTo.level+", there should be some duration drift between playlist and fragment!"))}function updateFragPTSDTS(details,frag,startPTS,endPTS,startDTS,endDTS){var maxStartPTS=startPTS;if(!isNaN(frag.startPTS)){var deltaPTS=Math.abs(frag.startPTS-startPTS);isNaN(frag.deltaPTS)?frag.deltaPTS=deltaPTS:frag.deltaPTS=Math.max(deltaPTS,frag.deltaPTS),maxStartPTS=Math.max(startPTS,frag.startPTS),startPTS=Math.min(startPTS,frag.startPTS),endPTS=Math.max(endPTS,frag.endPTS),startDTS=Math.min(startDTS,frag.startDTS),endDTS=Math.max(endDTS,frag.endDTS)}var drift=startPTS-frag.start;frag.start=frag.startPTS=startPTS,frag.maxStartPTS=maxStartPTS,frag.endPTS=endPTS,frag.startDTS=startDTS,frag.endDTS=endDTS,frag.duration=endPTS-startPTS;var sn=frag.sn;if(!details||sn<details.startSN||sn>details.endSN)return 0;var fragIdx,fragments,i;for(fragIdx=sn-details.startSN,fragments=details.fragments,fragments[fragIdx]=frag,i=fragIdx;i>0;i--)updatePTS(fragments,i,i-1);for(i=fragIdx;i<fragments.length-1;i++)updatePTS(fragments,i,i+1);return details.PTSKnown=!0,drift}function mergeDetails(oldDetails,newDetails){var PTSFrag,start=Math.max(oldDetails.startSN,newDetails.startSN)-newDetails.startSN,end=Math.min(oldDetails.endSN,newDetails.endSN)-newDetails.startSN,delta=newDetails.startSN-oldDetails.startSN,oldfragments=oldDetails.fragments,newfragments=newDetails.fragments,ccOffset=0;if(end<start)return void(newDetails.PTSKnown=!1);for(var i=start;i<=end;i++){var oldFrag=oldfragments[delta+i],newFrag=newfragments[i];newFrag&&oldFrag&&(ccOffset=oldFrag.cc-newFrag.cc,isNaN(oldFrag.startPTS)||(newFrag.start=newFrag.startPTS=oldFrag.startPTS,newFrag.endPTS=oldFrag.endPTS,newFrag.duration=oldFrag.duration,newFrag.backtracked=oldFrag.backtracked,newFrag.dropped=oldFrag.dropped,PTSFrag=newFrag))}if(ccOffset)for(logger.b.log("discontinuity sliding from playlist, take drift into account"),i=0;i<newfragments.length;i++)newfragments[i].cc+=ccOffset;if(PTSFrag)updateFragPTSDTS(newDetails,PTSFrag,PTSFrag.startPTS,PTSFrag.endPTS,PTSFrag.startDTS,PTSFrag.endDTS);else if(delta>=0&&delta<oldfragments.length){var sliding=oldfragments[delta].start;for(i=0;i<newfragments.length;i++)newfragments[i].start+=sliding}newDetails.PTSKnown=oldDetails.PTSKnown}function findFirstFragWithCC(fragments,cc){for(var firstFrag=null,i=0;i<fragments.length;i+=1){var currentFrag=fragments[i];if(currentFrag&&currentFrag.cc===cc){firstFrag=currentFrag;break}}return firstFrag}function shouldAlignOnDiscontinuities(lastFrag,lastLevel,details){var shouldAlign=!1;return lastLevel&&lastLevel.details&&details&&(details.endCC>details.startCC||lastFrag&&lastFrag.cc<details.startCC)&&(shouldAlign=!0),shouldAlign}function findDiscontinuousReferenceFrag(prevDetails,curDetails){var prevFrags=prevDetails.fragments,curFrags=curDetails.fragments;if(!curFrags.length||!prevFrags.length)return void logger.b.log("No fragments to align");var prevStartFrag=findFirstFragWithCC(prevFrags,curFrags[0].cc);return!prevStartFrag||prevStartFrag&&!prevStartFrag.startPTS?void logger.b.log("No frag in previous level to align on"):prevStartFrag}function adjustPts(sliding,details){details.fragments.forEach(function(frag){if(frag){var start=frag.start+sliding;frag.start=frag.startPTS=start,frag.endPTS=start+frag.duration}}),details.PTSKnown=!0}function alignDiscontinuities(lastFrag,lastLevel,details){if(shouldAlignOnDiscontinuities(lastFrag,lastLevel,details)){var referenceFrag=findDiscontinuousReferenceFrag(lastLevel.details,details);referenceFrag&&(logger.b.log("Adjusting PTS using last level due to CC increase within current level"),adjustPts(referenceFrag.start,details))}if(!1===details.PTSKnown&&lastLevel&&lastLevel.details){var lastPDT=lastLevel.details.programDateTime,newPDT=details.programDateTime,sliding=(newPDT-lastPDT)/1e3+lastLevel.details.fragments[0].start;isNaN(sliding)||(logger.b.log("adjusting PTS using programDateTime delta, sliding:"+sliding.toFixed(3)),adjustPts(sliding,details))}}function stream_controller__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function stream_controller__possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function stream_controller__inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function level_controller__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function level_controller__possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function level_controller__inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function id3_track_controller__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function id3_track_controller__possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function id3_track_controller__inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function ewma__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function ewma_bandwidth_estimator__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function abr_controller__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function abr_controller__possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function abr_controller__inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function buffer_controller__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function buffer_controller__possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function buffer_controller__inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function cap_level_controller__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function cap_level_controller__possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function cap_level_controller__inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function fps_controller__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function fps_controller__possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function fps_controller__inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function xhr_loader__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function hls__classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var url_toolkit=__webpack_require__(6),url_toolkit_default=__webpack_require__.n(url_toolkit),events=__webpack_require__(1),errors=__webpack_require__(2),logger=__webpack_require__(0),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},event_handler_EventHandler=function(){function EventHandler(hls){_classCallCheck(this,EventHandler),this.hls=hls,this.onEvent=this.onEvent.bind(this);for(var _len=arguments.length,events=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)events[_key-1]=arguments[_key];this.handledEvents=events,this.useGenericHandler=!0,this.registerListeners()}return EventHandler.prototype.destroy=function(){this.unregisterListeners()},EventHandler.prototype.isEventHandler=function(){return"object"===_typeof(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},EventHandler.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(event){if("hlsEventGeneric"===event)throw new Error("Forbidden event name: "+event);this.hls.on(event,this.onEvent)},this)},EventHandler.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(event){this.hls.off(event,this.onEvent)},this)},EventHandler.prototype.onEvent=function(event,data){this.onEventGeneric(event,data)},EventHandler.prototype.onEventGeneric=function(event,data){var eventToFunction=function(event,data){var funcName="on"+event.replace("hls","");if("function"!=typeof this[funcName])throw new Error("Event "+event+" has no generic handler in this "+this.constructor.name+" class (tried "+funcName+")");return this[funcName].bind(this,data)};try{eventToFunction.call(this,event,data).call()}catch(err){logger.b.error("internal error happened while processing "+event+":"+err.message),this.hls.trigger(events.a.ERROR,{type:errors.b.OTHER_ERROR,details:errors.a.INTERNAL_EXCEPTION,fatal:!1,event:event,err:err})}},EventHandler}(),event_handler=event_handler_EventHandler,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,AttrList=function(){function AttrList(attrs){attr_list__classCallCheck(this,AttrList),"string"==typeof attrs&&(attrs=AttrList.parseAttrList(attrs));for(var attr in attrs)attrs.hasOwnProperty(attr)&&(this[attr]=attrs[attr])}return AttrList.prototype.decimalInteger=function(attrName){var intValue=parseInt(this[attrName],10);return intValue>Number.MAX_SAFE_INTEGER?1/0:intValue},AttrList.prototype.hexadecimalInteger=function(attrName){if(this[attrName]){var stringValue=(this[attrName]||"0x").slice(2);stringValue=(1&stringValue.length?"0":"")+stringValue;for(var value=new Uint8Array(stringValue.length/2),i=0;i<stringValue.length/2;i++)value[i]=parseInt(stringValue.slice(2*i,2*i+2),16);return value}return null},AttrList.prototype.hexadecimalIntegerAsNumber=function(attrName){var intValue=parseInt(this[attrName],16);return intValue>Number.MAX_SAFE_INTEGER?1/0:intValue},AttrList.prototype.decimalFloatingPoint=function(attrName){return parseFloat(this[attrName])},AttrList.prototype.enumeratedString=function(attrName){return this[attrName]},AttrList.prototype.decimalResolution=function(attrName){var res=DECIMAL_RESOLUTION_REGEX.exec(this[attrName]);if(null!==res)return{width:parseInt(res[1],10),height:parseInt(res[2],10)}},AttrList.parseAttrList=function(input){var match,attrs={};for(ATTR_LIST_REGEX.lastIndex=0;null!==(match=ATTR_LIST_REGEX.exec(input));){var value=match[2];0===value.indexOf('"')&&value.lastIndexOf('"')===value.length-1&&(value=value.slice(1,-1)),attrs[match[1]]=value}return attrs},AttrList}(),attr_list=AttrList,sampleEntryCodesISO={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),LEVEL_PLAYLIST_REGEX_SLOW=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,playlist_loader_LevelKey=function(){function LevelKey(){playlist_loader__classCallCheck(this,LevelKey),this.method=null,this.key=null,this.iv=null,this._uri=null}return _createClass(LevelKey,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=url_toolkit_default.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),LevelKey}(),playlist_loader_Fragment=function(){function Fragment(){playlist_loader__classCallCheck(this,Fragment),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return Fragment.prototype.createInitializationVector=function(segmentNumber){for(var uint8View=new Uint8Array(16),i=12;i<16;i++)uint8View[i]=segmentNumber>>8*(15-i)&255;return uint8View},Fragment.prototype.fragmentDecryptdataFromLevelkey=function(levelkey,segmentNumber){var decryptdata=levelkey;return levelkey&&levelkey.method&&levelkey.uri&&!levelkey.iv&&(decryptdata=new playlist_loader_LevelKey,decryptdata.method=levelkey.method,decryptdata.baseuri=levelkey.baseuri,decryptdata.reluri=levelkey.reluri,decryptdata.iv=this.createInitializationVector(segmentNumber)),decryptdata},Fragment.prototype.cloneObj=function(obj){return JSON.parse(JSON.stringify(obj))},_createClass(Fragment,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=url_toolkit_default.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(value){this._url=value}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var byteRange=this._byteRange=[];if(this.rawByteRange){var params=this.rawByteRange.split("@",2);if(1===params.length){var lastByteRangeEndOffset=this.lastByteRangeEndOffset;byteRange[0]=lastByteRangeEndOffset||0}else byteRange[0]=parseInt(params[1]);byteRange[1]=parseInt(params[0])+byteRange[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),Fragment}(),playlist_loader_PlaylistLoader=function(_EventHandler){function PlaylistLoader(hls){playlist_loader__classCallCheck(this,PlaylistLoader);var _this=_possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.MANIFEST_LOADING,events.a.LEVEL_LOADING,events.a.AUDIO_TRACK_LOADING,events.a.SUBTITLE_TRACK_LOADING));return _this.loaders={},_this}return _inherits(PlaylistLoader,_EventHandler),PlaylistLoader.prototype.destroy=function(){for(var loaderName in this.loaders){var loader=this.loaders[loaderName];loader&&loader.destroy()}this.loaders={},event_handler.prototype.destroy.call(this)},PlaylistLoader.prototype.onManifestLoading=function(data){this.load(data.url,{type:"manifest"})},PlaylistLoader.prototype.onLevelLoading=function(data){this.load(data.url,{type:"level",level:data.level,id:data.id})},PlaylistLoader.prototype.onAudioTrackLoading=function(data){this.load(data.url,{type:"audioTrack",id:data.id})},PlaylistLoader.prototype.onSubtitleTrackLoading=function(data){this.load(data.url,{type:"subtitleTrack",id:data.id})},PlaylistLoader.prototype.load=function(url,context){var loader=this.loaders[context.type];if(loader){var loaderContext=loader.context;if(loaderContext&&loaderContext.url===url)return void logger.b.trace("playlist request ongoing");logger.b.warn("abort previous loader for type:"+context.type),loader.abort()}var config=this.hls.config,retry=void 0,timeout=void 0,retryDelay=void 0,maxRetryDelay=void 0;"manifest"===context.type?(retry=config.manifestLoadingMaxRetry,timeout=config.manifestLoadingTimeOut,retryDelay=config.manifestLoadingRetryDelay,maxRetryDelay=config.manifestLoadingMaxRetryTimeout):(retry=config.levelLoadingMaxRetry,timeout=config.levelLoadingTimeOut,retryDelay=config.levelLoadingRetryDelay,maxRetryDelay=config.levelLoadingMaxRetryTimeout,logger.b.log("loading playlist for "+context.type+" "+(context.level||context.id))),loader=this.loaders[context.type]=context.loader=void 0!==config.pLoader?new config.pLoader(config):new config.loader(config),context.url=url,context.responseType="";var loaderConfig=void 0,loaderCallbacks=void 0;loaderConfig={timeout:timeout,maxRetry:retry,retryDelay:retryDelay,maxRetryDelay:maxRetryDelay},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},loader.load(context,loaderConfig,loaderCallbacks)},PlaylistLoader.prototype.resolve=function(url,baseUrl){return url_toolkit_default.a.buildAbsoluteURL(baseUrl,url,{alwaysNormalize:!0})},PlaylistLoader.prototype.parseMasterPlaylist=function(string,baseurl){var levels=[],result=void 0;for(MASTER_PLAYLIST_REGEX.lastIndex=0;null!=(result=MASTER_PLAYLIST_REGEX.exec(string));){var level={},attrs=level.attrs=new attr_list(result[1]);level.url=this.resolve(result[2],baseurl);var resolution=attrs.decimalResolution("RESOLUTION");resolution&&(level.width=resolution.width,level.height=resolution.height),level.bitrate=attrs.decimalInteger("AVERAGE-BANDWIDTH")||attrs.decimalInteger("BANDWIDTH"),level.name=attrs.NAME,function(codecs,level){["video","audio"].forEach(function(type){var filtered=codecs.filter(function(codec){return isCodecType(codec,type)});if(filtered.length){var preferred=filtered.filter(function(codec){return 0===codec.lastIndexOf("avc1",0)||0===codec.lastIndexOf("mp4a",0)});level[type+"Codec"]=preferred.length>0?preferred[0]:filtered[0],codecs=codecs.filter(function(codec){return-1===filtered.indexOf(codec)})}}),level.unknownCodecs=codecs}([].concat((attrs.CODECS||"").split(/[ ,]+/)),level),level.videoCodec&&-1!==level.videoCodec.indexOf("avc1")&&(level.videoCodec=this.avc1toavcoti(level.videoCodec)),levels.push(level)}return levels},PlaylistLoader.prototype.parseMasterPlaylistMedia=function(string,baseurl,type){var audioGroups=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],result=void 0,medias=[],id=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;null!==(result=MASTER_PLAYLIST_MEDIA_REGEX.exec(string));){var media={},attrs=new attr_list(result[1]);if(attrs.TYPE===type){if(media.groupId=attrs["GROUP-ID"],media.name=attrs.NAME,media.type=type,media.default="YES"===attrs.DEFAULT,media.autoselect="YES"===attrs.AUTOSELECT,media.forced="YES"===attrs.FORCED,attrs.URI&&(media.url=this.resolve(attrs.URI,baseurl)),media.lang=attrs.LANGUAGE,media.name||(media.name=media.lang),audioGroups.length){var groupCodec=findGroup(audioGroups,media.groupId);media.audioCodec=groupCodec?groupCodec.codec:audioGroups[0].codec}media.id=id++,medias.push(media)}}return medias},PlaylistLoader.prototype.avc1toavcoti=function(codec){var result,avcdata=codec.split(".");return avcdata.length>2?(result=avcdata.shift()+".",result+=parseInt(avcdata.shift()).toString(16),result+=("000"+parseInt(avcdata.shift()).toString(16)).substr(-4)):result=codec,result},PlaylistLoader.prototype.parseLevelPlaylist=function(string,baseurl,id,type){var result,i,currentSN=0,totalduration=0,level={type:null,version:null,url:baseurl,fragments:[],live:!0,startSN:0},levelkey=new playlist_loader_LevelKey,cc=0,prevFrag=null,frag=new playlist_loader_Fragment;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0;null!==(result=LEVEL_PLAYLIST_REGEX_FAST.exec(string));){var duration=result[1];if(duration){frag.duration=parseFloat(duration);var title=(" "+result[2]).slice(1);frag.title=title||null,frag.tagList.push(title?["INF",duration,title]:["INF",duration])}else if(result[3]){if(!isNaN(frag.duration)){var sn=currentSN++;frag.type=type,frag.start=totalduration,frag.levelkey=levelkey,frag.sn=sn,frag.level=id,frag.cc=cc,frag.baseurl=baseurl,frag.relurl=(" "+result[3]).slice(1),level.fragments.push(frag),prevFrag=frag,totalduration+=frag.duration,frag=new playlist_loader_Fragment}}else if(result[4]){if(frag.rawByteRange=(" "+result[4]).slice(1),prevFrag){var lastByteRangeEndOffset=prevFrag.byteRangeEndOffset;lastByteRangeEndOffset&&(frag.lastByteRangeEndOffset=lastByteRangeEndOffset)}}else if(result[5])frag.rawProgramDateTime=(" "+result[5]).slice(1),frag.tagList.push(["PROGRAM-DATE-TIME",frag.rawProgramDateTime]),void 0===level.programDateTime&&(level.programDateTime=new Date(new Date(Date.parse(result[5]))-1e3*totalduration));else{for(result=result[0].match(LEVEL_PLAYLIST_REGEX_SLOW),i=1;i<result.length&&void 0===result[i];i++);var value1=(" "+result[i+1]).slice(1),value2=(" "+result[i+2]).slice(1);switch(result[i]){case"#":frag.tagList.push(value2?[value1,value2]:[value1]);break;case"PLAYLIST-TYPE":level.type=value1.toUpperCase();break;case"MEDIA-SEQUENCE":currentSN=level.startSN=parseInt(value1);break;case"TARGETDURATION":level.targetduration=parseFloat(value1);break;case"VERSION":level.version=parseInt(value1);break;case"EXTM3U":break;case"ENDLIST":level.live=!1;break;case"DIS":cc++,frag.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":cc=parseInt(value1);break;case"KEY":var decryptparams=value1,keyAttrs=new attr_list(decryptparams),decryptmethod=keyAttrs.enumeratedString("METHOD"),decrypturi=keyAttrs.URI,decryptiv=keyAttrs.hexadecimalInteger("IV");decryptmethod&&(levelkey=new playlist_loader_LevelKey,decrypturi&&["AES-128","SAMPLE-AES"].indexOf(decryptmethod)>=0&&(levelkey.method=decryptmethod,levelkey.baseuri=baseurl,levelkey.reluri=decrypturi,levelkey.key=null,levelkey.iv=decryptiv));break;case"START":var startParams=value1,startAttrs=new attr_list(startParams),startTimeOffset=startAttrs.decimalFloatingPoint("TIME-OFFSET");isNaN(startTimeOffset)||(level.startTimeOffset=startTimeOffset);break;case"MAP":var mapAttrs=new attr_list(value1);frag.relurl=mapAttrs.URI,frag.rawByteRange=mapAttrs.BYTERANGE,frag.baseurl=baseurl,frag.level=id,frag.type=type,frag.sn="initSegment",level.initSegment=frag,frag=new playlist_loader_Fragment;break;default:logger.b.warn("line parsed but not handled: "+result)}}}return frag=prevFrag,frag&&!frag.relurl&&(level.fragments.pop(),totalduration-=frag.duration),level.totalduration=totalduration,level.averagetargetduration=totalduration/level.fragments.length,level.endSN=currentSN-1,level.startCC=level.fragments[0]?level.fragments[0].cc:0,level.endCC=cc,level},PlaylistLoader.prototype.loadsuccess=function(response,stats,context){var networkDetails=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,string=response.data,url=response.url,type=context.type,id=context.id,level=context.level,hls=this.hls;if(this.loaders[type]=void 0,void 0!==url&&0!==url.indexOf("data:")||(url=context.url),stats.tload=performance.now(),0===string.indexOf("#EXTM3U"))if(string.indexOf("#EXTINF:")>0){var isLevel="audioTrack"!==type&&"subtitleTrack"!==type,levelId=isNaN(level)?isNaN(id)?0:id:level,levelDetails=this.parseLevelPlaylist(string,url,levelId,"audioTrack"===type?"audio":"subtitleTrack"===type?"subtitle":"main");levelDetails.tload=stats.tload,"manifest"===type&&hls.trigger(events.a.MANIFEST_LOADED,{levels:[{url:url,details:levelDetails}],audioTracks:[],url:url,stats:stats,networkDetails:networkDetails}),stats.tparsed=performance.now(),levelDetails.targetduration?isLevel?hls.trigger(events.a.LEVEL_LOADED,{details:levelDetails,level:level||0,id:id||0,stats:stats,networkDetails:networkDetails}):"audioTrack"===type?hls.trigger(events.a.AUDIO_TRACK_LOADED,{details:levelDetails,id:id,stats:stats,networkDetails:networkDetails}):"subtitleTrack"===type&&hls.trigger(events.a.SUBTITLE_TRACK_LOADED,{details:levelDetails,id:id,stats:stats,networkDetails:networkDetails}):hls.trigger(events.a.ERROR,{type:errors.b.NETWORK_ERROR,details:errors.a.MANIFEST_PARSING_ERROR,fatal:!0,url:url,reason:"invalid targetduration",networkDetails:networkDetails})}else{var levels=this.parseMasterPlaylist(string,url);if(levels.length){var audioGroups=levels.map(function(l){return{id:l.attrs.AUDIO,codec:l.audioCodec}}),audioTracks=this.parseMasterPlaylistMedia(string,url,"AUDIO",audioGroups),subtitles=this.parseMasterPlaylistMedia(string,url,"SUBTITLES");if(audioTracks.length){var embeddedAudioFound=!1;audioTracks.forEach(function(audioTrack){audioTrack.url||(embeddedAudioFound=!0)}),!1===embeddedAudioFound&&levels[0].audioCodec&&!levels[0].attrs.AUDIO&&(logger.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),audioTracks.unshift({type:"main",name:"main"}))}hls.trigger(events.a.MANIFEST_LOADED,{levels:levels,audioTracks:audioTracks,subtitles:subtitles,url:url,stats:stats,networkDetails:networkDetails})}else hls.trigger(events.a.ERROR,{type:errors.b.NETWORK_ERROR,details:errors.a.MANIFEST_PARSING_ERROR,fatal:!0,url:url,reason:"no level found in manifest",networkDetails:networkDetails})}else hls.trigger(events.a.ERROR,{type:errors.b.NETWORK_ERROR,details:errors.a.MANIFEST_PARSING_ERROR,fatal:!0,url:url,reason:"no EXTM3U delimiter",networkDetails:networkDetails})},PlaylistLoader.prototype.loaderror=function(response,context){var details,fatal,networkDetails=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,loader=context.loader;switch(context.type){case"manifest":details=errors.a.MANIFEST_LOAD_ERROR,fatal=!0;break;case"level":details=errors.a.LEVEL_LOAD_ERROR,fatal=!1;break;case"audioTrack":details=errors.a.AUDIO_TRACK_LOAD_ERROR,fatal=!1}loader&&(loader.abort(),this.loaders[context.type]=void 0),this.hls.trigger(events.a.ERROR,{type:errors.b.NETWORK_ERROR,details:details,fatal:fatal,url:loader.url,loader:loader,response:response,context:context,networkDetails:networkDetails})},PlaylistLoader.prototype.loadtimeout=function(stats,context){var details,fatal,networkDetails=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,loader=context.loader;switch(context.type){case"manifest":details=errors.a.MANIFEST_LOAD_TIMEOUT,fatal=!0;break;case"level":details=errors.a.LEVEL_LOAD_TIMEOUT,fatal=!1;break;case"audioTrack":details=errors.a.AUDIO_TRACK_LOAD_TIMEOUT,fatal=!1}loader&&(loader.abort(),this.loaders[context.type]=void 0),this.hls.trigger(events.a.ERROR,{type:errors.b.NETWORK_ERROR,details:details,fatal:fatal,url:loader.url,loader:loader,context:context,networkDetails:networkDetails})},PlaylistLoader}(event_handler),playlist_loader=playlist_loader_PlaylistLoader,fragment_loader_FragmentLoader=function(_EventHandler){function FragmentLoader(hls){fragment_loader__classCallCheck(this,FragmentLoader);var _this=fragment_loader__possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.FRAG_LOADING));return _this.loaders={},_this}return fragment_loader__inherits(FragmentLoader,_EventHandler),FragmentLoader.prototype.destroy=function(){var loaders=this.loaders;for(var loaderName in loaders){var loader=loaders[loaderName];loader&&loader.destroy()}this.loaders={},event_handler.prototype.destroy.call(this)},FragmentLoader.prototype.onFragLoading=function(data){var frag=data.frag,type=frag.type,loader=this.loaders[type],config=this.hls.config;frag.loaded=0,loader&&(logger.b.warn("abort previous fragment loader for type:"+type),loader.abort()),loader=this.loaders[type]=frag.loader=void 0!==config.fLoader?new config.fLoader(config):new config.loader(config);var loaderContext=void 0,loaderConfig=void 0,loaderCallbacks=void 0;loaderContext={url:frag.url,frag:frag,responseType:"arraybuffer",progressData:!1};var start=frag.byteRangeStartOffset,end=frag.byteRangeEndOffset;isNaN(start)||isNaN(end)||(loaderContext.rangeStart=start,loaderContext.rangeEnd=end),loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:config.fragLoadingMaxRetryTimeout},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},loader.load(loaderContext,loaderConfig,loaderCallbacks)},FragmentLoader.prototype.loadsuccess=function(response,stats,context){var networkDetails=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,payload=response.data,frag=context.frag;frag.loader=void 0,this.loaders[frag.type]=void 0,this.hls.trigger(events.a.FRAG_LOADED,{payload:payload,frag:frag,stats:stats,networkDetails:networkDetails})},FragmentLoader.prototype.loaderror=function(response,context){var networkDetails=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,loader=context.loader;loader&&loader.abort(),this.loaders[context.type]=void 0,this.hls.trigger(events.a.ERROR,{type:errors.b.NETWORK_ERROR,details:errors.a.FRAG_LOAD_ERROR,fatal:!1,frag:context.frag,response:response,networkDetails:networkDetails})},FragmentLoader.prototype.loadtimeout=function(stats,context){var networkDetails=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,loader=context.loader;loader&&loader.abort(),this.loaders[context.type]=void 0,this.hls.trigger(events.a.ERROR,{type:errors.b.NETWORK_ERROR,details:errors.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:context.frag,networkDetails:networkDetails})},FragmentLoader.prototype.loadprogress=function(stats,context,data){var networkDetails=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,frag=context.frag;frag.loaded=stats.loaded,this.hls.trigger(events.a.FRAG_LOAD_PROGRESS,{frag:frag,stats:stats,networkDetails:networkDetails})},FragmentLoader}(event_handler),fragment_loader=fragment_loader_FragmentLoader,key_loader_KeyLoader=function(_EventHandler){function KeyLoader(hls){key_loader__classCallCheck(this,KeyLoader);var _this=key_loader__possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.KEY_LOADING));return _this.loaders={},_this.decryptkey=null,_this.decrypturl=null,_this}return key_loader__inherits(KeyLoader,_EventHandler),KeyLoader.prototype.destroy=function(){for(var loaderName in this.loaders){var loader=this.loaders[loaderName];loader&&loader.destroy()}this.loaders={},event_handler.prototype.destroy.call(this)},KeyLoader.prototype.onKeyLoading=function(data){var frag=data.frag,type=frag.type,loader=this.loaders[type],decryptdata=frag.decryptdata,uri=decryptdata.uri;if(uri!==this.decrypturl||null===this.decryptkey){var config=this.hls.config;loader&&(logger.b.warn("abort previous key loader for type:"+type),loader.abort()),frag.loader=this.loaders[type]=new config.loader(config),this.decrypturl=uri,this.decryptkey=null;var loaderContext=void 0,loaderConfig=void 0,loaderCallbacks=void 0;loaderContext={url:uri,frag:frag,responseType:"arraybuffer"},loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:config.fragLoadingMaxRetry,retryDelay:config.fragLoadingRetryDelay,maxRetryDelay:config.fragLoadingMaxRetryTimeout},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},frag.loader.load(loaderContext,loaderConfig,loaderCallbacks)}else this.decryptkey&&(decryptdata.key=this.decryptkey,this.hls.trigger(events.a.KEY_LOADED,{frag:frag}))},KeyLoader.prototype.loadsuccess=function(response,stats,context){var frag=context.frag;this.decryptkey=frag.decryptdata.key=new Uint8Array(response.data),frag.loader=void 0,this.loaders[frag.type]=void 0,this.hls.trigger(events.a.KEY_LOADED,{frag:frag})},KeyLoader.prototype.loaderror=function(response,context){var frag=context.frag,loader=frag.loader;loader&&loader.abort(),this.loaders[context.type]=void 0,this.hls.trigger(events.a.ERROR,{type:errors.b.NETWORK_ERROR,details:errors.a.KEY_LOAD_ERROR,fatal:!1,frag:frag,response:response})},KeyLoader.prototype.loadtimeout=function(stats,context){var frag=context.frag,loader=frag.loader;loader&&loader.abort(),this.loaders[context.type]=void 0,this.hls.trigger(events.a.ERROR,{type:errors.b.NETWORK_ERROR,details:errors.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:frag})},KeyLoader}(event_handler),key_loader=key_loader_KeyLoader,BinarySearch={search:function(list,comparisonFunction){for(var minIndex=0,maxIndex=list.length-1,currentIndex=null,currentElement=null;minIndex<=maxIndex;){currentIndex=(minIndex+maxIndex)/2|0,currentElement=list[currentIndex];var comparisonResult=comparisonFunction(currentElement);if(comparisonResult>0)minIndex=currentIndex+1;else{if(!(comparisonResult<0))return currentElement;maxIndex=currentIndex-1}}return null}},binary_search=BinarySearch,BufferHelper={isBuffered:function(media,position){if(media)for(var buffered=media.buffered,i=0;i<buffered.length;i++)if(position>=buffered.start(i)&&position<=buffered.end(i))return!0;return!1},bufferInfo:function(media,pos,maxHoleDuration){if(media){var i,vbuffered=media.buffered,buffered=[];for(i=0;i<vbuffered.length;i++)buffered.push({start:vbuffered.start(i),end:vbuffered.end(i)});return this.bufferedInfo(buffered,pos,maxHoleDuration)}return{len:0,start:pos,end:pos,nextStart:void 0}},bufferedInfo:function(buffered,pos,maxHoleDuration){var bufferLen,bufferStart,bufferEnd,bufferStartNext,i,buffered2=[];for(buffered.sort(function(a,b){var diff=a.start-b.start;return diff||b.end-a.end}),i=0;i<buffered.length;i++){var buf2len=buffered2.length;if(buf2len){var buf2end=buffered2[buf2len-1].end;buffered[i].start-buf2end<maxHoleDuration?buffered[i].end>buf2end&&(buffered2[buf2len-1].end=buffered[i].end):buffered2.push(buffered[i])}else buffered2.push(buffered[i])}for(i=0,bufferLen=0,bufferStart=bufferEnd=pos;i<buffered2.length;i++){var start=buffered2[i].start,end=buffered2[i].end;if(pos+maxHoleDuration>=start&&pos<end)bufferStart=start,bufferEnd=end,bufferLen=bufferEnd-pos;else if(pos+maxHoleDuration<start){bufferStartNext=start;break}}return{len:bufferLen,start:bufferStart,end:bufferEnd,nextStart:bufferStartNext}}},buffer_helper=BufferHelper,demuxer_inline=__webpack_require__(7),events_events=__webpack_require__(5),events_default=__webpack_require__.n(events_events),webworkify_webpack=__webpack_require__(9),webworkify_webpack_default=__webpack_require__.n(webworkify_webpack),demuxer_MediaSource=getMediaSource(),demuxer_Demuxer=function(){function Demuxer(hls,id){demuxer__classCallCheck(this,Demuxer),this.hls=hls,this.id=id;var observer=this.observer=new events_default.a,config=hls.config;observer.trigger=function(event){for(var _len=arguments.length,data=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];observer.emit.apply(observer,[event,event].concat(data))},observer.off=function(event){for(var _len2=arguments.length,data=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)data[_key2-1]=arguments[_key2];observer.removeListener.apply(observer,[event].concat(data))};var forwardMessage=function(ev,data){data=data||{},data.frag=this.frag,data.id=this.id,hls.trigger(ev,data)}.bind(this);observer.on(events.a.FRAG_DECRYPTED,forwardMessage),observer.on(events.a.FRAG_PARSING_INIT_SEGMENT,forwardMessage),observer.on(events.a.FRAG_PARSING_DATA,forwardMessage),observer.on(events.a.FRAG_PARSED,forwardMessage),observer.on(events.a.ERROR,forwardMessage),observer.on(events.a.FRAG_PARSING_METADATA,forwardMessage),observer.on(events.a.FRAG_PARSING_USERDATA,forwardMessage),observer.on(events.a.INIT_PTS_FOUND,forwardMessage);var typeSupported={mp4:demuxer_MediaSource.isTypeSupported("video/mp4"),mpeg:demuxer_MediaSource.isTypeSupported("audio/mpeg"),mp3:demuxer_MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},vendor=navigator.vendor;if(config.enableWorker&&"undefined"!=typeof Worker){logger.b.log("demuxing in webworker");var w=void 0;try{w=this.w=webworkify_webpack_default()(10),this.onwmsg=this.onWorkerMessage.bind(this),w.addEventListener("message",this.onwmsg),w.onerror=function(event){hls.trigger(events.a.ERROR,{type:errors.b.OTHER_ERROR,details:errors.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:event.message+" ("+event.filename+":"+event.lineno+")"}})},w.postMessage({cmd:"init",typeSupported:typeSupported,vendor:vendor,id:id,config:JSON.stringify(config)})}catch(err){logger.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),w&&URL.revokeObjectURL(w.objectURL),this.demuxer=new demuxer_inline.a(observer,typeSupported,config,vendor),this.w=void 0}}else this.demuxer=new demuxer_inline.a(observer,typeSupported,config,vendor)}return Demuxer.prototype.destroy=function(){var w=this.w;if(w)w.removeEventListener("message",this.onwmsg),w.terminate(),this.w=null;else{var demuxer=this.demuxer;demuxer&&(demuxer.destroy(),this.demuxer=null)}var observer=this.observer;observer&&(observer.removeAllListeners(),this.observer=null)},Demuxer.prototype.push=function(data,initSegment,audioCodec,videoCodec,frag,duration,accurateTimeOffset,defaultInitPTS){var w=this.w,timeOffset=isNaN(frag.startDTS)?frag.start:frag.startDTS,decryptdata=frag.decryptdata,lastFrag=this.frag,discontinuity=!(lastFrag&&frag.cc===lastFrag.cc),trackSwitch=!(lastFrag&&frag.level===lastFrag.level),nextSN=lastFrag&&frag.sn===lastFrag.sn+1,contiguous=!trackSwitch&&nextSN;if(discontinuity&&logger.b.log(this.id+":discontinuity detected"),trackSwitch&&logger.b.log(this.id+":switch detected"),this.frag=frag,w)w.postMessage({cmd:"demux",data:data,decryptdata:decryptdata,initSegment:initSegment,audioCodec:audioCodec,videoCodec:videoCodec,timeOffset:timeOffset,discontinuity:discontinuity,trackSwitch:trackSwitch,contiguous:contiguous,duration:duration,accurateTimeOffset:accurateTimeOffset,defaultInitPTS:defaultInitPTS},data instanceof ArrayBuffer?[data]:[]);else{var demuxer=this.demuxer;demuxer&&demuxer.push(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)}},Demuxer.prototype.onWorkerMessage=function(ev){var data=ev.data,hls=this.hls;switch(data.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case events.a.FRAG_PARSING_DATA:data.data.data1=new Uint8Array(data.data1),data.data2&&(data.data.data2=new Uint8Array(data.data2));default:data.data=data.data||{},data.data.frag=this.frag,data.data.id=this.id,hls.trigger(data.event,data.data)}},Demuxer}(),demux_demuxer=demuxer_Demuxer,TimeRanges={toString:function(r){for(var log="",len=r.length,i=0;i<len;i++)log+="["+r.start(i).toFixed(3)+","+r.end(i).toFixed(3)+"]";return log}},timeRanges=TimeRanges,stream_controller__createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},stream_controller_StreamController=function(_EventHandler){function StreamController(hls){stream_controller__classCallCheck(this,StreamController);var _this=stream_controller__possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.MEDIA_ATTACHED,events.a.MEDIA_DETACHING,events.a.MANIFEST_LOADING,events.a.MANIFEST_PARSED,events.a.LEVEL_LOADED,events.a.KEY_LOADED,events.a.FRAG_LOADED,events.a.FRAG_LOAD_EMERGENCY_ABORTED,events.a.FRAG_PARSING_INIT_SEGMENT,events.a.FRAG_PARSING_DATA,events.a.FRAG_PARSED,events.a.ERROR,events.a.AUDIO_TRACK_SWITCHING,events.a.AUDIO_TRACK_SWITCHED,events.a.BUFFER_CREATED,events.a.BUFFER_APPENDED,events.a.BUFFER_FLUSHED));return _this.config=hls.config,_this.audioCodecSwap=!1,_this.ticks=0,_this._state=State.STOPPED,_this.ontick=_this.tick.bind(_this),_this}return stream_controller__inherits(StreamController,_EventHandler),StreamController.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),event_handler.prototype.destroy.call(this),this.state=State.STOPPED},StreamController.prototype.startLoad=function(startPosition){if(this.levels){var lastCurrentTime=this.lastCurrentTime,hls=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var startLevel=hls.startLevel;-1===startLevel&&(startLevel=0,this.bitrateTest=!0),this.level=hls.nextLoadLevel=startLevel,this.loadedmetadata=!1}lastCurrentTime>0&&-1===startPosition&&(logger.b.log("override startPosition with lastCurrentTime @"+lastCurrentTime.toFixed(3)),startPosition=lastCurrentTime),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=startPosition,this.tick()}else this.forceStartLoad=!0,this.state=State.STOPPED},StreamController.prototype.stopLoad=function(){var frag=this.fragCurrent;frag&&(frag.loader&&frag.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=State.STOPPED,this.forceStartLoad=!1},StreamController.prototype.tick=function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},StreamController.prototype.doTick=function(){switch(this.state){case State.ERROR:break;case State.BUFFER_FLUSHING:this.fragLoadError=0;break;case State.IDLE:this._doTickIdle();break;case State.WAITING_LEVEL:var level=this.levels[this.level];level&&level.details&&(this.state=State.IDLE);break;case State.FRAG_LOADING_WAITING_RETRY:var now=performance.now(),retryDate=this.retryDate;(!retryDate||now>=retryDate||this.media&&this.media.seeking)&&(logger.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=State.IDLE);break;case State.ERROR:case State.STOPPED:case State.FRAG_LOADING:case State.PARSING:case State.PARSED:case State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},StreamController.prototype._doTickIdle=function(){var hls=this.hls,config=hls.config,media=this.media;if(void 0!==this.levelLastLoaded&&(media||!this.startFragRequested&&config.startFragPrefetch)){var pos=void 0;pos=this.loadedmetadata?media.currentTime:this.nextLoadPosition;var level=hls.nextLoadLevel,levelInfo=this.levels[level];if(levelInfo){var levelBitrate=levelInfo.bitrate,maxBufLen=void 0;maxBufLen=levelBitrate?Math.max(8*config.maxBufferSize/levelBitrate,config.maxBufferLength):config.maxBufferLength,maxBufLen=Math.min(maxBufLen,config.maxMaxBufferLength);var bufferInfo=buffer_helper.bufferInfo(this.mediaBuffer?this.mediaBuffer:media,pos,config.maxBufferHole),bufferLen=bufferInfo.len;if(!(bufferLen>=maxBufLen)){logger.b.trace("buffer length of "+bufferLen.toFixed(3)+" is below max of "+maxBufLen.toFixed(3)+". checking for more payload ..."),this.level=hls.nextLoadLevel=level;var levelDetails=levelInfo.details;if(void 0===levelDetails||levelDetails.live&&this.levelLastLoaded!==level)return void(this.state=State.WAITING_LEVEL);var fragPrevious=this.fragPrevious;if(!levelDetails.live&&fragPrevious&&!fragPrevious.backtracked&&fragPrevious.sn===levelDetails.endSN&&!bufferInfo.nextStart){if(Math.min(media.duration,fragPrevious.start+fragPrevious.duration)-Math.max(bufferInfo.end,fragPrevious.start)<=Math.max(.2,fragPrevious.duration)){var data={};return this.altAudio&&(data.type="video"),this.hls.trigger(events.a.BUFFER_EOS,data),void(this.state=State.ENDED)}}this._fetchPayloadOrEos(pos,bufferInfo,levelDetails)}}}},StreamController.prototype._fetchPayloadOrEos=function(pos,bufferInfo,levelDetails){var fragPrevious=this.fragPrevious,level=this.level,fragments=levelDetails.fragments,fragLen=fragments.length;if(0!==fragLen){var start=fragments[0].start,end=fragments[fragLen-1].start+fragments[fragLen-1].duration,bufferEnd=bufferInfo.end,frag=void 0;if(levelDetails.initSegment&&!levelDetails.initSegment.data)frag=levelDetails.initSegment;else if(levelDetails.live){var initialLiveManifestSize=this.config.initialLiveManifestSize;if(fragLen<initialLiveManifestSize)return void logger.b.warn("Can not start playback of a level, reason: not enough fragments "+fragLen+" < "+initialLiveManifestSize);if(null===(frag=this._ensureFragmentAtLivePoint(levelDetails,bufferEnd,start,end,fragPrevious,fragments,fragLen)))return}else bufferEnd<start&&(frag=fragments[0]);frag||(frag=this._findFragment(start,fragPrevious,fragLen,fragments,bufferEnd,end,levelDetails)),frag&&this._loadFragmentOrKey(frag,level,levelDetails,pos,bufferEnd)}},StreamController.prototype._ensureFragmentAtLivePoint=function(levelDetails,bufferEnd,start,end,fragPrevious,fragments,fragLen){var config=this.hls.config,media=this.media,frag=void 0,maxLatency=void 0!==config.liveMaxLatencyDuration?config.liveMaxLatencyDuration:config.liveMaxLatencyDurationCount*levelDetails.targetduration;if(bufferEnd<Math.max(start-config.maxFragLookUpTolerance,end-maxLatency)){var liveSyncPosition=this.liveSyncPosition=this.computeLivePosition(start,levelDetails);logger.b.log("buffer end: "+bufferEnd.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+liveSyncPosition.toFixed(3)),bufferEnd=liveSyncPosition,media&&media.readyState&&media.duration>liveSyncPosition&&(media.currentTime=liveSyncPosition),this.nextLoadPosition=liveSyncPosition}if(levelDetails.PTSKnown&&bufferEnd>end&&media&&media.readyState)return null;if(this.startFragRequested&&!levelDetails.PTSKnown){if(fragPrevious){var targetSN=fragPrevious.sn+1;if(targetSN>=levelDetails.startSN&&targetSN<=levelDetails.endSN){var fragNext=fragments[targetSN-levelDetails.startSN];fragPrevious.cc===fragNext.cc&&(frag=fragNext,logger.b.log("live playlist, switching playlist, load frag with next SN: "+frag.sn))}frag||(frag=binary_search.search(fragments,function(frag){return fragPrevious.cc-frag.cc}))&&logger.b.log("live playlist, switching playlist, load frag with same CC: "+frag.sn)}frag||(frag=fragments[Math.min(fragLen-1,Math.round(fragLen/2))],logger.b.log("live playlist, switching playlist, unknown, load middle frag : "+frag.sn))}return frag},StreamController.prototype._findFragment=function(start,fragPrevious,fragLen,fragments,bufferEnd,end,levelDetails){var config=this.hls.config,frag=void 0,foundFrag=void 0,maxFragLookUpTolerance=config.maxFragLookUpTolerance,fragNext=fragPrevious?fragments[fragPrevious.sn-fragments[0].sn+1]:void 0,fragmentWithinToleranceTest=function(candidate){var candidateLookupTolerance=Math.min(maxFragLookUpTolerance,candidate.duration+(candidate.deltaPTS?candidate.deltaPTS:0));return candidate.start+candidate.duration-candidateLookupTolerance<=bufferEnd?1:candidate.start-candidateLookupTolerance>bufferEnd&&candidate.start?-1:0};if(bufferEnd<end?(bufferEnd>end-maxFragLookUpTolerance&&(maxFragLookUpTolerance=0),foundFrag=fragNext&&!fragmentWithinToleranceTest(fragNext)?fragNext:binary_search.search(fragments,fragmentWithinToleranceTest)):foundFrag=fragments[fragLen-1],foundFrag){frag=foundFrag;var curSNIdx=frag.sn-levelDetails.startSN,sameLevel=fragPrevious&&frag.level===fragPrevious.level,prevFrag=fragments[curSNIdx-1],nextFrag=fragments[curSNIdx+1];if(fragPrevious&&frag.sn===fragPrevious.sn)if(sameLevel&&!frag.backtracked)if(frag.sn<levelDetails.endSN){var deltaPTS=fragPrevious.deltaPTS;deltaPTS&&deltaPTS>config.maxBufferHole&&fragPrevious.dropped&&curSNIdx?(frag=prevFrag,logger.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),fragPrevious.loadCounter--):(frag=nextFrag,logger.b.log("SN just loaded, load next one: "+frag.sn))}else frag=null;else frag.backtracked&&(nextFrag&&nextFrag.backtracked?(logger.b.warn("Already backtracked from fragment "+nextFrag.sn+", will not backtrack to fragment "+frag.sn+". Loading fragment "+nextFrag.sn),frag=nextFrag):(logger.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),frag.dropped=0,prevFrag?(prevFrag.loadCounter&&prevFrag.loadCounter--,frag=prevFrag,frag.backtracked=!0):curSNIdx&&(frag=null)))}return frag},StreamController.prototype._loadFragmentOrKey=function(frag,level,levelDetails,pos,bufferEnd){var hls=this.hls,config=hls.config;if(!frag.decryptdata||null==frag.decryptdata.uri||null!=frag.decryptdata.key){if(logger.b.log("Loading "+frag.sn+" of ["+levelDetails.startSN+" ,"+levelDetails.endSN+"],level "+level+", currentTime:"+pos.toFixed(3)+",bufferEnd:"+bufferEnd.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,frag.loadCounter){frag.loadCounter++;var maxThreshold=config.fragLoadingLoopThreshold;if(frag.loadCounter>maxThreshold&&Math.abs(this.fragLoadIdx-frag.loadIdx)<maxThreshold)return void hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:frag})}else frag.loadCounter=1;return frag.loadIdx=this.fragLoadIdx,frag.autoLevel=hls.autoLevelEnabled,frag.bitrateTest=this.bitrateTest,this.fragCurrent=frag,this.startFragRequested=!0,isNaN(frag.sn)||frag.bitrateTest||(this.nextLoadPosition=frag.start+frag.duration),hls.trigger(events.a.FRAG_LOADING,{frag:frag}),this.demuxer||(this.demuxer=new demux_demuxer(hls,"main")),void(this.state=State.FRAG_LOADING)}logger.b.log("Loading key for "+frag.sn+" of ["+levelDetails.startSN+" ,"+levelDetails.endSN+"],level "+level),this.state=State.KEY_LOADING,hls.trigger(events.a.KEY_LOADING,{frag:frag})},StreamController.prototype.getBufferedFrag=function(position){return binary_search.search(this._bufferedFrags,function(frag){return position<frag.startPTS?-1:position>frag.endPTS?1:0})},StreamController.prototype.followingBufferedFrag=function(frag){return frag?this.getBufferedFrag(frag.endPTS+.5):null},StreamController.prototype._checkFragmentChanged=function(){var fragPlayingCurrent,currentTime,video=this.media;if(video&&video.readyState&&!1===video.seeking&&(currentTime=video.currentTime,currentTime>video.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=currentTime),buffer_helper.isBuffered(video,currentTime)?fragPlayingCurrent=this.getBufferedFrag(currentTime):buffer_helper.isBuffered(video,currentTime+.1)&&(fragPlayingCurrent=this.getBufferedFrag(currentTime+.1)),fragPlayingCurrent)){var fragPlaying=fragPlayingCurrent;if(fragPlaying!==this.fragPlaying){this.hls.trigger(events.a.FRAG_CHANGED,{frag:fragPlaying});var fragPlayingLevel=fragPlaying.level;this.fragPlaying&&this.fragPlaying.level===fragPlayingLevel||this.hls.trigger(events.a.LEVEL_SWITCHED,{level:fragPlayingLevel}),this.fragPlaying=fragPlaying}}},StreamController.prototype.immediateLevelSwitch=function(){if(logger.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var media=this.media,previouslyPaused=void 0;media?(previouslyPaused=media.paused,media.pause()):previouslyPaused=!0,this.previouslyPaused=previouslyPaused}var fragCurrent=this.fragCurrent;fragCurrent&&fragCurrent.loader&&fragCurrent.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},StreamController.prototype.immediateLevelSwitchEnd=function(){var media=this.media;media&&media.buffered.length&&(this.immediateSwitch=!1,buffer_helper.isBuffered(media,media.currentTime)&&(media.currentTime-=1e-4),this.previouslyPaused||media.play())},StreamController.prototype.nextLevelSwitch=function(){var media=this.media;if(media&&media.readyState){var fetchdelay=void 0,fragPlayingCurrent=void 0,nextBufferedFrag=void 0;if(void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),fragPlayingCurrent=this.getBufferedFrag(media.currentTime),fragPlayingCurrent&&fragPlayingCurrent.startPTS>1&&this.flushMainBuffer(0,fragPlayingCurrent.startPTS-1),media.paused)fetchdelay=0;else{var nextLevelId=this.hls.nextLoadLevel,nextLevel=this.levels[nextLevelId],fragLastKbps=this.fragLastKbps;fetchdelay=fragLastKbps&&this.fragCurrent?this.fragCurrent.duration*nextLevel.bitrate/(1e3*fragLastKbps)+1:0}if((nextBufferedFrag=this.getBufferedFrag(media.currentTime+fetchdelay))&&(nextBufferedFrag=this.followingBufferedFrag(nextBufferedFrag))){var fragCurrent=this.fragCurrent;fragCurrent&&fragCurrent.loader&&fragCurrent.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(nextBufferedFrag.maxStartPTS,Number.POSITIVE_INFINITY)}}},StreamController.prototype.flushMainBuffer=function(startOffset,endOffset){this.state=State.BUFFER_FLUSHING;var flushScope={startOffset:startOffset,endOffset:endOffset};this.altAudio&&(flushScope.type="video"),this.hls.trigger(events.a.BUFFER_FLUSHING,flushScope)},StreamController.prototype.onMediaAttached=function(data){var media=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),media.addEventListener("seeking",this.onvseeking),media.addEventListener("seeked",this.onvseeked),media.addEventListener("ended",this.onvended);var config=this.config;this.levels&&config.autoStartLoad&&this.hls.startLoad(config.startPosition)},StreamController.prototype.onMediaDetaching=function(){var media=this.media;media&&media.ended&&(logger.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var levels=this.levels;levels&&levels.forEach(function(level){level.details&&level.details.fragments.forEach(function(fragment){fragment.loadCounter=void 0,fragment.backtracked=void 0})}),media&&(media.removeEventListener("seeking",this.onvseeking),media.removeEventListener("seeked",this.onvseeked),media.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},StreamController.prototype.onMediaSeeking=function(){var media=this.media,currentTime=media?media.currentTime:void 0,config=this.config;isNaN(currentTime)||logger.b.log("media seeking to "+currentTime.toFixed(3));var mediaBuffer=this.mediaBuffer?this.mediaBuffer:media,bufferInfo=buffer_helper.bufferInfo(mediaBuffer,currentTime,this.config.maxBufferHole);if(this.state===State.FRAG_LOADING){var fragCurrent=this.fragCurrent;if(0===bufferInfo.len&&fragCurrent){var tolerance=config.maxFragLookUpTolerance,fragStartOffset=fragCurrent.start-tolerance,fragEndOffset=fragCurrent.start+fragCurrent.duration+tolerance;currentTime<fragStartOffset||currentTime>fragEndOffset?(fragCurrent.loader&&(logger.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),fragCurrent.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE):logger.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===State.ENDED&&(0===bufferInfo.len&&(this.fragPrevious=0),this.state=State.IDLE);media&&(this.lastCurrentTime=currentTime),this.state!==State.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*config.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=currentTime),this.tick()},StreamController.prototype.onMediaSeeked=function(){var media=this.media,currentTime=media?media.currentTime:void 0;isNaN(currentTime)||logger.b.log("media seeked to "+currentTime.toFixed(3)),this.tick()},StreamController.prototype.onMediaEnded=function(){logger.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},StreamController.prototype.onManifestLoading=function(){logger.b.log("trigger BUFFER_RESET"),this.hls.trigger(events.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0},StreamController.prototype.onManifestParsed=function(data){var codec,aac=!1,heaac=!1;data.levels.forEach(function(level){(codec=level.audioCodec)&&(-1!==codec.indexOf("mp4a.40.2")&&(aac=!0),-1!==codec.indexOf("mp4a.40.5")&&(heaac=!0))}),this.audioCodecSwitch=aac&&heaac,this.audioCodecSwitch&&logger.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=data.levels,this.startFragRequested=!1;var config=this.config;(config.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(config.startPosition)},StreamController.prototype.onLevelLoaded=function(data){var newDetails=data.details,newLevelId=data.level,lastLevel=this.levels[this.levelLastLoaded],curLevel=this.levels[newLevelId],duration=newDetails.totalduration,sliding=0;if(logger.b.log("level "+newLevelId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"],duration:"+duration),newDetails.live){var curDetails=curLevel.details;curDetails&&newDetails.fragments.length>0?(mergeDetails(curDetails,newDetails),sliding=newDetails.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(sliding,curDetails),newDetails.PTSKnown&&!isNaN(sliding)?logger.b.log("live playlist sliding:"+sliding.toFixed(3)):(logger.b.log("live playlist - outdated PTS, unknown sliding"),alignDiscontinuities(this.fragPrevious,lastLevel,newDetails))):(logger.b.log("live playlist - first load, unknown sliding"),newDetails.PTSKnown=!1,alignDiscontinuities(this.fragPrevious,lastLevel,newDetails))}else newDetails.PTSKnown=!1;if(curLevel.details=newDetails,this.levelLastLoaded=newLevelId,this.hls.trigger(events.a.LEVEL_UPDATED,{details:newDetails,level:newLevelId}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var startTimeOffset=newDetails.startTimeOffset;isNaN(startTimeOffset)?newDetails.live?(this.startPosition=this.computeLivePosition(sliding,newDetails),logger.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(startTimeOffset<0&&(logger.b.log("negative start time offset "+startTimeOffset+", count from end of last fragment"),startTimeOffset=sliding+duration+startTimeOffset),logger.b.log("start time offset found in playlist, adjust startPosition to "+startTimeOffset),this.startPosition=startTimeOffset),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===State.WAITING_LEVEL&&(this.state=State.IDLE),this.tick()},StreamController.prototype.onKeyLoaded=function(){this.state===State.KEY_LOADING&&(this.state=State.IDLE,this.tick())},StreamController.prototype.onFragLoaded=function(data){var fragCurrent=this.fragCurrent,fragLoaded=data.frag;if(this.state===State.FRAG_LOADING&&fragCurrent&&"main"===fragLoaded.type&&fragLoaded.level===fragCurrent.level&&fragLoaded.sn===fragCurrent.sn){var stats=data.stats,currentLevel=this.levels[fragCurrent.level],details=currentLevel.details;if(logger.b.log("Loaded  "+fragCurrent.sn+" of ["+details.startSN+" ,"+details.endSN+"],level "+fragCurrent.level),this.bitrateTest=!1,this.stats=stats,!0===fragLoaded.bitrateTest&&this.hls.nextLoadLevel)this.state=State.IDLE,this.startFragRequested=!1,stats.tparsed=stats.tbuffered=performance.now(),this.hls.trigger(events.a.FRAG_BUFFERED,{stats:stats,frag:fragCurrent,id:"main"}),this.tick();else if("initSegment"===fragLoaded.sn)this.state=State.IDLE,stats.tparsed=stats.tbuffered=performance.now(),details.initSegment.data=data.payload,this.hls.trigger(events.a.FRAG_BUFFERED,{stats:stats,frag:fragCurrent,id:"main"}),this.tick();else{this.state=State.PARSING;var duration=details.totalduration,level=fragCurrent.level,sn=fragCurrent.sn,audioCodec=this.config.defaultAudioCodec||currentLevel.audioCodec;this.audioCodecSwap&&(logger.b.log("swapping playlist audio codec"),void 0===audioCodec&&(audioCodec=this.lastAudioCodec),audioCodec&&(audioCodec=-1!==audioCodec.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,logger.b.log("Parsing "+sn+" of ["+details.startSN+" ,"+details.endSN+"],level "+level+", cc "+fragCurrent.cc);var demuxer=this.demuxer;demuxer||(demuxer=this.demuxer=new demux_demuxer(this.hls,"main"));var media=this.media,mediaSeeking=media&&media.seeking,accurateTimeOffset=!mediaSeeking&&(details.PTSKnown||!details.live),initSegmentData=details.initSegment?details.initSegment.data:[];demuxer.push(data.payload,initSegmentData,audioCodec,currentLevel.videoCodec,fragCurrent,duration,accurateTimeOffset,void 0)}}this.fragLoadError=0},StreamController.prototype.onFragParsingInitSegment=function(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State.PARSING){var trackName,track,tracks=data.tracks;if(tracks.audio&&this.altAudio&&delete tracks.audio,track=tracks.audio){var audioCodec=this.levels[this.level].audioCodec,ua=navigator.userAgent.toLowerCase();audioCodec&&this.audioCodecSwap&&(logger.b.log("swapping playlist audio codec"),audioCodec=-1!==audioCodec.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==track.metadata.channelCount&&-1===ua.indexOf("firefox")&&(audioCodec="mp4a.40.5"),-1!==ua.indexOf("android")&&"audio/mpeg"!==track.container&&(audioCodec="mp4a.40.2",logger.b.log("Android: force audio codec to "+audioCodec)),track.levelCodec=audioCodec,track.id=data.id}track=tracks.video,track&&(track.levelCodec=this.levels[this.level].videoCodec,track.id=data.id),this.hls.trigger(events.a.BUFFER_CODECS,tracks);for(trackName in tracks){track=tracks[trackName],logger.b.log("main track:"+trackName+",container:"+track.container+",codecs[level/parsed]=["+track.levelCodec+"/"+track.codec+"]");var initSegment=track.initSegment;initSegment&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(events.a.BUFFER_APPENDING,{type:trackName,data:initSegment,parent:"main",content:"initSegment"}))}this.tick()}},StreamController.prototype.onFragParsingData=function(data){var _this2=this,fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&("audio"!==data.type||!this.altAudio)&&this.state===State.PARSING){var level=this.levels[this.level],frag=fragCurrent;if(isNaN(data.endPTS)&&(data.endPTS=data.startPTS+fragCurrent.duration,data.endDTS=data.startDTS+fragCurrent.duration),logger.b.log("Parsed "+data.type+",PTS:["+data.startPTS.toFixed(3)+","+data.endPTS.toFixed(3)+"],DTS:["+data.startDTS.toFixed(3)+"/"+data.endDTS.toFixed(3)+"],nb:"+data.nb+",dropped:"+(data.dropped||0)),"video"===data.type)if(frag.dropped=data.dropped,frag.dropped)if(frag.backtracked)logger.b.warn("Already backtracked on this fragment, appending with the gap");else{var levelDetails=level.details;if(!levelDetails||frag.sn!==levelDetails.startSN)return logger.b.warn("missing video frame(s), backtracking fragment"),frag.backtracked=!0,this.nextLoadPosition=data.startPTS,this.state=State.IDLE,this.fragPrevious=frag,void this.tick();logger.b.warn("missing video frame(s) on first frag, appending with gap")}else frag.backtracked=!1;var drift=updateFragPTSDTS(level.details,frag,data.startPTS,data.endPTS,data.startDTS,data.endDTS),hls=this.hls;hls.trigger(events.a.LEVEL_PTS_UPDATED,{details:level.details,level:this.level,drift:drift,type:data.type,start:data.startPTS,end:data.endPTS}),[data.data1,data.data2].forEach(function(buffer){buffer&&buffer.length&&_this2.state===State.PARSING&&(_this2.appended=!0,_this2.pendingBuffering=!0,hls.trigger(events.a.BUFFER_APPENDING,{type:data.type,data:buffer,parent:"main",content:"data"}))}),this.tick()}},StreamController.prototype.onFragParsed=function(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State.PARSING&&(this.stats.tparsed=performance.now(),this.state=State.PARSED,this._checkAppendedParsed())},StreamController.prototype.onAudioTrackSwitching=function(data){var altAudio=!!data.url,trackId=data.id;if(!altAudio){if(this.mediaBuffer!==this.media){logger.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var fragCurrent=this.fragCurrent;fragCurrent.loader&&(logger.b.log("switching to main audio track, cancel main fragment load"),fragCurrent.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=State.IDLE}var hls=this.hls;hls.trigger(events.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),hls.trigger(events.a.AUDIO_TRACK_SWITCHED,{id:trackId}),this.altAudio=!1}},StreamController.prototype.onAudioTrackSwitched=function(data){var trackId=data.id,altAudio=!!this.hls.audioTracks[trackId].url;if(altAudio){var videoBuffer=this.videoBuffer;videoBuffer&&this.mediaBuffer!==videoBuffer&&(logger.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=videoBuffer)}this.altAudio=altAudio,this.tick()},StreamController.prototype.onBufferCreated=function(data){var tracks=data.tracks,mediaTrack=void 0,name=void 0,alternate=!1;for(var type in tracks){var track=tracks[type];"main"===track.id?(name=type,mediaTrack=track,"video"===type&&(this.videoBuffer=tracks[type].buffer)):alternate=!0}alternate&&mediaTrack?(logger.b.log("alternate track found, use "+name+".buffered to schedule main fragment loading"),this.mediaBuffer=mediaTrack.buffer):this.mediaBuffer=this.media},StreamController.prototype.onBufferAppended=function(data){if("main"===data.parent){var state=this.state;state!==State.PARSING&&state!==State.PARSED||(this.pendingBuffering=data.pending>0,this._checkAppendedParsed())}},StreamController.prototype._checkAppendedParsed=function(){if(!(this.state!==State.PARSED||this.appended&&this.pendingBuffering)){var frag=this.fragCurrent;if(frag){var media=this.mediaBuffer?this.mediaBuffer:this.media;logger.b.log("main buffered : "+timeRanges.toString(media.buffered));var bufferedFrags=this._bufferedFrags.filter(function(frag){return buffer_helper.isBuffered(media,(frag.startPTS+frag.endPTS)/2)});bufferedFrags.push(frag),this._bufferedFrags=bufferedFrags.sort(function(a,b){return a.startPTS-b.startPTS}),this.fragPrevious=frag;var stats=this.stats;stats.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*stats.total/(stats.tbuffered-stats.tfirst)),this.hls.trigger(events.a.FRAG_BUFFERED,{stats:stats,frag:frag,id:"main"}),this.state=State.IDLE}this.tick()}},StreamController.prototype.onError=function(data){var frag=data.frag||this.fragCurrent;if(!frag||"main"===frag.type){var mediaBuffered=!!this.media&&buffer_helper.isBuffered(this.media,this.media.currentTime)&&buffer_helper.isBuffered(this.media,this.media.currentTime+.5);switch(data.details){case errors.a.FRAG_LOAD_ERROR:case errors.a.FRAG_LOAD_TIMEOUT:case errors.a.KEY_LOAD_ERROR:case errors.a.KEY_LOAD_TIMEOUT:if(!data.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var delay=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);frag.loadCounter=0,logger.b.warn("mediaController: frag loading failed, retry in "+delay+" ms"),this.retryDate=performance.now()+delay,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=State.FRAG_LOADING_WAITING_RETRY}else logger.b.error("mediaController: "+data.details+" reaches max retry, redispatch as fatal ..."),data.fatal=!0,this.state=State.ERROR;break;case errors.a.FRAG_LOOP_LOADING_ERROR:data.fatal||(mediaBuffered?(this._reduceMaxBufferLength(frag.duration),this.state=State.IDLE):frag.autoLevel&&0!==frag.level||(data.fatal=!0,this.state=State.ERROR));break;case errors.a.LEVEL_LOAD_ERROR:case errors.a.LEVEL_LOAD_TIMEOUT:this.state!==State.ERROR&&(data.fatal?(this.state=State.ERROR,logger.b.warn("streamController: "+data.details+",switch to "+this.state+" state ...")):data.levelRetry||this.state!==State.WAITING_LEVEL||(this.state=State.IDLE));break;case errors.a.BUFFER_FULL_ERROR:"main"!==data.parent||this.state!==State.PARSING&&this.state!==State.PARSED||(mediaBuffered?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=State.IDLE):(logger.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},StreamController.prototype._reduceMaxBufferLength=function(minLength){var config=this.config;config.maxMaxBufferLength>=minLength&&(config.maxMaxBufferLength/=2,logger.b.warn("main:reduce max buffer length to "+config.maxMaxBufferLength+"s"),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*config.fragLoadingLoopThreshold))},StreamController.prototype._checkBuffer=function(){var media=this.media,config=this.config;if(media&&media.readyState){var currentTime=media.currentTime,mediaBuffer=this.mediaBuffer?this.mediaBuffer:media,buffered=mediaBuffer.buffered;if(!this.loadedmetadata&&buffered.length){this.loadedmetadata=!0;var startPosition=media.seeking?currentTime:this.startPosition,startPositionBuffered=buffer_helper.isBuffered(mediaBuffer,startPosition),firstbufferedPosition=buffered.start(0),startNotBufferedButClose=!startPositionBuffered&&Math.abs(startPosition-firstbufferedPosition)<config.maxSeekHole;(currentTime!==startPosition||startNotBufferedButClose)&&(logger.b.log("target start position:"+startPosition),startNotBufferedButClose&&(startPosition=firstbufferedPosition,logger.b.log("target start position not buffered, seek to buffered.start(0) "+startPosition)),logger.b.log("adjust currentTime from "+currentTime+" to "+startPosition),media.currentTime=startPosition)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var bufferInfo=buffer_helper.bufferInfo(media,currentTime,0),expectedPlaying=!(media.paused||media.ended||0===media.buffered.length),playheadMoving=currentTime!==this.lastCurrentTime;if(playheadMoving)this.stallReported&&(logger.b.warn("playback not stuck anymore @"+currentTime+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(expectedPlaying){var tnow=performance.now(),hls=this.hls;if(this.stalled){var stalledDuration=tnow-this.stalled,bufferLen=bufferInfo.len,nudgeRetry=this.nudgeRetry||0;if(bufferLen<=.5&&stalledDuration>1e3*config.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,logger.b.warn("playback stalling in low buffer @"+currentTime),hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:bufferLen}));var nextBufferStart=bufferInfo.nextStart,delta=nextBufferStart-currentTime;if(nextBufferStart&&delta<config.maxSeekHole&&delta>0){this.nudgeRetry=++nudgeRetry;var nudgeOffset=nudgeRetry*config.nudgeOffset;logger.b.log("adjust currentTime from "+media.currentTime+" to next buffered @ "+nextBufferStart+" + nudge "+nudgeOffset),media.currentTime=nextBufferStart+nudgeOffset,this.stalled=void 0,hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:nextBufferStart+nudgeOffset-currentTime})}}else if(bufferLen>.5&&stalledDuration>1e3*config.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,logger.b.warn("playback stalling in high buffer @"+currentTime),hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:bufferLen})),this.stalled=void 0,this.nudgeRetry=++nudgeRetry,nudgeRetry<config.nudgeMaxRetry){var _currentTime=media.currentTime,targetTime=_currentTime+nudgeRetry*config.nudgeOffset;logger.b.log("adjust currentTime from "+_currentTime+" to "+targetTime),media.currentTime=targetTime,hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else logger.b.error("still stuck in high buffer @"+currentTime+" after "+config.nudgeMaxRetry+", raise fatal error"),hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=tnow,this.stallReported=!1}}}},StreamController.prototype.onFragLoadEmergencyAborted=function(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},StreamController.prototype.onBufferFlushed=function(){var media=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(frag){return buffer_helper.isBuffered(media,(frag.startPTS+frag.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=State.IDLE,this.fragPrevious=null},StreamController.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},StreamController.prototype.computeLivePosition=function(sliding,levelDetails){var targetLatency=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*levelDetails.targetduration;return sliding+Math.max(0,levelDetails.totalduration-targetLatency)},stream_controller__createClass(StreamController,[{key:"state",set:function(nextState){if(this.state!==nextState){var previousState=this.state;this._state=nextState,logger.b.log("main stream:"+previousState+"->"+nextState),this.hls.trigger(events.a.STREAM_STATE_TRANSITION,{previousState:previousState,nextState:nextState})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var media=this.media;if(media){var frag=this.getBufferedFrag(media.currentTime);if(frag)return frag.level}return-1}},{key:"nextBufferedFrag",get:function(){var media=this.media;return media?this.followingBufferedFrag(this.getBufferedFrag(media.currentTime)):null}},{key:"nextLevel",get:function(){var frag=this.nextBufferedFrag;return frag?frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(value){this._liveSyncPosition=value}}]),StreamController}(event_handler),stream_controller=stream_controller_StreamController,level_controller__createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),level_controller_LevelController=function(_EventHandler){function LevelController(hls){level_controller__classCallCheck(this,LevelController);var _this=level_controller__possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.MANIFEST_LOADED,events.a.LEVEL_LOADED,events.a.FRAG_LOADED,events.a.ERROR));return _this._manualLevel=-1,_this.timer=null,_this}return level_controller__inherits(LevelController,_EventHandler),LevelController.prototype.destroy=function(){this.cleanTimer(),this._manualLevel=-1},LevelController.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},LevelController.prototype.startLoad=function(){var levels=this._levels;this.canload=!0,this.levelRetryCount=0,levels&&levels.forEach(function(level){level.loadError=0;var levelDetails=level.details;levelDetails&&levelDetails.live&&(level.details=void 0)}),this.timer&&this.tick()},LevelController.prototype.stopLoad=function(){this.canload=!1},LevelController.prototype.onManifestLoaded=function(data){var levels=[],bitrateStart=void 0,levelSet={},levelFromSet=null,videoCodecFound=!1,audioCodecFound=!1,chromeOrFirefox=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),audioTracks=[];if(data.levels.forEach(function(level){level.loadError=0,level.fragmentError=!1,videoCodecFound=videoCodecFound||!!level.videoCodec,audioCodecFound=audioCodecFound||!!level.audioCodec||!(!level.attrs||!level.attrs.AUDIO),!0===chromeOrFirefox&&level.audioCodec&&-1!==level.audioCodec.indexOf("mp4a.40.34")&&(level.audioCodec=void 0),levelFromSet=levelSet[level.bitrate],void 0===levelFromSet?(level.url=[level.url],level.urlId=0,levelSet[level.bitrate]=level,levels.push(level)):levelFromSet.url.push(level.url)}),!0===videoCodecFound&&!0===audioCodecFound&&(levels=levels.filter(function(_ref){return!!_ref.videoCodec})),levels=levels.filter(function(_ref2){var audioCodec=_ref2.audioCodec,videoCodec=_ref2.videoCodec;return(!audioCodec||isCodecSupportedInMp4(audioCodec))&&(!videoCodec||isCodecSupportedInMp4(videoCodec))}),data.audioTracks&&(audioTracks=data.audioTracks.filter(function(track){return!track.audioCodec||isCodecSupportedInMp4(track.audioCodec,"audio")})),levels.length){bitrateStart=levels[0].bitrate,levels.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=levels;for(var i=0;i<levels.length;i++)if(levels[i].bitrate===bitrateStart){this._firstLevel=i,logger.b.log("manifest loaded,"+levels.length+" level(s) found, first bitrate:"+bitrateStart);break}this.hls.trigger(events.a.MANIFEST_PARSED,{levels:levels,audioTracks:audioTracks,firstLevel:this._firstLevel,stats:data.stats,audio:audioCodecFound,video:videoCodecFound,altAudio:audioTracks.length>0})}else this.hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},LevelController.prototype.setLevelInternal=function(newLevel){var levels=this._levels,hls=this.hls;if(newLevel>=0&&newLevel<levels.length){if(this.cleanTimer(),this._level!==newLevel){logger.b.log("switching to level "+newLevel),this._level=newLevel;var levelProperties=levels[newLevel];levelProperties.level=newLevel,hls.trigger(events.a.LEVEL_SWITCH,levelProperties),hls.trigger(events.a.LEVEL_SWITCHING,levelProperties)}var level=levels[newLevel],levelDetails=level.details;if(!levelDetails||!0===levelDetails.live){var urlId=level.urlId;hls.trigger(events.a.LEVEL_LOADING,{url:level.url[urlId],level:newLevel,id:urlId})}}else hls.trigger(events.a.ERROR,{type:errors.b.OTHER_ERROR,details:errors.a.LEVEL_SWITCH_ERROR,level:newLevel,fatal:!1,reason:"invalid level idx"})},LevelController.prototype.onError=function(data){var _this2=this;if(!0===data.fatal)return void(data.type===errors.b.NETWORK_ERROR&&this.cleanTimer());var details=data.details,levelError=!1,fragmentError=!1,levelIndex=void 0,level=void 0,config=this.hls.config;switch(details){case errors.a.FRAG_LOAD_ERROR:case errors.a.FRAG_LOAD_TIMEOUT:case errors.a.FRAG_LOOP_LOADING_ERROR:case errors.a.KEY_LOAD_ERROR:case errors.a.KEY_LOAD_TIMEOUT:levelIndex=data.frag.level,fragmentError=!0;break;case errors.a.LEVEL_LOAD_ERROR:case errors.a.LEVEL_LOAD_TIMEOUT:levelIndex=data.context.level,levelError=!0;break;case errors.a.REMUX_ALLOC_ERROR:levelIndex=data.level}if(void 0!==levelIndex)if(level=this._levels[levelIndex],level.loadError++,level.fragmentError=fragmentError,!0===fragmentError){var redundantLevels=level.url.length;redundantLevels>1&&level.loadError<redundantLevels?(level.urlId=(level.urlId+1)%redundantLevels,level.details=void 0,logger.b.warn("level controller,"+details+" for level "+levelIndex+": switching to redundant stream id "+level.urlId)):-1===this._manualLevel&&0!==levelIndex?(logger.b.warn("level controller,"+details+": switch-down for next fragment"),this.hls.nextAutoLevel=levelIndex-1):(logger.b.warn("level controller, "+details+": reload a fragment"),this._level=void 0)}else if(!0===levelError)if(this.levelRetryCount+1<=config.levelLoadingMaxRetry){var delay=Math.min(Math.pow(2,this.levelRetryCount)*config.levelLoadingRetryDelay,config.levelLoadingMaxRetryTimeout);this.timer=setTimeout(function(){return _this2.tick()},delay),data.levelRetry=!0,this.levelRetryCount++,logger.b.warn("level controller,"+details+", retry in "+delay+" ms, current retry count is "+this.levelRetryCount)}else logger.b.error("cannot recover "+details+" error"),this._level=void 0,this.cleanTimer(),data.fatal=!0},LevelController.prototype.onFragLoaded=function(_ref3){var frag=_ref3.frag;if(void 0!==frag&&"main"===frag.type){var level=this._levels[frag.level];void 0!==level&&(level.fragmentError=!1,level.loadError=0,this.levelRetryCount=0)}},LevelController.prototype.onLevelLoaded=function(data){var _this3=this,levelId=data.level;if(levelId===this._level){var curLevel=this._levels[levelId];!1===curLevel.fragmentError&&(curLevel.loadError=0,this.levelRetryCount=0);var newDetails=data.details;if(newDetails.live){var reloadInterval=1e3*(newDetails.averagetargetduration?newDetails.averagetargetduration:newDetails.targetduration),curDetails=curLevel.details;curDetails&&newDetails.endSN===curDetails.endSN&&(reloadInterval/=2,logger.b.log("same live playlist, reload twice faster")),reloadInterval-=performance.now()-data.stats.trequest,reloadInterval=Math.max(1e3,Math.round(reloadInterval)),logger.b.log("live playlist, reload in "+reloadInterval+" ms"),this.timer=setTimeout(function(){return _this3.tick()},reloadInterval)}else this.cleanTimer()}},LevelController.prototype.tick=function(){var levelId=this._level;if(void 0!==levelId&&this.canload){var level=this._levels[levelId];if(level&&level.url){var urlId=level.urlId;this.hls.trigger(events.a.LEVEL_LOADING,{url:level.url[urlId],level:levelId,id:urlId})}}},level_controller__createClass(LevelController,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(newLevel){var levels=this._levels;levels&&(newLevel=Math.min(newLevel,levels.length-1),this._level===newLevel&&void 0!==levels[newLevel].details||this.setLevelInternal(newLevel))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(newLevel){this._manualLevel=newLevel,void 0===this._startLevel&&(this._startLevel=newLevel),-1!==newLevel&&(this.level=newLevel)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(newLevel){this._firstLevel=newLevel}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var configStartLevel=this.hls.config.startLevel;return void 0!==configStartLevel?configStartLevel:this._firstLevel}return this._startLevel},set:function(newLevel){this._startLevel=newLevel}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.nextAutoLevel},set:function(nextLevel){this.level=nextLevel,-1===this._manualLevel&&(this.hls.nextAutoLevel=nextLevel)}}]),LevelController}(event_handler),level_controller=level_controller_LevelController,id3=__webpack_require__(4),id3_track_controller_ID3TrackController=function(_EventHandler){function ID3TrackController(hls){id3_track_controller__classCallCheck(this,ID3TrackController);var _this=id3_track_controller__possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.MEDIA_ATTACHED,events.a.MEDIA_DETACHING,events.a.FRAG_PARSING_METADATA));return _this.id3Track=void 0,_this.media=void 0,_this}return id3_track_controller__inherits(ID3TrackController,_EventHandler),ID3TrackController.prototype.destroy=function(){event_handler.prototype.destroy.call(this)},ID3TrackController.prototype.onMediaAttached=function(data){this.media=data.media,this.media},ID3TrackController.prototype.onMediaDetaching=function(){this.media=void 0},ID3TrackController.prototype.onFragParsingMetadata=function(data){var fragment=data.frag,samples=data.samples;this.id3Track||(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden");for(var Cue=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<samples.length;i++){var frames=id3.a.getID3Frames(samples[i].data);if(frames){var startTime=samples[i].pts,endTime=i<samples.length-1?samples[i+1].pts:fragment.endPTS;startTime===endTime&&(endTime+=1e-4);for(var j=0;j<frames.length;j++){var frame=frames[j];if(!id3.a.isTimeStampFrame(frame)){var cue=new Cue(startTime,endTime,"");cue.value=frame,this.id3Track.addCue(cue)}}}}},ID3TrackController}(event_handler),id3_track_controller=id3_track_controller_ID3TrackController,EWMA=function(){function EWMA(halfLife){ewma__classCallCheck(this,EWMA),this.alpha_=halfLife?Math.exp(Math.log(.5)/halfLife):0,this.estimate_=0,this.totalWeight_=0}return EWMA.prototype.sample=function(weight,value){var adjAlpha=Math.pow(this.alpha_,weight);this.estimate_=value*(1-adjAlpha)+adjAlpha*this.estimate_,this.totalWeight_+=weight},EWMA.prototype.getTotalWeight=function(){return this.totalWeight_},EWMA.prototype.getEstimate=function(){if(this.alpha_){var zeroFactor=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/zeroFactor}return this.estimate_},EWMA}(),ewma=EWMA,ewma_bandwidth_estimator_EwmaBandWidthEstimator=function(){function EwmaBandWidthEstimator(hls,slow,fast,defaultEstimate){ewma_bandwidth_estimator__classCallCheck(this,EwmaBandWidthEstimator),this.hls=hls,this.defaultEstimate_=defaultEstimate,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ewma(slow),this.fast_=new ewma(fast)}return EwmaBandWidthEstimator.prototype.sample=function(durationMs,numBytes){durationMs=Math.max(durationMs,this.minDelayMs_);var bandwidth=8e3*numBytes/durationMs,weight=durationMs/1e3;this.fast_.sample(weight,bandwidth),this.slow_.sample(weight,bandwidth)},EwmaBandWidthEstimator.prototype.canEstimate=function(){var fast=this.fast_;return fast&&fast.getTotalWeight()>=this.minWeight_},EwmaBandWidthEstimator.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},EwmaBandWidthEstimator.prototype.destroy=function(){},EwmaBandWidthEstimator}(),ewma_bandwidth_estimator=ewma_bandwidth_estimator_EwmaBandWidthEstimator,abr_controller__createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),abr_controller_AbrController=function(_EventHandler){function AbrController(hls){abr_controller__classCallCheck(this,AbrController);var _this=abr_controller__possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.FRAG_LOADING,events.a.FRAG_LOADED,events.a.FRAG_BUFFERED,events.a.ERROR));return _this.lastLoadedFragLevel=0,_this._nextAutoLevel=-1,_this.hls=hls,_this.timer=null,_this._bwEstimator=null,_this.onCheck=_this._abandonRulesCheck.bind(_this),_this}return abr_controller__inherits(AbrController,_EventHandler),AbrController.prototype.destroy=function(){this.clearTimer(),event_handler.prototype.destroy.call(this)},AbrController.prototype.onFragLoading=function(data){var frag=data.frag;if("main"===frag.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var hls=this.hls,level=data.frag.level,isLive=hls.levels[level].details.live,config=hls.config,ewmaFast=void 0,ewmaSlow=void 0;isLive?(ewmaFast=config.abrEwmaFastLive,ewmaSlow=config.abrEwmaSlowLive):(ewmaFast=config.abrEwmaFastVoD,ewmaSlow=config.abrEwmaSlowVoD),this._bwEstimator=new ewma_bandwidth_estimator(hls,ewmaSlow,ewmaFast,config.abrEwmaDefaultEstimate)}this.fragCurrent=frag}},AbrController.prototype._abandonRulesCheck=function(){var hls=this.hls,v=hls.media,frag=this.fragCurrent,loader=frag.loader,minAutoLevel=hls.minAutoLevel;if(!loader||loader.stats&&loader.stats.aborted)return logger.b.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var stats=loader.stats;if(v&&stats&&(!v.paused&&0!==v.playbackRate||!v.readyState)&&frag.autoLevel&&frag.level){var requestDelay=performance.now()-stats.trequest,playbackRate=Math.abs(v.playbackRate);if(requestDelay>500*frag.duration/playbackRate){var levels=hls.levels,loadRate=Math.max(1,stats.bw?stats.bw/8:1e3*stats.loaded/requestDelay),level=levels[frag.level],levelBitrate=level.realBitrate?Math.max(level.realBitrate,level.bitrate):level.bitrate,expectedLen=stats.total?stats.total:Math.max(stats.loaded,Math.round(frag.duration*levelBitrate/8)),pos=v.currentTime,fragLoadedDelay=(expectedLen-stats.loaded)/loadRate,bufferStarvationDelay=(buffer_helper.bufferInfo(v,pos,hls.config.maxBufferHole).end-pos)/playbackRate;if(bufferStarvationDelay<2*frag.duration/playbackRate&&fragLoadedDelay>bufferStarvationDelay){var fragLevelNextLoadedDelay=void 0,nextLoadLevel=void 0;for(nextLoadLevel=frag.level-1;nextLoadLevel>minAutoLevel;nextLoadLevel--){var levelNextBitrate=levels[nextLoadLevel].realBitrate?Math.max(levels[nextLoadLevel].realBitrate,levels[nextLoadLevel].bitrate):levels[nextLoadLevel].bitrate;if((fragLevelNextLoadedDelay=frag.duration*levelNextBitrate/(6.4*loadRate))<bufferStarvationDelay)break}fragLevelNextLoadedDelay<fragLoadedDelay&&(logger.b.warn("loading too slow, abort fragment loading and switch to level "+nextLoadLevel+":fragLoadedDelay["+nextLoadLevel+"]<fragLoadedDelay["+(frag.level-1)+"];bufferStarvationDelay:"+fragLevelNextLoadedDelay.toFixed(1)+"<"+fragLoadedDelay.toFixed(1)+":"+bufferStarvationDelay.toFixed(1)),hls.nextLoadLevel=nextLoadLevel,this._bwEstimator.sample(requestDelay,stats.loaded),loader.abort(),this.clearTimer(),hls.trigger(events.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:frag,stats:stats}))}}}},AbrController.prototype.onFragLoaded=function(data){var frag=data.frag;if("main"===frag.type&&!isNaN(frag.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=frag.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var level=this.hls.levels[frag.level],loadedBytes=(level.loaded?level.loaded.bytes:0)+data.stats.loaded,loadedDuration=(level.loaded?level.loaded.duration:0)+data.frag.duration;level.loaded={bytes:loadedBytes,duration:loadedDuration},level.realBitrate=Math.round(8*loadedBytes/loadedDuration)}if(data.frag.bitrateTest){var stats=data.stats;stats.tparsed=stats.tbuffered=stats.tload,this.onFragBuffered(data)}}},AbrController.prototype.onFragBuffered=function(data){var stats=data.stats,frag=data.frag;if(!(!0===stats.aborted||1!==frag.loadCounter||"main"!==frag.type||isNaN(frag.sn)||frag.bitrateTest&&stats.tload!==stats.tbuffered)){var fragLoadingProcessingMs=stats.tparsed-stats.trequest;logger.b.log("latency/loading/parsing/append/kbps:"+Math.round(stats.tfirst-stats.trequest)+"/"+Math.round(stats.tload-stats.tfirst)+"/"+Math.round(stats.tparsed-stats.tload)+"/"+Math.round(stats.tbuffered-stats.tparsed)+"/"+Math.round(8*stats.loaded/(stats.tbuffered-stats.trequest))),this._bwEstimator.sample(fragLoadingProcessingMs,stats.loaded),stats.bwEstimate=this._bwEstimator.getEstimate(),frag.bitrateTest?this.bitrateTestDelay=fragLoadingProcessingMs/1e3:this.bitrateTestDelay=0}},AbrController.prototype.onError=function(data){switch(data.details){case errors.a.FRAG_LOAD_ERROR:case errors.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},AbrController.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},AbrController.prototype._findBestLevel=function(currentLevel,currentFragDuration,currentBw,minAutoLevel,maxAutoLevel,maxFetchDuration,bwFactor,bwUpFactor,levels){for(var i=maxAutoLevel;i>=minAutoLevel;i--){var levelInfo=levels[i],levelDetails=levelInfo.details,avgDuration=levelDetails?levelDetails.totalduration/levelDetails.fragments.length:currentFragDuration,live=!!levelDetails&&levelDetails.live,adjustedbw=void 0;adjustedbw=i<=currentLevel?bwFactor*currentBw:bwUpFactor*currentBw;var bitrate=levels[i].realBitrate?Math.max(levels[i].realBitrate,levels[i].bitrate):levels[i].bitrate,fetchDuration=bitrate*avgDuration/adjustedbw;if(logger.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+i+"/"+Math.round(adjustedbw)+"/"+bitrate+"/"+avgDuration+"/"+maxFetchDuration+"/"+fetchDuration),adjustedbw>bitrate&&(!fetchDuration||live&&!this.bitrateTestDelay||fetchDuration<maxFetchDuration))return i}return-1},abr_controller__createClass(AbrController,[{key:"nextAutoLevel",get:function(){var forcedAutoLevel=this._nextAutoLevel,bwEstimator=this._bwEstimator;if(!(-1===forcedAutoLevel||bwEstimator&&bwEstimator.canEstimate()))return forcedAutoLevel;var nextABRAutoLevel=this._nextABRAutoLevel;return-1!==forcedAutoLevel&&(nextABRAutoLevel=Math.min(forcedAutoLevel,nextABRAutoLevel)),nextABRAutoLevel},set:function(nextLevel){this._nextAutoLevel=nextLevel}},{key:"_nextABRAutoLevel",get:function(){var hls=this.hls,maxAutoLevel=hls.maxAutoLevel,levels=hls.levels,config=hls.config,minAutoLevel=hls.minAutoLevel,v=hls.media,currentLevel=this.lastLoadedFragLevel,currentFragDuration=this.fragCurrent?this.fragCurrent.duration:0,pos=v?v.currentTime:0,playbackRate=v&&0!==v.playbackRate?Math.abs(v.playbackRate):1,avgbw=this._bwEstimator?this._bwEstimator.getEstimate():config.abrEwmaDefaultEstimate,bufferStarvationDelay=(buffer_helper.bufferInfo(v,pos,config.maxBufferHole).end-pos)/playbackRate,bestLevel=this._findBestLevel(currentLevel,currentFragDuration,avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay,config.abrBandWidthFactor,config.abrBandWidthUpFactor,levels);if(bestLevel>=0)return bestLevel;logger.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var maxStarvationDelay=currentFragDuration?Math.min(currentFragDuration,config.maxStarvationDelay):config.maxStarvationDelay,bwFactor=config.abrBandWidthFactor,bwUpFactor=config.abrBandWidthUpFactor;if(0===bufferStarvationDelay){var bitrateTestDelay=this.bitrateTestDelay;if(bitrateTestDelay){maxStarvationDelay=(currentFragDuration?Math.min(currentFragDuration,config.maxLoadingDelay):config.maxLoadingDelay)-bitrateTestDelay,logger.b.trace("bitrate test took "+Math.round(1e3*bitrateTestDelay)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*maxStarvationDelay)+" ms"),bwFactor=bwUpFactor=1}}return bestLevel=this._findBestLevel(currentLevel,currentFragDuration,avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay+maxStarvationDelay,bwFactor,bwUpFactor,levels),Math.max(bestLevel,0)}}]),AbrController}(event_handler),abr_controller=abr_controller_AbrController,buffer_controller_MediaSource=getMediaSource(),buffer_controller_BufferController=function(_EventHandler){function BufferController(hls){buffer_controller__classCallCheck(this,BufferController);var _this=buffer_controller__possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.MEDIA_ATTACHING,events.a.MEDIA_DETACHING,events.a.MANIFEST_PARSED,events.a.BUFFER_RESET,events.a.BUFFER_APPENDING,events.a.BUFFER_CODECS,events.a.BUFFER_EOS,events.a.BUFFER_FLUSHING,events.a.LEVEL_PTS_UPDATED,events.a.LEVEL_UPDATED));return _this._msDuration=null,_this._levelDuration=null,_this.onsbue=_this.onSBUpdateEnd.bind(_this),_this.onsbe=_this.onSBUpdateError.bind(_this),_this.pendingTracks={},_this.tracks={},_this}return buffer_controller__inherits(BufferController,_EventHandler),BufferController.prototype.destroy=function(){event_handler.prototype.destroy.call(this)},BufferController.prototype.onLevelPtsUpdated=function(data){var type=data.type,audioTrack=this.tracks.audio;if("audio"===type&&audioTrack&&"audio/mpeg"===audioTrack.container){var audioBuffer=this.sourceBuffer.audio;if(Math.abs(audioBuffer.timestampOffset-data.start)>.1){var updating=audioBuffer.updating;try{audioBuffer.abort()}catch(err){updating=!0,logger.b.warn("can not abort audio buffer: "+err)}updating?this.audioTimestampOffset=data.start:(logger.b.warn("change mpeg audio timestamp offset from "+audioBuffer.timestampOffset+" to "+data.start),audioBuffer.timestampOffset=data.start)}}},BufferController.prototype.onManifestParsed=function(data){var audioExpected=data.audio,videoExpected=data.video||data.levels.length&&data.audio,sourceBufferNb=0;data.altAudio&&(audioExpected||videoExpected)&&(sourceBufferNb=(audioExpected?1:0)+(videoExpected?1:0),logger.b.log(sourceBufferNb+" sourceBuffer(s) expected")),this.sourceBufferNb=sourceBufferNb},BufferController.prototype.onMediaAttaching=function(data){var media=this.media=data.media;if(media){var ms=this.mediaSource=new buffer_controller_MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),ms.addEventListener("sourceopen",this.onmso),ms.addEventListener("sourceended",this.onmse),ms.addEventListener("sourceclose",this.onmsc),media.src=URL.createObjectURL(ms)}},BufferController.prototype.onMediaDetaching=function(){logger.b.log("media source detaching");var ms=this.mediaSource;if(ms){if("open"===ms.readyState)try{ms.endOfStream()}catch(err){logger.b.warn("onMediaDetaching:"+err.message+" while calling endOfStream")}ms.removeEventListener("sourceopen",this.onmso),ms.removeEventListener("sourceended",this.onmse),ms.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(events.a.MEDIA_DETACHED)},BufferController.prototype.onMediaSourceOpen=function(){logger.b.log("media source opened"),this.hls.trigger(events.a.MEDIA_ATTACHED,{media:this.media});var mediaSource=this.mediaSource;mediaSource&&mediaSource.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},BufferController.prototype.checkPendingTracks=function(){var pendingTracks=this.pendingTracks,pendingTracksNb=Object.keys(pendingTracks).length;pendingTracksNb&&(this.sourceBufferNb<=pendingTracksNb||0===this.sourceBufferNb)&&(this.createSourceBuffers(pendingTracks),this.pendingTracks={},this.doAppending())},BufferController.prototype.onMediaSourceClose=function(){logger.b.log("media source closed")},BufferController.prototype.onMediaSourceEnded=function(){logger.b.log("media source ended")},BufferController.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var audioBuffer=this.sourceBuffer.audio;logger.b.warn("change mpeg audio timestamp offset from "+audioBuffer.timestampOffset+" to "+this.audioTimestampOffset),audioBuffer.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var parent=this.parent,pending=this.segments.reduce(function(counter,segment){return segment.parent===parent?counter+1:counter},0);this.hls.trigger(events.a.BUFFER_APPENDED,{parent:parent,pending:pending}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},BufferController.prototype.onSBUpdateError=function(event){logger.b.error("sourceBuffer error:",event),this.hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.BUFFER_APPENDING_ERROR,fatal:!1})},BufferController.prototype.onBufferReset=function(){var sourceBuffer=this.sourceBuffer;for(var type in sourceBuffer){var sb=sourceBuffer[type];try{this.mediaSource.removeSourceBuffer(sb),sb.removeEventListener("updateend",this.onsbue),sb.removeEventListener("error",this.onsbe)}catch(err){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},BufferController.prototype.onBufferCodecs=function(tracks){if(0===Object.keys(this.sourceBuffer).length){for(var trackName in tracks)this.pendingTracks[trackName]=tracks[trackName];var mediaSource=this.mediaSource;mediaSource&&"open"===mediaSource.readyState&&this.checkPendingTracks()}},BufferController.prototype.createSourceBuffers=function(tracks){var sourceBuffer=this.sourceBuffer,mediaSource=this.mediaSource;for(var trackName in tracks)if(!sourceBuffer[trackName]){var track=tracks[trackName],codec=track.levelCodec||track.codec,mimeType=track.container+";codecs="+codec;logger.b.log("creating sourceBuffer("+mimeType+")");try{var sb=sourceBuffer[trackName]=mediaSource.addSourceBuffer(mimeType);sb.addEventListener("updateend",this.onsbue),sb.addEventListener("error",this.onsbe),this.tracks[trackName]={codec:codec,container:track.container},track.buffer=sb}catch(err){logger.b.error("error while trying to add sourceBuffer:"+err.message),this.hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:err,mimeType:mimeType})}}this.hls.trigger(events.a.BUFFER_CREATED,{tracks:tracks})},BufferController.prototype.onBufferAppending=function(data){this._needsFlush||(this.segments?this.segments.push(data):this.segments=[data],this.doAppending())},BufferController.prototype.onBufferAppendFail=function(data){logger.b.error("sourceBuffer error:",data.event),this.hls.trigger(events.a.ERROR,{type:errors.b.MEDIA_ERROR,details:errors.a.BUFFER_APPENDING_ERROR,fatal:!1})},BufferController.prototype.onBufferEos=function(data){var sb=this.sourceBuffer,dataType=data.type;for(var type in sb)dataType&&type!==dataType||sb[type].ended||(sb[type].ended=!0,logger.b.log(type+" sourceBuffer now EOS"));this.checkEos()},BufferController.prototype.checkEos=function(){var sb=this.sourceBuffer,mediaSource=this.mediaSource;if(!mediaSource||"open"!==mediaSource.readyState)return void(this._needsEos=!1);for(var type in sb){var sbobj=sb[type];if(!sbobj.ended)return;if(sbobj.updating)return void(this._needsEos=!0)}logger.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{mediaSource.endOfStream()}catch(e){logger.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},BufferController.prototype.onBufferFlushing=function(data){this.flushRange.push({start:data.startOffset,end:data.endOffset,type:data.type}),this.flushBufferCounter=0,this.doFlush()},BufferController.prototype.onLevelUpdated=function(event){var details=event.details;0!==details.fragments.length&&(this._levelDuration=details.totalduration+details.fragments[0].start,this.updateMediaElementDuration())},BufferController.prototype.updateMediaElementDuration=function(){var media=this.media,mediaSource=this.mediaSource,sourceBuffer=this.sourceBuffer,levelDuration=this._levelDuration;if(null!==levelDuration&&media&&mediaSource&&sourceBuffer&&0!==media.readyState&&"open"===mediaSource.readyState){for(var type in sourceBuffer)if(sourceBuffer[type].updating)return;null===this._msDuration&&(this._msDuration=mediaSource.duration);var duration=media.duration;(levelDuration>this._msDuration&&levelDuration>duration||duration===1/0||isNaN(duration))&&(logger.b.log("Updating mediasource duration to "+levelDuration.toFixed(3)),this._msDuration=mediaSource.duration=levelDuration)}},BufferController.prototype.doFlush=function(){for(;this.flushRange.length;){var range=this.flushRange[0];if(!this.flushBuffer(range.start,range.end,range.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var appended=0,sourceBuffer=this.sourceBuffer;try{for(var type in sourceBuffer)appended+=sourceBuffer[type].buffered.length}catch(error){logger.b.error("error while accessing sourceBuffer.buffered")}this.appended=appended,this.hls.trigger(events.a.BUFFER_FLUSHED)}},BufferController.prototype.doAppending=function(){var hls=this.hls,sourceBuffer=this.sourceBuffer,segments=this.segments;if(Object.keys(sourceBuffer).length){if(this.media.error)return this.segments=[],void logger.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(segments&&segments.length){var segment=segments.shift();try{var type=segment.type,sb=sourceBuffer[type];sb?sb.updating?segments.unshift(segment):(sb.ended=!1,this.parent=segment.parent,sb.appendBuffer(segment.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(err){logger.b.error("error while trying to append buffer:"+err.message),segments.unshift(segment);var event={type:errors.b.MEDIA_ERROR,parent:segment.parent};if(22===err.code)return this.segments=[],event.details=errors.a.BUFFER_FULL_ERROR,event.fatal=!1,void hls.trigger(events.a.ERROR,event);if(this.appendError?this.appendError++:this.appendError=1,event.details=errors.a.BUFFER_APPEND_ERROR,this.appendError>hls.config.appendErrorMaxRetry)return logger.b.log("fail "+hls.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),segments=[],event.fatal=!0,void hls.trigger(events.a.ERROR,event);event.fatal=!1,hls.trigger(events.a.ERROR,event)}}}},BufferController.prototype.flushBuffer=function(startOffset,endOffset,typeIn){var sb,i,bufStart,bufEnd,flushStart,flushEnd,sourceBuffer=this.sourceBuffer;if(Object.keys(sourceBuffer).length){if(logger.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+startOffset+"/"+endOffset),this.flushBufferCounter<this.appended){for(var type in sourceBuffer)if(!typeIn||type===typeIn){if(sb=sourceBuffer[type],sb.ended=!1,sb.updating)return logger.b.warn("cannot flush, sb updating in progress"),!1;try{for(i=0;i<sb.buffered.length;i++)if(bufStart=sb.buffered.start(i),bufEnd=sb.buffered.end(i),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&endOffset===Number.POSITIVE_INFINITY?(flushStart=startOffset,flushEnd=endOffset):(flushStart=Math.max(bufStart,startOffset),flushEnd=Math.min(bufEnd,endOffset)),Math.min(flushEnd,bufEnd)-flushStart>.5)return this.flushBufferCounter++,logger.b.log("flush "+type+" ["+flushStart+","+flushEnd+"], of ["+bufStart+","+bufEnd+"], pos:"+this.media.currentTime),sb.remove(flushStart,flushEnd),!1}catch(e){logger.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else logger.b.warn("abort flushing too many retries");logger.b.log("buffer flushed")}return!0},BufferController}(event_handler),buffer_controller=buffer_controller_BufferController,cap_level_controller__createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),cap_level_controller_CapLevelController=function(_EventHandler){function CapLevelController(hls){return cap_level_controller__classCallCheck(this,CapLevelController),cap_level_controller__possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.FPS_DROP_LEVEL_CAPPING,events.a.MEDIA_ATTACHING,events.a.MANIFEST_PARSED))}return cap_level_controller__inherits(CapLevelController,_EventHandler),CapLevelController.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},CapLevelController.prototype.onFpsDropLevelCapping=function(data){CapLevelController.isLevelAllowed(data.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(data.droppedLevel)},CapLevelController.prototype.onMediaAttaching=function(data){this.media=data.media instanceof HTMLVideoElement?data.media:null},CapLevelController.prototype.onManifestParsed=function(data){var hls=this.hls;this.restrictedLevels=[],hls.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=data.levels,hls.firstLevel=this.getMaxLevel(data.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},CapLevelController.prototype.detectPlayerSize=function(){if(this.media){var levelsLength=this.levels?this.levels.length:0;if(levelsLength){var hls=this.hls;hls.autoLevelCapping=this.getMaxLevel(levelsLength-1),hls.autoLevelCapping>this.autoLevelCapping&&hls.streamController.nextLevelSwitch(),this.autoLevelCapping=hls.autoLevelCapping}}},CapLevelController.prototype.getMaxLevel=function(capLevelIndex){var _this2=this;if(!this.levels)return-1;var validLevels=this.levels.filter(function(level,index){return CapLevelController.isLevelAllowed(index,_this2.restrictedLevels)&&index<=capLevelIndex});return CapLevelController.getMaxLevelByMediaSize(validLevels,this.mediaWidth,this.mediaHeight)},CapLevelController.isLevelAllowed=function(level){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(level)},CapLevelController.getMaxLevelByMediaSize=function(levels,width,height){if(!levels||levels&&!levels.length)return-1;for(var maxLevelIndex=levels.length-1,i=0;i<levels.length;i+=1){var level=levels[i];if((level.width>=width||level.height>=height)&&function(curLevel,nextLevel){return!nextLevel||(curLevel.width!==nextLevel.width||curLevel.height!==nextLevel.height)}(level,levels[i+1])){maxLevelIndex=i;break}}return maxLevelIndex},cap_level_controller__createClass(CapLevelController,[{key:"mediaWidth",get:function(){var width=void 0,media=this.media;return media&&(width=media.width||media.clientWidth||media.offsetWidth,width*=CapLevelController.contentScaleFactor),width}},{key:"mediaHeight",get:function(){var height=void 0,media=this.media;return media&&(height=media.height||media.clientHeight||media.offsetHeight,height*=CapLevelController.contentScaleFactor),height}}],[{key:"contentScaleFactor",get:function(){var pixelRatio=1;try{pixelRatio=window.devicePixelRatio}catch(e){}return pixelRatio}}]),CapLevelController}(event_handler),cap_level_controller=cap_level_controller_CapLevelController,fps_controller_FPSController=function(_EventHandler){function FPSController(hls){return fps_controller__classCallCheck(this,FPSController),fps_controller__possibleConstructorReturn(this,_EventHandler.call(this,hls,events.a.MEDIA_ATTACHING))}return fps_controller__inherits(FPSController,_EventHandler),FPSController.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},FPSController.prototype.onMediaAttaching=function(data){var config=this.hls.config;if(config.capLevelOnFPSDrop){"function"==typeof(this.video=data.media instanceof HTMLVideoElement?data.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),config.fpsDroppedMonitoringPeriod)}},FPSController.prototype.checkFPS=function(video,decodedFrames,droppedFrames){var currentTime=performance.now();if(decodedFrames){if(this.lastTime){var currentPeriod=currentTime-this.lastTime,currentDropped=droppedFrames-this.lastDroppedFrames,currentDecoded=decodedFrames-this.lastDecodedFrames,droppedFPS=1e3*currentDropped/currentPeriod,hls=this.hls;if(hls.trigger(events.a.FPS_DROP,{currentDropped:currentDropped,currentDecoded:currentDecoded,totalDroppedFrames:droppedFrames}),droppedFPS>0&&currentDropped>hls.config.fpsDroppedMonitoringThreshold*currentDecoded){var currentLevel=hls.currentLevel;logger.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+currentLevel),currentLevel>0&&(-1===hls.autoLevelCapping||hls.autoLevelCapping>=currentLevel)&&(currentLevel-=1,hls.trigger(events.a.FPS_DROP_LEVEL_CAPPING,{level:currentLevel,droppedLevel:hls.currentLevel}),hls.autoLevelCapping=currentLevel,hls.streamController.nextLevelSwitch())}}this.lastTime=currentTime,this.lastDroppedFrames=droppedFrames,this.lastDecodedFrames=decodedFrames}},FPSController.prototype.checkFPSInterval=function(){var video=this.video;if(video)if(this.isVideoPlaybackQualityAvailable){var videoPlaybackQuality=video.getVideoPlaybackQuality();this.checkFPS(video,videoPlaybackQuality.totalVideoFrames,videoPlaybackQuality.droppedVideoFrames)}else this.checkFPS(video,video.webkitDecodedFrameCount,video.webkitDroppedFrameCount)},FPSController}(event_handler),fps_controller=fps_controller_FPSController,xhr_loader_XhrLoader=function(){function XhrLoader(config){xhr_loader__classCallCheck(this,XhrLoader),config&&config.xhrSetup&&(this.xhrSetup=config.xhrSetup)}return XhrLoader.prototype.destroy=function(){this.abort(),this.loader=null},XhrLoader.prototype.abort=function(){var loader=this.loader;loader&&4!==loader.readyState&&(this.stats.aborted=!0,loader.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},XhrLoader.prototype.load=function(context,config,callbacks){this.context=context,this.config=config,this.callbacks=callbacks,this.stats={trequest:performance.now(),retry:0},this.retryDelay=config.retryDelay,this.loadInternal()},XhrLoader.prototype.loadInternal=function(){var xhr,context=this.context;xhr=this.loader=new XMLHttpRequest;var stats=this.stats;stats.tfirst=0,stats.loaded=0;var xhrSetup=this.xhrSetup;try{if(xhrSetup)try{xhrSetup(xhr,context.url)}catch(e){xhr.open("GET",context.url,!0),xhrSetup(xhr,context.url)}xhr.readyState||xhr.open("GET",context.url,!0)}catch(e){return void this.callbacks.onError({code:xhr.status,text:e.message},context,xhr)}context.rangeEnd&&xhr.setRequestHeader("Range","bytes="+context.rangeStart+"-"+(context.rangeEnd-1)),xhr.onreadystatechange=this.readystatechange.bind(this),xhr.onprogress=this.loadprogress.bind(this),xhr.responseType=context.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),xhr.send()},XhrLoader.prototype.readystatechange=function(event){var xhr=event.currentTarget,readyState=xhr.readyState,stats=this.stats,context=this.context,config=this.config;if(!stats.aborted&&readyState>=2)if(window.clearTimeout(this.requestTimeout),0===stats.tfirst&&(stats.tfirst=Math.max(performance.now(),stats.trequest)),4===readyState){var status=xhr.status;if(status>=200&&status<300){stats.tload=Math.max(stats.tfirst,performance.now());var data=void 0,len=void 0;"arraybuffer"===context.responseType?(data=xhr.response,len=data.byteLength):(data=xhr.responseText,len=data.length),stats.loaded=stats.total=len;var response={url:xhr.responseURL,data:data};this.callbacks.onSuccess(response,stats,context,xhr)}else stats.retry>=config.maxRetry||status>=400&&status<499?(logger.b.error(status+" while loading "+context.url),this.callbacks.onError({code:status,text:xhr.statusText},context,xhr)):(logger.b.warn(status+" while loading "+context.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,config.maxRetryDelay),stats.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),config.timeout)},XhrLoader.prototype.loadtimeout=function(){logger.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},XhrLoader.prototype.loadprogress=function(event){var xhr=event.currentTarget,stats=this.stats;stats.loaded=event.loaded,event.lengthComputable&&(stats.total=event.total);var onProgress=this.callbacks.onProgress;onProgress&&onProgress(stats,this.context,null,xhr)},XhrLoader}(),xhr_loader=xhr_loader_XhrLoader,hlsDefaultConfig=(__webpack_require__(3),{autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:xhr_loader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:abr_controller,bufferController:buffer_controller,capLevelController:cap_level_controller,fpsController:fps_controller,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}),hls__createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),hls_Hls=function(){function Hls(){var _this=this,config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};hls__classCallCheck(this,Hls);var defaultConfig=Hls.DefaultConfig;if((config.liveSyncDurationCount||config.liveMaxLatencyDurationCount)&&(config.liveSyncDuration||config.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var prop in defaultConfig)prop in config||(config[prop]=defaultConfig[prop]);if(void 0!==config.liveMaxLatencyDurationCount&&config.liveMaxLatencyDurationCount<=config.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==config.liveMaxLatencyDuration&&(config.liveMaxLatencyDuration<=config.liveSyncDuration||void 0===config.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(logger.a)(config.debug),this.config=config,this._autoLevelCapping=-1;var observer=this.observer=new events_default.a;observer.trigger=function(event){for(var _len=arguments.length,data=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];observer.emit.apply(observer,[event,event].concat(data))},observer.off=function(event){for(var _len2=arguments.length,data=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)data[_key2-1]=arguments[_key2];observer.removeListener.apply(observer,[event].concat(data))},this.on=observer.on.bind(observer),this.off=observer.off.bind(observer),this.trigger=observer.trigger.bind(observer);var abrController=this.abrController=new config.abrController(this),bufferController=new config.bufferController(this),capLevelController=new config.capLevelController(this),fpsController=new config.fpsController(this),playListLoader=new playlist_loader(this),fragmentLoader=new fragment_loader(this),keyLoader=new key_loader(this),id3TrackController=new id3_track_controller(this),levelController=this.levelController=new level_controller(this),streamController=this.streamController=new stream_controller(this),networkControllers=[levelController,streamController],Controller=config.audioStreamController;Controller&&networkControllers.push(new Controller(this)),this.networkControllers=networkControllers;var coreComponents=[playListLoader,fragmentLoader,keyLoader,abrController,bufferController,capLevelController,fpsController,id3TrackController];if(Controller=config.audioTrackController){var audioTrackController=new Controller(this);this.audioTrackController=audioTrackController,coreComponents.push(audioTrackController)}if(Controller=config.subtitleTrackController){var subtitleTrackController=new Controller(this);this.subtitleTrackController=subtitleTrackController,coreComponents.push(subtitleTrackController)}[config.subtitleStreamController,config.timelineController].forEach(function(Controller){Controller&&coreComponents.push(new Controller(_this))}),this.coreComponents=coreComponents}return Hls.isSupported=function(){var mediaSource=getMediaSource(),sourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer,isTypeSupported=mediaSource&&"function"==typeof mediaSource.isTypeSupported&&mediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),sourceBufferValidAPI=!sourceBuffer||sourceBuffer.prototype&&"function"==typeof sourceBuffer.prototype.appendBuffer&&"function"==typeof sourceBuffer.prototype.remove;return isTypeSupported&&sourceBufferValidAPI},hls__createClass(Hls,null,[{key:"version",get:function(){return"0.8.7"}},{key:"Events",get:function(){return events.a}},{key:"ErrorTypes",get:function(){return errors.b}},{key:"ErrorDetails",get:function(){return errors.a}},{key:"DefaultConfig",get:function(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig},set:function(defaultConfig){Hls.defaultConfig=defaultConfig}}]),Hls.prototype.destroy=function(){logger.b.log("destroy"),this.trigger(events.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(component){component.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},Hls.prototype.attachMedia=function(media){logger.b.log("attachMedia"),this.media=media,this.trigger(events.a.MEDIA_ATTACHING,{media:media})},Hls.prototype.detachMedia=function(){logger.b.log("detachMedia"),this.trigger(events.a.MEDIA_DETACHING),this.media=null},Hls.prototype.loadSource=function(url){url=url_toolkit_default.a.buildAbsoluteURL(window.location.href,url,{alwaysNormalize:!0}),logger.b.log("loadSource:"+url),this.url=url,this.trigger(events.a.MANIFEST_LOADING,{url:url})},Hls.prototype.startLoad=function(){var startPosition=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;logger.b.log("startLoad("+startPosition+")"),this.networkControllers.forEach(function(controller){controller.startLoad(startPosition)})},Hls.prototype.stopLoad=function(){logger.b.log("stopLoad"),this.networkControllers.forEach(function(controller){controller.stopLoad()})},Hls.prototype.swapAudioCodec=function(){logger.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},Hls.prototype.recoverMediaError=function(){logger.b.log("recoverMediaError");var media=this.media;this.detachMedia(),this.attachMedia(media)},hls__createClass(Hls,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(newLevel){logger.b.log("set currentLevel:"+newLevel),this.loadLevel=newLevel,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(newLevel){logger.b.log("set nextLevel:"+newLevel),this.levelController.manualLevel=newLevel,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(newLevel){logger.b.log("set loadLevel:"+newLevel),this.levelController.manualLevel=newLevel}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(level){this.levelController.nextLoadLevel=level}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(newLevel){logger.b.log("set firstLevel:"+newLevel),this.levelController.firstLevel=newLevel}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(newLevel){logger.b.log("set startLevel:"+newLevel);var hls=this;-1!==newLevel&&(newLevel=Math.max(newLevel,hls.minAutoLevel)),hls.levelController.startLevel=newLevel}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(newLevel){logger.b.log("set autoLevelCapping:"+newLevel),this._autoLevelCapping=newLevel}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var hls=this,levels=hls.levels,minAutoBitrate=hls.config.minAutoBitrate,len=levels?levels.length:0,i=0;i<len;i++){if((levels[i].realBitrate?Math.max(levels[i].realBitrate,levels[i].bitrate):levels[i].bitrate)>minAutoBitrate)return i}return 0}},{key:"maxAutoLevel",get:function(){var hls=this,levels=hls.levels,autoLevelCapping=hls.autoLevelCapping;return-1===autoLevelCapping&&levels&&levels.length?levels.length-1:autoLevelCapping}},{key:"nextAutoLevel",get:function(){var hls=this;return Math.min(Math.max(hls.abrController.nextAutoLevel,hls.minAutoLevel),hls.maxAutoLevel)},set:function(nextLevel){var hls=this;hls.abrController.nextAutoLevel=Math.max(hls.minAutoLevel,nextLevel)}},{key:"audioTracks",get:function(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTracks:[]}},{key:"audioTrack",get:function(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTrack:-1},set:function(audioTrackId){var audioTrackController=this.audioTrackController;audioTrackController&&(audioTrackController.audioTrack=audioTrackId)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTrack:-1},set:function(subtitleTrackId){var subtitleTrackController=this.subtitleTrackController;subtitleTrackController&&(subtitleTrackController.subtitleTrack=subtitleTrackId)}},{key:"subtitleDisplay",get:function(){var subtitleTrackController=this.subtitleTrackController;return!!subtitleTrackController&&subtitleTrackController.subtitleDisplay},set:function(value){var subtitleTrackController=this.subtitleTrackController;subtitleTrackController&&(subtitleTrackController.subtitleDisplay=value)}}]),Hls}();__webpack_exports__.default=hls_Hls},function(module,exports,__webpack_require__){function webpackBootstrapFunc(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/",__webpack_require__.oe=function(err){throw console.error(err),err};var f=__webpack_require__(__webpack_require__.s=ENTRY_MODULE);return f.default||f}function quoteRegExp(str){return(str+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function getModuleDependencies(module){var retval=[],fnString=module.toString(),wrapperSignature=fnString.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!wrapperSignature)return retval;for(var match,webpackRequireName=wrapperSignature[1],re=new RegExp("(\\\\n|\\W)"+quoteRegExp(webpackRequireName)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");match=re.exec(fnString);)retval.push(match[3]);return retval}function getRequiredModules(sources,moduleId){for(var modulesQueue=[moduleId],requiredModules=[],seenModules={};modulesQueue.length;){var moduleToCheck=modulesQueue.pop();if(!seenModules[moduleToCheck]&&sources[moduleToCheck]){seenModules[moduleToCheck]=!0,requiredModules.push(moduleToCheck);var newModules=getModuleDependencies(sources[moduleToCheck]);modulesQueue=modulesQueue.concat(newModules)}}return requiredModules}module.exports=function(moduleId,options){options=options||{};var sources=__webpack_require__.m,requiredModules=options.all?Object.keys(sources):getRequiredModules(sources,moduleId),src="("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(moduleId))+")({"+requiredModules.map(function(id){return JSON.stringify(id)+": "+sources[id].toString()}).join(",")+"})(self);",blob=new window.Blob([src],{type:"text/javascript"});if(options.bare)return blob;var URL=window.URL||window.webkitURL||window.mozURL||window.msURL,workerUrl=URL.createObjectURL(blob),worker=new window.Worker(workerUrl);return worker.objectURL=workerUrl,worker}},function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__demux_demuxer_inline__=__webpack_require__(7),__WEBPACK_IMPORTED_MODULE_1__events__=__webpack_require__(1),__WEBPACK_IMPORTED_MODULE_2__utils_logger__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_3_events__=__webpack_require__(5),__WEBPACK_IMPORTED_MODULE_3_events___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_events__),DemuxerWorker=function(self){var observer=new __WEBPACK_IMPORTED_MODULE_3_events___default.a;observer.trigger=function(event){for(var _len=arguments.length,data=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];observer.emit.apply(observer,[event,event].concat(data))},observer.off=function(event){for(var _len2=arguments.length,data=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)data[_key2-1]=arguments[_key2];observer.removeListener.apply(observer,[event].concat(data))};var forwardMessage=function(ev,data){self.postMessage({event:ev,data:data})};self.addEventListener("message",function(ev){var data=ev.data;switch(data.cmd){case"init":var config=JSON.parse(data.config);self.demuxer=new __WEBPACK_IMPORTED_MODULE_0__demux_demuxer_inline__.a(observer,data.typeSupported,config,data.vendor);try{Object(__WEBPACK_IMPORTED_MODULE_2__utils_logger__.a)(!0===config.debug)}catch(err){console.warn("demuxerWorker: unable to enable logs")}forwardMessage("init",null);break;case"demux":self.demuxer.push(data.data,data.decryptdata,data.initSegment,data.audioCodec,data.videoCodec,data.timeOffset,data.discontinuity,data.trackSwitch,data.contiguous,data.duration,data.accurateTimeOffset,data.defaultInitPTS)}}),observer.on(__WEBPACK_IMPORTED_MODULE_1__events__.a.FRAG_DECRYPTED,forwardMessage),observer.on(__WEBPACK_IMPORTED_MODULE_1__events__.a.FRAG_PARSING_INIT_SEGMENT,forwardMessage),observer.on(__WEBPACK_IMPORTED_MODULE_1__events__.a.FRAG_PARSED,forwardMessage),observer.on(__WEBPACK_IMPORTED_MODULE_1__events__.a.ERROR,forwardMessage),observer.on(__WEBPACK_IMPORTED_MODULE_1__events__.a.FRAG_PARSING_METADATA,forwardMessage),observer.on(__WEBPACK_IMPORTED_MODULE_1__events__.a.FRAG_PARSING_USERDATA,forwardMessage),observer.on(__WEBPACK_IMPORTED_MODULE_1__events__.a.INIT_PTS_FOUND,forwardMessage),observer.on(__WEBPACK_IMPORTED_MODULE_1__events__.a.FRAG_PARSING_DATA,function(ev,data){var transferable=[],message={event:ev,data:data};data.data1&&(message.data1=data.data1.buffer,transferable.push(data.data1.buffer),delete data.data1),data.data2&&(message.data2=data.data2.buffer,transferable.push(data.data2.buffer),delete data.data2),self.postMessage(message,transferable)})};__webpack_exports__.default=DemuxerWorker}]).default})}});